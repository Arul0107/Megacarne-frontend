import{r as a,I as Z,t as ee,R as te,s as r,p as t,B as c,q as se}from"./index-CYKRXJOk.js";import{i as u}from"./axios-CbH7bVGc.js";import"./jspdf.es.min-BDagkC0x.js";import"./html2canvas.esm-CBrSDip1.js";import{B as oe,N as ae,F as re}from"./FollowUpDrawer-B5586zxU.js";import{C as ce}from"./index-BceDWwfj.js";import{I as T}from"./index-CADQv6lt.js";import{R as F}from"./TextArea-9LReN77j.js";import{R as ne,T as $}from"./index-eIkLMMP9.js";import{F as le,R as ie}from"./Table-DP7y5znB.js";import{E as ue}from"./index-Cc2eT5bz.js";import{M as de}from"./index-BLKFsFqM.js";import{T as me,a as pe}from"./index-hkH-ZYDi.js";import{R as xe}from"./MessageOutlined-CtTlXg8g.js";import{S as fe}from"./index-CQDXKDWk.js";import{P as he}from"./index-Lf6PW4pG.js";import{R as ve}from"./DeleteOutlined-BX9P26kX.js";import"./index-cHzbopOC.js";import"./index-BzpcUq4L.js";import"./index-CRQdXBH2.js";import"./context-BtKXkfhE.js";import"./index-c5POKLjr.js";import"./index-DYCWA9fF.js";import"./index-CwSLYTCe.js";import"./index-CDhEyJxf.js";import"./index-kouXNn5D.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},ye=function(n,m){return a.createElement(Z,ee({},n,{ref:m,icon:Ce}))},we=a.forwardRef(ye);const{Title:be}=me,{TabPane:L}=$,d="/api/accounts",Ye=()=>{const[S,n]=a.useState(!1),[m,j]=a.useState(null),[p,D]=a.useState(""),[x,V]=a.useState("active"),[E,f]=a.useState(!1),[A,h]=a.useState(null),[v,C]=a.useState(null),[B,y]=a.useState([]),[O,N]=a.useState(!1),[P,k]=a.useState(!1),[w,I]=a.useState(null),[M,U]=a.useState(0),[z,H]=a.useState(0);te.useEffect(()=>{l()},[x]);const l=async()=>{try{let e=`${d}/leads/active`,s=`${d}/customers`;const[o,b]=await Promise.all([u.get(e),u.get(s)]),i=o.data,g=b.data;U(i.length),H(g.length),y(x==="active"?i:x==="customers"?g:[...i,...g])}catch(e){r.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e)}},_=async e=>{var s;try{m?(await u.put(`${d}/${m._id}`,e),r.success("Account updated successfully!")):(await u.post(d,e),r.success("Account created successfully!")),n(!1),l()}catch(o){r.error("Failed to save account."),console.error("Save account error:",((s=o.response)==null?void 0:s.data)||o.message)}},W=e=>{j(e),n(!0)},G=async e=>{var s;try{await u.delete(`${d}/${e}`),r.success("Account deleted successfully (soft delete)!"),l()}catch(o){r.error("Failed to delete account."),console.error("Delete account error:",((s=o.response)==null?void 0:s.data)||o.message)}},K=e=>{I(e),N(!0)},Y=e=>{I(e),k(!0)},q=(e,s)=>{h(s),C(e),f(!0)},J=async()=>{var e;try{const s={...A,isCustomer:v};await u.put(`${d}/${A._id}`,s),r.success(`Account status changed to ${v?"Customer":"Lead"}!`),l()}catch(s){r.error("Failed to update account status."),console.error("Status update error:",((e=s.response)==null?void 0:e.data)||s.message)}finally{f(!1),h(null),C(null)}},Q=()=>{f(!1),h(null),C(null)},X=[{title:"S.No",key:"sno",render:(e,s,o)=>o+1},{title:"Business Name",dataIndex:"businessName",key:"businessName",filterDropdown:({setSelectedKeys:e,selectedKeys:s,confirm:o,clearFilters:b})=>t.jsxs("div",{style:{padding:8},children:[t.jsx(T,{placeholder:"Search Business Name",value:s[0],onChange:i=>e(i.target.value?[i.target.value]:[]),onPressEnter:()=>o(),style:{marginBottom:8,display:"block"}}),t.jsx(c,{type:"primary",onClick:()=>o(),icon:t.jsx(F,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t.jsx(c,{onClick:()=>b(),size:"small",style:{width:90},children:"Reset"})]}),onFilter:(e,s)=>s.businessName.toLowerCase().includes(e.toLowerCase())},{title:"Contact Name",dataIndex:"contactName",key:"contactName"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber"},{title:"Lead Type",dataIndex:"type",key:"type",filters:[{text:"Hot",value:"Hot"},{text:"Warm",value:"Warm"},{text:"Cold",value:"Cold"}],onFilter:(e,s)=>s.type.indexOf(e)===0},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(pe,{color:e==="Active"?"green":"red",children:e}),filters:[{text:"Active",value:"Active"},{text:"Inactive",value:"Inactive"}],onFilter:(e,s)=>s.status.indexOf(e)===0},{title:"Source Type",dataIndex:"sourceType",key:"sourceType",filters:[{text:"Direct",value:"Direct"},{text:"Facebook Referral",value:"Facebook Referral"},{text:"Google Ads",value:"Google Ads"},{text:"Website",value:"Website"},{text:"Cold Call",value:"Cold Call"},{text:"Other",value:"Other"}],onFilter:(e,s)=>{var o;return((o=s.sourceType)==null?void 0:o.indexOf(e))===0}},{title:"Referral Person",dataIndex:"referralPersonName",key:"referralPersonName",render:e=>e||"N/A"},{title:"Action",key:"action",render:(e,s)=>t.jsxs(se,{size:"middle",children:[t.jsx(c,{icon:t.jsx(ie,{}),onClick:()=>W(s)}),t.jsx(c,{icon:t.jsx(xe,{}),onClick:()=>K(s)}),t.jsx(c,{icon:t.jsx(we,{}),onClick:()=>Y(s)}),t.jsx(fe,{checkedChildren:"Customer",unCheckedChildren:"Lead",checked:s.isCustomer,onChange:o=>q(o,s)}),t.jsx(he,{title:"Are you sure you want to delete this account?",onConfirm:()=>G(s._id),okText:"Yes",cancelText:"No",children:t.jsx(c,{icon:t.jsx(ve,{}),danger:!0})})]})}],R=B.filter(e=>e.businessName.toLowerCase().includes(p.toLowerCase())||e.contactName.toLowerCase().includes(p.toLowerCase()));return t.jsxs(ce,{title:t.jsx(be,{level:2,children:"Manage Leads & Customers"}),children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(T,{placeholder:"Search by business or contact name",prefix:t.jsx(F,{}),style:{width:300},value:p,onChange:e=>D(e.target.value)}),t.jsx(c,{type:"primary",icon:t.jsx(ne,{}),onClick:()=>{j(null),n(!0)},children:"Add New Account"})]}),t.jsxs($,{defaultActiveKey:"active",onChange:V,children:[t.jsx(L,{tab:`Active Leads (${M})`},"active"),t.jsx(L,{tab:`Customers (${z})`},"customers")]}),R.length>0?t.jsx(le,{columns:X,dataSource:R,rowKey:"_id",scroll:{x:"max-content"}}):t.jsx(ue,{description:"No accounts found."}),t.jsx(oe,{visible:S,onClose:()=>n(!1),onSave:_,initialValues:m}),w&&t.jsxs(t.Fragment,{children:[t.jsx(ae,{visible:O,onClose:()=>N(!1),account:w,refreshAccounts:l}),t.jsx(re,{visible:P,onClose:()=>k(!1),account:w,refreshAccounts:l})]}),t.jsx(de,{title:"Change Account Status",visible:E,onOk:J,onCancel:Q,okText:"Yes",cancelText:"No",children:t.jsxs("p",{children:["Are you sure you want to change this account's status to ",v?"Customer":"Lead","?"]})})]})};export{Ye as default};
