import{r as u,I as K,a as Q,o as e,B as k,ak as j}from"./index-p2W8-JSg.js";import{F as s}from"./index-m4syREVC.js";import{D as E}from"./index-9Jakdzoy.js";import{R as D,C as x}from"./TextArea-BIVTlsSe.js";import{I as d}from"./index-CkSeMQSC.js";import{T as X}from"./index-BY2F3JJu.js";import{S as F}from"./index-CyLVz7SK.js";import{i as A}from"./axios-YBtE4rUB.js";import{D as z}from"./index-8TEVMGxs.js";import{R as Z,T as J}from"./index-Cn41Z8Jf.js";import{T as $}from"./index-DBLVFDmX.js";import{h as T}from"./moment-C5S46NFB.js";import{D as V}from"./index-B_eudkdX.js";import{L as P}from"./index-BjvDYLf9.js";import{M as ee}from"./index-D73F1-5_.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},se=function(w,r){return u.createElement(K,Q({},w,{ref:r,icon:te}))},Ne=u.forwardRef(se);const{TextArea:re}=d,{Option:n}=F,Ce=({visible:f,onClose:w,onSave:r,initialValues:a,allUsers:g,loadingUsers:b})=>{var y;const[i]=s.useForm(),[m,v]=u.useState(!1);s.useWatch("sourceType",i),u.useEffect(()=>{var l;i.resetFields(),a?i.setFieldsValue({...a,assignedTo:((l=a.assignedTo)==null?void 0:l._id)||null}):i.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null})},[a,i]);const N=()=>{i.validateFields().then(l=>{v(!0);const o=new Date().toLocaleString(),p=l.noteInput?{text:l.noteInput,timestamp:o}:null,h=(a==null?void 0:a.notes)||[],C=p?[...h,p]:h,I={...l,notes:C,assignedTo:l.assignedTo===null?null:l.assignedTo};delete I.noteInput,r(I),j.success(`Account ${a?"updated":"created"} successfully!`),v(!1),w()}).catch(l=>{console.log("Validate Failed:",l),j.error("Please fill in all required fields correctly.")})};return e.jsx(E,{title:a?"Edit Business Account":"Create New Business Account",width:720,onClose:w,visible:f,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(k,{onClick:w,style:{marginRight:8},children:"Cancel"}),e.jsx(k,{onClick:N,type:"primary",loading:m,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:a?"Update Account":"Create Account"})]}),children:e.jsxs(s,{form:i,layout:"vertical",children:[e.jsxs(D,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(d,{placeholder:"Business Name"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(d,{placeholder:"GST Number"})})})]}),e.jsxs(D,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(d,{placeholder:"Contact Person Name"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(d,{placeholder:"Email"})})})]}),e.jsxs(D,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(d,{placeholder:"Phone Number (Optional)"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(d,{placeholder:"Mobile Number"})})})]}),e.jsx(s.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(d,{placeholder:"Address Line 1"})}),e.jsxs(D,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(d,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(d,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(s.Item,{name:"landmark",label:"Landmark",children:e.jsx(d,{placeholder:"Landmark (Optional)"})}),e.jsxs(D,{gutter:16,children:[e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(d,{placeholder:"City"})})}),e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(X,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(d,{placeholder:"State"})})})]}),e.jsx(s.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(d,{placeholder:"Country"})}),e.jsx(s.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(d,{placeholder:"https://www.example.com"})}),e.jsx(s.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(F,{placeholder:"Select Type",children:[e.jsx(n,{value:"Hot",children:"Hot"}),e.jsx(n,{value:"Warm",children:"Warm"}),e.jsx(n,{value:"Cold",children:"Cold"})]})}),e.jsx(s.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(F,{placeholder:"Select Status",children:[e.jsx(n,{value:"Active",children:"Active"}),e.jsx(n,{value:"Inactive",children:"Inactive"}),e.jsx(n,{value:"Pipeline",children:"Pipeline"}),e.jsx(n,{value:"Closed",children:"Closed"}),e.jsx(n,{value:"Customer",children:"Customer"})," "]})}),e.jsx(s.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(F,{placeholder:"How did you hear about us?",children:[e.jsx(n,{value:"Direct",children:"Direct"}),e.jsx(n,{value:"Facebook",children:"Facebook"}),e.jsx(n,{value:"Google Ads",children:"Google Ads"}),e.jsx(n,{value:"Website",children:"Website"}),e.jsx(n,{value:"Cold Call",children:"Cold Call"}),e.jsx(n,{value:"Client",children:"Client"})," ",e.jsx(n,{value:"Tradefair",children:"Tradefair"})," ",e.jsx(n,{value:"Other",children:"Other"})]})}),e.jsx(s.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(F,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:b,showSearch:!0,optionFilterProp:"children",filterOption:(l,o)=>o.children.toLowerCase().indexOf(l.toLowerCase())>=0,children:g&&g.map(l=>e.jsxs(n,{value:l._id,children:[l.name," (",l.role,")"]},l._id))})}),e.jsx(s.Item,{name:"noteInput",label:"Add Note",children:e.jsx(re,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((y=a==null?void 0:a.notes)==null?void 0:y.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:a.notes.map((l,o)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[l.timestamp,":"]})," ",l.text]},o))})]})]})})},{TextArea:le}=d,{Title:oe,Text:ae}=$,Ie=({visible:f,onClose:w,account:r,refreshAccounts:a})=>{const[g]=s.useForm(),[b,i]=u.useState(!1),[m,v]=u.useState([]);u.useEffect(()=>{f&&(r!=null&&r._id)&&v(r.notes||[])},[f,r]);const N=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},y=async()=>{try{const{note:o}=await g.validateFields();i(!0);const p={text:o,timestamp:new Date().toLocaleString(),author:N()},h=[...m,p];await A.put(`/api/accounts/${r._id}`,{...r,notes:h}),j.success("Note added successfully!"),v(h),g.resetFields(),a()}catch{j.error("Failed to add note.")}finally{i(!1)}},l=()=>!m||m.length===0?e.jsx(ae,{type:"secondary",children:"No notes to show"}):m.map((o,p)=>{const h=p>0?m[p-1]:null,C=new Date(o.timestamp).toDateString(),I=h?new Date(h.timestamp).toDateString():null,L=C!==I;return e.jsxs("div",{children:[L&&e.jsx("div",{className:"note-date-header",children:C}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[o.author,"    ",o.timestamp]}),e.jsx("div",{className:"note-text",children:o.text})]})]},p)});return e.jsxs(E,{title:e.jsxs(oe,{level:4,style:{margin:0},children:["Notes for ",r.businessName]}),open:f,onClose:w,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[l(),e.jsx(z,{}),e.jsxs(s,{form:g,layout:"vertical",children:[e.jsx(s.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(le,{rows:3,placeholder:"Type your note here...",disabled:b})}),e.jsx(k,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(Z,{}),onClick:y,loading:b,block:!0,children:"Add Note"})]})]})},{TextArea:ne}=d,{TabPane:U}=J,Te=({visible:f,onClose:w,account:r,refreshAccounts:a})=>{const[g,b]=u.useState(""),[i,m]=u.useState(null),[v,N]=u.useState(!1),[y,l]=u.useState([]),[o,p]=u.useState(null);u.useEffect(()=>{f&&(r!=null&&r._id)&&h()},[f,r]);const h=async()=>{try{const t=await A.get(`/api/accounts/${r._id}/followups`);l(t.data||[])}catch{j.error("Failed to fetch follow-ups")}},C=()=>{if(!g||!i){j.error("Please fill in all fields");return}const t=JSON.parse(localStorage.getItem("user")),c=t==null?void 0:t._id;if(!c){j.error("User not found");return}N(!0);const S={date:i.format("YYYY-MM-DD"),note:g,addedBy:c};(o===null?A.post(`/api/accounts/${r._id}/followups`,S):A.put(`/api/accounts/${r._id}/followups/${o}`,S)).then(()=>{j.success(o===null?"Follow-up added":"Follow-up updated"),b(""),m(null),p(null),h(),a()}).catch(M=>{var W,G;j.error(((G=(W=M==null?void 0:M.response)==null?void 0:W.data)==null?void 0:G.message)||"Failed to save follow-up")}).finally(()=>N(!1))},I=t=>{const c=y[t];b(c.note),m(T(c.date)),p(t)},L=t=>{ee.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up?",okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{A.delete(`/api/accounts/${r._id}/followups/${t}`).then(()=>{j.success("Follow-up deleted"),h(),a()}).catch(()=>j.error("Failed to delete follow-up"))}})},Y=T().format("YYYY-MM-DD"),O=[...y].sort((t,c)=>new Date(c.date)-new Date(t.date)),_=O.filter(t=>T(t.date).format("YYYY-MM-DD")===Y),R=O.filter(t=>T(t.date).isAfter(Y,"day")),H=O.filter(t=>T(t.date).isBefore(Y,"day")),B=(t,c)=>{var S,q;return e.jsx(P.Item,{actions:[e.jsx("a",{onClick:()=>I(c),children:"Edit"},"edit"),e.jsx("a",{onClick:()=>L(c),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx($.Text,{strong:!0,children:T(t.date).format("DD-MM-YYYY")}),e.jsx("br",{}),t.note,e.jsx("br",{}),e.jsxs($.Text,{type:"secondary",children:["By ",((S=t.addedBy)==null?void 0:S.name)||((q=t.addedBy)==null?void 0:q.email)||"Unknown"]})]})})};return e.jsxs(E,{title:`Follow-ups: ${r==null?void 0:r.businessName}`,open:f,onClose:()=>{p(null),b(""),m(null),w()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(V,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:i,onChange:t=>m(t)}),e.jsx(ne,{rows:4,placeholder:"Enter follow-up note",value:g,onChange:t=>b(t.target.value)}),e.jsx(k,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},block:!0,onClick:C,loading:v,children:o===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(z,{}),e.jsxs(J,{defaultActiveKey:"today",children:[e.jsx(U,{tab:`Today's Follow-ups (${_.length})`,children:e.jsx(P,{dataSource:_,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No follow-ups for today"}})},"today"),e.jsx(U,{tab:`Upcoming Follow-ups (${R.length})`,children:e.jsx(P,{dataSource:R,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No upcoming follow-ups"}})},"upcoming"),e.jsx(U,{tab:`Past Follow-ups (${H.length})`,children:e.jsx(P,{dataSource:H,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No past follow-ups"}})},"past")]})]})};export{Ce as B,Te as F,Ie as N,Ne as R};
