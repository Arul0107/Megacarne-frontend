import{r as b,o as e,w as I,I as B,O as _,V as o,B as l,F as y,Q as z,U as a,t as f,T as E,K as L,W as N,X as c,Y as M,Z as U,z as G,P as K,A as O,$ as W}from"./index-BHNQ9zbu.js";import Y from"./html2canvas.esm-CBrSDip1.js";const{Text:r}=E,Z=({quotations:C,onAddNew:D,onEdit:S,onDelete:F,onSearch:q,onViewNotes:v})=>{var p;const[R,x]=b.useState(!1),[s,T]=b.useState(null),k=t=>{T(t),x(!0),o("Viewing quotation details")},j=async(t,n="download")=>{try{const d=o.loading("Generating PDF..."),g=document.getElementById(`quotation-${t._id}`);if(!g){o.error("Quotation content not found",{id:d});return}const i=g.cloneNode(!0);i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="210mm",i.style.background="white",i.style.zIndex="-1",i.style.display="block",document.body.appendChild(i),await new Promise(m=>setTimeout(m,200));const h=await Y(i,{scale:2,useCORS:!0}),A=h.toDataURL("image/png"),u=new W("p","mm","a4"),w=u.internal.pageSize.getWidth(),Q=h.height*w/h.width;if(u.addImage(A,"PNG",0,0,w,Q),n==="download")u.save(`${t.quotationNumber||"quotation"}.pdf`),o.success("PDF downloaded successfully",{id:d});else{const m=u.output("blob"),V=URL.createObjectURL(m);window.open(V,"_blank"),o.success("PDF preview opened",{id:d})}document.body.removeChild(i)}catch(d){console.error(d),o.error("Failed to generate PDF")}},P=t=>{F(t)},$=[{title:"Quotation #",dataIndex:"quotationNumber",render:t=>e.jsx(f,{color:"blue",children:t})},{title:"Business",dataIndex:"businessName"},{title:"Customer",dataIndex:"customerName"},{title:"Latest Note",dataIndex:"notes",render:t=>{if(t&&t.length>0){const n=t[t.length-1],d=n.text.length>30?`${n.text.substring(0,30)}...`:n.text;return e.jsx(c,{title:n.text,children:e.jsx(r,{type:"secondary",children:d})})}return e.jsx(r,{type:"secondary",italic:!0,children:"No notes"})}},{title:"Total (₹)",dataIndex:"total",render:t=>e.jsxs(r,{strong:!0,style:{color:"#52c41a"},children:["₹",t.toFixed(2)]})},{title:"Date",dataIndex:"date"},{title:"Actions",render:(t,n)=>e.jsxs(I,{children:[e.jsx(c,{title:"View Invoice",children:e.jsx(l,{icon:e.jsx(N,{}),onClick:()=>k(n)})}),e.jsx(c,{title:"Download PDF",children:e.jsx(l,{icon:e.jsx(M,{}),onClick:()=>j(n,"download")})}),e.jsx(c,{title:"Notes",children:e.jsx(l,{icon:e.jsx(U,{}),onClick:()=>{v(n),o("Viewing notes")}})}),e.jsx(c,{title:"Edit",children:e.jsx(l,{icon:e.jsx(G,{}),onClick:()=>{S(n),o("Editing quotation")}})}),e.jsx(K,{title:"Delete this quotation?",onConfirm:()=>P(n._id),okText:"Yes",cancelText:"No",children:e.jsx(c,{title:"Delete",children:e.jsx(l,{icon:e.jsx(O,{}),danger:!0})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs(I,{style:{marginBottom:16,justifyContent:"space-between",width:"100%"},children:[e.jsx(B.Search,{placeholder:"Search...",onChange:t=>{q(t.target.value),o("Searching...")},style:{width:300},prefix:e.jsx(_,{})}),e.jsx(l,{type:"primary",onClick:()=>{D(),o("Creating new quotation")},children:"+ New Quotation"})]}),e.jsx(y,{columns:$,dataSource:C,rowKey:"_id"}),e.jsx(z,{title:"Quotation Details",open:R,onCancel:()=>x(!1),footer:[e.jsx(l,{icon:e.jsx(N,{}),onClick:()=>j(s,"view"),children:"View PDF"},"view"),e.jsx(l,{onClick:()=>x(!1),children:"Close"},"close")],width:900,children:s&&e.jsxs("div",{id:`quotation-${s._id}`,children:[e.jsxs(a,{column:2,bordered:!0,size:"small",children:[e.jsx(a.Item,{label:"Quotation Number",children:e.jsx(f,{color:"blue",children:s.quotationNumber})}),e.jsx(a.Item,{label:"Date",children:s.date}),e.jsx(a.Item,{label:"Business Name",children:s.businessName}),e.jsx(a.Item,{label:"Customer Name",children:s.customerName}),e.jsx(a.Item,{label:"GSTIN",span:2,children:e.jsx(r,{code:!0,children:s.gstin||"N/A"})}),e.jsx(a.Item,{label:"Business Info",span:2,children:e.jsx(r,{style:{whiteSpace:"pre-wrap"},children:s.businessInfo||"N/A"})}),e.jsx(a.Item,{label:"Customer Address",span:2,children:e.jsx(r,{style:{whiteSpace:"pre-wrap"},children:s.customerAddress||"N/A"})}),e.jsx(a.Item,{label:"Total Amount",span:2,children:e.jsxs(r,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:["₹",(s.total||0).toFixed(2)]})})]}),((p=s.items)==null?void 0:p.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{orientation:"left",children:"Items"}),e.jsx(y,{dataSource:s.items,columns:[{title:"Description",dataIndex:"description",ellipsis:!0},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center"},{title:"Qty",dataIndex:"quantity",width:80,align:"center"},{title:"Rate (₹)",dataIndex:"rate",width:120,align:"right",render:t=>`₹${(t||0).toFixed(2)}`},{title:"Amount (₹)",width:120,align:"right",render:(t,n)=>e.jsxs(r,{strong:!0,children:["₹",(n.quantity*n.rate).toFixed(2)]})}],pagination:!1,size:"small",rowKey:(t,n)=>n,bordered:!0})]})]})})]})};export{Z as default};
