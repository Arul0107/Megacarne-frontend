import{r as a,p as e,B as u,s as i}from"./index-DO2xjt6F.js";import{i as h}from"./axios-0yhrvgHk.js";import{R as me,E as pe}from"./jspdf.es.min-CafCr0QM.js";import he from"./html2canvas.esm-CBrSDip1.js";import{B as xe,N as fe,F as je,S as ye}from"./FollowUpDrawer-cVq4peM5.js";import{C as R,T as M}from"./index-BqrCpxkO.js";import{T as ge}from"./index-c71wm61D.js";import{R as E}from"./PlusOutlined-CozxblFd.js";import{I as Ce}from"./index-Bsc_TH0P.js";import{R as ve}from"./TextArea-BGWnTIhk.js";import{F as V,R as we}from"./Table-ytN7lPLD.js";import{E as P}from"./index-Dr8C4fpI.js";import{M as B}from"./index-Ct-tprs0.js";import{R as be}from"./MessageOutlined-DxjfJFqs.js";import{T as y}from"./index-B1nrcjBb.js";import"./index-xsH4HHeE.js";import"./index-DrHZk4bw.js";import"./row-CodefCjq.js";import"./index-0HGn5QE1.js";import"./context-D0XoKNUb.js";import"./useClosable-C4HlJzLH.js";import"./extendsObject-78o_rR5W.js";import"./index-CYt6p7Zn.js";import"./index-CneINHzn.js";import"./index-DtYsO9Lt.js";import"./index-B6-Yjovu.js";import"./index-Cx609xem.js";const{Title:Se}=ge,{TabPane:U}=M,x="/api/accounts",Ze=()=>{const[O,f]=a.useState(!1),[l,g]=a.useState(null),[S,K]=a.useState(""),[W,q]=a.useState("active"),[z,C]=a.useState(!1),[m,G]=a.useState(null),[N,H]=a.useState(null),[T,Y]=a.useState([]),[J,A]=a.useState(!1),[Q,I]=a.useState(!1),[v,k]=a.useState(null),[j,r]=a.useState(!1),[X,w]=a.useState(!1),[p,Z]=a.useState(null),c=()=>{r(!0),h.get(x).then(t=>{const s=t.data.filter(n=>!n.isCustomer);Y(s),i.success("Leads loaded successfully")}).catch(()=>i.error("Failed to load leads")).finally(()=>r(!1))};a.useEffect(()=>{c()},[]);const ee=async t=>{try{const s=i.loading("Generating Lead PDF..."),n=document.getElementById(`lead-${t._id}`);if(!n){i.error("Lead content not found",{id:s});return}const o=n.cloneNode(!0);o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="210mm",o.style.background="white",o.style.zIndex="-1",o.style.display="block",document.body.appendChild(o),await new Promise(ue=>setTimeout(ue,200));const d=await he(o,{scale:2,useCORS:!0}),ce=d.toDataURL("image/png"),b=new pe("p","mm","a4"),D=b.internal.pageSize.getWidth(),de=d.height*D/d.width;b.addImage(ce,"PNG",0,0,D,de),b.save(`${t.businessName||"lead"}.pdf`),i.success("PDF downloaded",{id:s}),document.body.removeChild(o)}catch(s){console.error(s),i.error("Failed to generate PDF")}},te=t=>{r(!0),(l!=null&&l._id?h.put(`${x}/${l._id}`,t):h.post(x,t)).then(()=>{i.success(`Account ${l!=null&&l._id?"updated":"created"} successfully`),c()}).catch(()=>{i.error(`Failed to ${l!=null&&l._id?"update":"create"} account`)}).finally(()=>{f(!1),g(null),r(!1)})},se=t=>{g(t),f(!0)},ne=t=>{k(t),A(!0)},oe=t=>{k(t),I(!0)},ae=(t,s)=>{G(s),H(t?"Active":"Inactive"),C(!0)},ie=()=>{r(!0);const t={...m,status:N};h.put(`${x}/${m._id}`,t).then(()=>{i.success("Status updated"),c()}).catch(()=>i.error("Failed to update status")).finally(()=>{C(!1),r(!1)})},le=t=>{Z(t),w(!0)},re=()=>{r(!0),h.put(`${x}/${p._id}`,{...p,isCustomer:!0}).then(()=>{i.success("Converted to customer"),c()}).catch(()=>i.error("Failed to convert")).finally(()=>{w(!1),r(!1)})},F=T.filter(t=>{var n,o,d;const s=S.toLowerCase();return((n=t.businessName)==null?void 0:n.toLowerCase().includes(s))||((o=t.contactName)==null?void 0:o.toLowerCase().includes(s))||((d=t.email)==null?void 0:d.toLowerCase().includes(s))}),L=F.filter(t=>t.status==="Active"),_=F.filter(t=>t.status==="Inactive"),$=[{title:"Sno.",render:(t,s,n)=>n+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(y,{color:"red",children:"Hot"});case"Warm":return e.jsx(y,{color:"orange",children:"Warm"});case"Cold":return e.jsx(y,{color:"blue",children:"Cold"});default:return e.jsx(y,{children:"Unknown"})}}},{title:"Latest Note",render:(t,s)=>{var o;const n=(o=s.notes)==null?void 0:o.at(-1);return n?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:n.timestamp}),e.jsx("br",{}),n.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsxs("span",{style:{color:s.status==="Inactive"?"red":"inherit"},children:[e.jsx(ye,{checked:s.status==="Active",onChange:n=>ae(n,s),checkedChildren:"Active",unCheckedChildren:"Inactive"}),e.jsx("span",{style:{marginLeft:8},children:s.status})]})},{title:"Actions",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx(u,{icon:e.jsx(we,{}),onClick:()=>se(s),type:"link"}),e.jsx(u,{icon:e.jsx(be,{}),onClick:()=>ne(s),type:"link"}),e.jsx(u,{icon:e.jsx(E,{}),onClick:()=>oe(s),type:"link",title:"Add Follow-up"}),e.jsx(u,{icon:e.jsx(me,{}),onClick:()=>ee(s),type:"link",title:"Download PDF"}),!s.isCustomer&&e.jsx(u,{type:"link",style:{color:"green"},onClick:()=>le(s),children:"Convert to Customer"})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(R,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx(Se,{level:4,children:"Leads"}),e.jsx(u,{type:"primary",icon:e.jsx(E,{}),onClick:()=>{g(null),f(!0)},children:"Add Lead"})]}),e.jsx(Ce,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(ve,{}),value:S,onChange:t=>K(t.target.value),style:{width:400,marginBottom:16}}),e.jsxs(M,{activeKey:W,onChange:q,children:[e.jsx(U,{tab:`Active (${L.length})`,children:e.jsx(V,{columns:$,dataSource:L,pagination:!1,rowKey:"_id",loading:j,locale:{emptyText:e.jsx(P,{description:"No active leads"})}})},"active"),e.jsx(U,{tab:`Inactive (${_.length})`,children:e.jsx(V,{columns:$,dataSource:_,pagination:!1,rowKey:"_id",loading:j,locale:{emptyText:e.jsx(P,{description:"No inactive leads"})}})},"inactive")]})]}),e.jsx(xe,{visible:O,onClose:()=>f(!1),onSave:te,initialValues:l}),e.jsx(B,{title:"Confirm Status Change",open:z,onOk:ie,onCancel:()=>C(!1),okText:"Yes",cancelText:"No",confirmLoading:j,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:m==null?void 0:m.businessName})," to ",e.jsx("strong",{children:N}),"?"]})}),e.jsxs(B,{title:"Confirm Conversion",open:X,onOk:re,onCancel:()=>w(!1),okText:"Yes, Convert",cancelText:"Cancel",confirmLoading:j,children:[e.jsxs("p",{children:["Are you sure you want to convert ",e.jsx("strong",{children:p==null?void 0:p.businessName})," to a customer?"]}),e.jsx("p",{children:"This action cannot be undone."})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{visible:J,onClose:()=>A(!1),account:v,refreshAccounts:c}),e.jsx(je,{visible:Q,onClose:()=>I(!1),account:v,refreshAccounts:c})]}),T.map(t=>{var s;return e.jsx("div",{id:`lead-${t._id}`,style:{display:"none"},children:e.jsxs(R,{title:`Lead: ${t.businessName}`,bordered:!1,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Name:"})," ",t.contactName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",t.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"}),e.jsx("br",{}),((s=t.addressLines)==null?void 0:s.join(", "))||"N/A"]}),e.jsx("p",{children:e.jsx("strong",{children:"Notes:"})}),t.notes&&t.notes.length>0?t.notes.map((n,o)=>e.jsxs("p",{children:[e.jsx("small",{style:{color:"#999"},children:n.timestamp}),e.jsx("br",{}),n.text]},o)):e.jsx("em",{children:"No notes available"})]})},t._id)})]})};export{Ze as default};
