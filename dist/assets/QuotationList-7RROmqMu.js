import{r as b,p as e,q as w,V as r,B as d,T as c}from"./index-DO2xjt6F.js";import{R as y,E as V}from"./jspdf.es.min-CafCr0QM.js";import _ from"./html2canvas.esm-CBrSDip1.js";import{I as z,R as E}from"./index-Bsc_TH0P.js";import{R as q}from"./TextArea-BGWnTIhk.js";import{F as u,R as M}from"./Table-ytN7lPLD.js";import{M as G}from"./index-Ct-tprs0.js";import{D as s}from"./index-BCkK2zsg.js";import{T as p}from"./index-B1nrcjBb.js";import{T as K}from"./index-c71wm61D.js";import{D as N}from"./index-CneINHzn.js";import{R as L}from"./MessageOutlined-DxjfJFqs.js";import{P as W}from"./index-eu6zXQoe.js";import{R as H}from"./DeleteOutlined-cXOMvh7W.js";import"./index-Dr8C4fpI.js";import"./index-Cx609xem.js";import"./extendsObject-78o_rR5W.js";import"./context-D0XoKNUb.js";import"./useClosable-C4HlJzLH.js";const{Text:l}=K,he=({quotations:j,onAddNew:S,onEdit:D,onDelete:C,onSearch:F,onViewNotes:A})=>{var I;const[R,m]=b.useState(!1),[o,T]=b.useState(null),$=t=>{T(t),m(!0),r("Viewing quotation details")},g=async t=>{try{const i=r.loading("Generating PDF..."),a=document.getElementById(`quotation-${t._id}`);if(!a){r.error("Quotation content not found",{id:i});return}const n=a.cloneNode(!0);n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="210mm",n.style.background="white",n.style.zIndex="-1",n.style.display="block",document.body.appendChild(n),await new Promise(B=>setTimeout(B,200));const x=await _(n,{scale:2,useCORS:!0}),P=x.toDataURL("image/png"),h=new V("p","mm","a4"),f=h.internal.pageSize.getWidth(),v=x.height*f/x.width;h.addImage(P,"PNG",0,0,f,v),h.save(`${t.quotationNumber||"quotation"}.pdf`),r.success("PDF downloaded",{id:i}),document.body.removeChild(n)}catch(i){console.error(i),r.error("Failed to generate PDF")}},Q=t=>{C(t)},k=[{title:"Quotation #",dataIndex:"quotationNumber",render:t=>e.jsx(p,{color:"blue",children:t})},{title:"Business",dataIndex:"businessName"},{title:"Customer",dataIndex:"customerName"},{title:"Latest Note",dataIndex:"notes",render:t=>{if(t&&t.length>0){const i=t[t.length-1],a=i.text.length>30?`${i.text.substring(0,30)}...`:i.text;return e.jsx(c,{title:i.text,children:e.jsx(l,{type:"secondary",children:a})})}return e.jsx(l,{type:"secondary",italic:!0,children:"No notes"})}},{title:"Total (₹)",dataIndex:"total",render:t=>e.jsxs(l,{strong:!0,style:{color:"#52c41a"},children:["₹",t.toFixed(2)]})},{title:"Date",dataIndex:"date"},{title:"Actions",render:(t,i)=>e.jsxs(w,{children:[e.jsx(c,{title:"View",children:e.jsx(d,{icon:e.jsx(E,{}),onClick:()=>$(i)})}),e.jsx(c,{title:"Download PDF",children:e.jsx(d,{icon:e.jsx(y,{}),onClick:()=>g(i)})}),e.jsx(c,{title:"Notes",children:e.jsx(d,{icon:e.jsx(L,{}),onClick:()=>{A(i),r("Viewing notes")}})}),e.jsx(c,{title:"Edit",children:e.jsx(d,{icon:e.jsx(M,{}),onClick:()=>{D(i),r("Editing quotation")}})}),e.jsx(W,{title:"Delete this quotation?",onConfirm:()=>Q(i._id),okText:"Yes",cancelText:"No",children:e.jsx(c,{title:"Delete",children:e.jsx(d,{icon:e.jsx(H,{}),danger:!0})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs(w,{style:{marginBottom:16,justifyContent:"space-between",width:"100%"},children:[e.jsx(z.Search,{placeholder:"Search...",onChange:t=>{F(t.target.value),r("Searching...")},style:{width:300},prefix:e.jsx(q,{})}),e.jsx(d,{type:"primary",onClick:()=>{S(),r("Creating new quotation")},children:"+ New Quotation"})]}),e.jsx(u,{columns:k,dataSource:j,rowKey:"_id"}),e.jsx(G,{title:"Quotation Details",open:R,onCancel:()=>m(!1),footer:[e.jsx(d,{icon:e.jsx(y,{}),onClick:()=>g(o),children:"Download PDF"},"download"),e.jsx(d,{onClick:()=>m(!1),children:"Close"},"close")],width:900,children:o&&e.jsxs("div",{id:`quotation-${o._id}`,children:[e.jsxs(s,{column:2,bordered:!0,size:"small",children:[e.jsx(s.Item,{label:"Quotation Number",children:e.jsx(p,{color:"blue",children:o.quotationNumber})}),e.jsx(s.Item,{label:"Date",children:o.date}),e.jsx(s.Item,{label:"Business Name",children:o.businessName}),e.jsx(s.Item,{label:"Customer Name",children:o.customerName}),e.jsx(s.Item,{label:"GSTIN",span:2,children:e.jsx(l,{code:!0,children:o.gstin||"N/A"})}),e.jsx(s.Item,{label:"Business Info",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:o.businessInfo||"N/A"})}),e.jsx(s.Item,{label:"Customer Address",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:o.customerAddress||"N/A"})}),e.jsx(s.Item,{label:"Total Amount",span:2,children:e.jsxs(l,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:["₹",(o.total||0).toFixed(2)]})})]}),((I=o.items)==null?void 0:I.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(N,{orientation:"left",children:"Items"}),e.jsx(u,{dataSource:o.items,columns:[{title:"Description",dataIndex:"description",ellipsis:!0},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center"},{title:"Qty",dataIndex:"quantity",width:80,align:"center"},{title:"Rate (₹)",dataIndex:"rate",width:120,align:"right",render:t=>`₹${(t||0).toFixed(2)}`},{title:"Amount (₹)",width:120,align:"right",render:(t,i)=>e.jsxs(l,{strong:!0,children:["₹",(i.quantity*i.rate).toFixed(2)]})}],pagination:!1,size:"small",rowKey:(t,i)=>i,bordered:!0})]})]})}),j.map(t=>{var i;return e.jsxs("div",{id:`quotation-${t._id}`,style:{display:"none"},children:[e.jsxs(s,{column:2,bordered:!0,size:"small",children:[e.jsx(s.Item,{label:"Quotation Number",children:e.jsx(p,{color:"blue",children:t.quotationNumber})}),e.jsx(s.Item,{label:"Date",children:t.date}),e.jsx(s.Item,{label:"Business Name",children:t.businessName}),e.jsx(s.Item,{label:"Customer Name",children:t.customerName}),e.jsx(s.Item,{label:"GSTIN",span:2,children:e.jsx(l,{code:!0,children:t.gstin||"N/A"})}),e.jsx(s.Item,{label:"Business Info",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:t.businessInfo||"N/A"})}),e.jsx(s.Item,{label:"Customer Address",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:t.customerAddress||"N/A"})}),e.jsx(s.Item,{label:"Total Amount",span:2,children:e.jsxs(l,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:["₹",(t.total||0).toFixed(2)]})})]}),((i=t.items)==null?void 0:i.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(N,{orientation:"left",children:"Items"}),e.jsx(u,{dataSource:t.items,columns:[{title:"Description",dataIndex:"description",ellipsis:!0},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center"},{title:"Qty",dataIndex:"quantity",width:80,align:"center"},{title:"Rate (₹)",dataIndex:"rate",width:120,align:"right",render:a=>`₹${(a||0).toFixed(2)}`},{title:"Amount (₹)",width:120,align:"right",render:(a,n)=>e.jsxs(l,{strong:!0,children:["₹",(n.quantity*n.rate).toFixed(2)]})}],pagination:!1,size:"small",rowKey:(a,n)=>n,bordered:!0})]})]},t._id)})]})};export{he as default};
