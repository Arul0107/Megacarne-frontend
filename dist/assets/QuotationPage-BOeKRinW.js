import{r as i,p as t,S as C,B as F,V as r}from"./index-OdYoXqOt.js";import{i as g}from"./axios-BVNKluDM.js";import I from"./QuotationForm-DE9jIuQY.js";import L from"./QuotationList-CirPXHjZ.js";import{F as S}from"./index-Dmc8TwUP.js";import{D as b}from"./index-DZrLd_wq.js";import{I as V}from"./index-CyF63g_w.js";import{R as T}from"./SendOutlined-D-aOcye6.js";import{T as E}from"./index-CE07GngT.js";import"./index-BBliv2OJ.js";import"./TextArea-BBpwzQlG.js";import"./index-D-Ar94d9.js";import"./index-BEcng5S8.js";import"./index-6f6jfSv1.js";import"./index-BMSFUza1.js";import"./index-BsgGtD0b.js";import"./index-RXJb7B3c.js";import"./DeleteOutlined-D7u6MCin.js";import"./SaveOutlined-wxawlFaF.js";import"./jspdf.es.min-BLmP08Uy.js";import"./html2canvas.esm-CBrSDip1.js";import"./Table-BUjwp330.js";import"./index-Bq00u7W1.js";import"./index-9Rv8uXPb.js";import"./context-B06BlMR-.js";import"./index-Bzs9NVYI.js";import"./PrinterOutlined-D9kC_CVs.js";import"./MessageOutlined-FcG8y4wq.js";import"./index-BTx-wPRv.js";const{TextArea:A}=V,{Title:$,Text:q}=E,k=({visible:w,onClose:N,quotation:a,refreshQuotations:d})=>{const[l]=S.useForm(),[n,h]=i.useState(!1),[m,x]=i.useState([]);i.useEffect(()=>{x((a==null?void 0:a.notes)||[])},[a]);const y=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},p=async o=>{try{h(!0);const c=r.loading("Adding note..."),e={text:o.note,timestamp:new Date().toLocaleString(),author:y()},s=[...m,e];await g.put(`/api/quotations/${a._id}`,{notes:s}),x(s),r.success("Note added",{id:c}),l.resetFields(),d()}catch{r.error("Failed to add note")}finally{h(!1)}},j=()=>m.length?m.map((o,c)=>{const e=c>0?m[c-1]:null,s=new Date(o.timestamp).toDateString(),u=e?new Date(e.timestamp).toDateString():null,f=s!==u;return t.jsxs("div",{children:[f&&t.jsx("div",{className:"note-date-header",children:s}),t.jsxs("div",{className:"note-bubble",children:[t.jsxs("div",{className:"note-meta",children:[o.author,"    ",o.timestamp]}),t.jsx("div",{className:"note-text",children:o.text})]})]},c)}):t.jsx(q,{type:"secondary",children:"No notes added yet"});return t.jsx(b,{title:t.jsxs($,{level:4,style:{margin:0},children:["Notes for Quotation #",a==null?void 0:a.quotationNumber]}),open:w,onClose:N,width:440,destroyOnClose:!0,children:t.jsxs(C,{spinning:n,children:[t.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:j()}),t.jsxs(S,{form:l,layout:"vertical",onFinish:p,children:[t.jsx(S.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:t.jsx(A,{rows:3,placeholder:"Type your note here"})}),t.jsx(F,{type:"primary",htmlType:"submit",loading:n,block:!0,icon:t.jsx(T,{}),children:"Add Note"})]})]})})},pt=()=>{const[w,N]=i.useState([]),[a,d]=i.useState(!1),[l,n]=i.useState(null),[h,m]=i.useState([]),[x,y]=i.useState(!1),p=async()=>{const e=r.loading("Loading quotations...");try{const s=await g.get("/api/quotations");N(s.data),r.success("Quotations loaded successfully",{id:e})}catch{r.error("Failed to load quotations",{id:e})}};i.useEffect(()=>{p()},[]);const j=async e=>{const s=r.loading("Saving quotation...");try{l?await g.put(`/api/quotations/${l._id}`,e):await g.post("/api/quotations",e),r.success("Quotation saved successfully!",{id:s}),p(),d(!1),n(null)}catch(u){r.error(`Failed to save quotation: ${u.message}`,{id:s})}},o=async e=>{const s=r.loading("Deleting quotation...");try{await g.delete(`/api/quotations/${e}`),r.success("Quotation deleted successfully",{id:s}),p()}catch(u){r.error(`Failed to delete quotation: ${u.message}`,{id:s})}},c=e=>{const s=e.toLowerCase(),u=w.filter(f=>{var v,D,Q;return((v=f.businessName)==null?void 0:v.toLowerCase().includes(s))||((D=f.customerName)==null?void 0:D.toLowerCase().includes(s))||((Q=f.quotationNumber)==null?void 0:Q.toLowerCase().includes(s))});m(u)};return t.jsxs(t.Fragment,{children:[t.jsx(L,{quotations:h.length?h:w,onAddNew:()=>{n(null),d(!0)},onEdit:e=>{n(e),d(!0)},onDelete:o,onSearch:c,onViewNotes:e=>{n(e),y(!0)}}),t.jsx(b,{open:a,title:l?"Edit Quotation":"Create Quotation",onClose:()=>{d(!1),n(null)},width:720,destroyOnClose:!0,children:t.jsx(I,{initialValues:l,onSave:j,onCancel:()=>{d(!1),n(null)}})}),t.jsx(k,{visible:x,onClose:()=>{y(!1),n(null)},quotation:l,refreshQuotations:p})]})};export{pt as default};
