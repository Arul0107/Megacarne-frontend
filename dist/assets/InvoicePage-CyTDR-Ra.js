import{r as i,p as m}from"./index-rXvhZNTH.js";import{i as d}from"./axios-Bm-lSUPK.js";import{I as D,N as E,s as c}from"./InvoiceList-CeNCvI_K.js";import F from"./InvoiceForm-DP03lLAB.js";import{D as L}from"./index-BayOoT50.js";import"./index-D7H86iUr.js";import"./TextArea-3J4edi_n.js";import"./jspdf.es.min-g2OG8rLP.js";import"./jspdf.plugin.autotable-CtA5BUKo.js";import"./index-3sLnf9jM.js";import"./index-B9-Hx0_q.js";import"./SendOutlined-CY6_JUTK.js";import"./index-ZWmvqXl5.js";import"./Table-BwOgM8_s.js";import"./index-Bnx2lPCu.js";import"./index-DTmrheXX.js";import"./index-CyKEuRpI.js";import"./context-Dz8WOss1.js";import"./index-BK_ERSvc.js";import"./index-BhMlXXyN.js";import"./index-DZFqpOxC.js";import"./index-C8nEV0GE.js";import"./index-Cl72t5T4.js";import"./index-DE6Leb1o.js";import"./index-BwQLOHLB.js";import"./PrinterOutlined-C3YqVgPT.js";import"./MessageOutlined-BbvgvZgG.js";import"./DollarOutlined-BeuKTvYH.js";import"./DeleteOutlined-Kk6N9w6r.js";import"./index-By4lL35H.js";import"./index-5ADJWpW3.js";import"./MinusCircleOutlined-CC6ZaRof.js";const me=()=>{const[u,y]=i.useState([]),[N,l]=i.useState(!1),[s,a]=i.useState(null),[f,S]=i.useState([]),[C,h]=i.useState(!1),n=async()=>{try{const e=await d.get("/api/invoices");y(e.data)}catch{c.error("Failed to fetch invoices")}};i.useEffect(()=>{n()},[]);const x=async e=>{var r,p,o;try{console.log("Invoice data being sent:",e),s&&s._id?(await d.put(`/api/invoices/${s._id}`,e),c.success("Invoice updated successfully")):(await d.post("/api/invoices",e),c.success("Invoice created successfully")),n(),l(!1),a(null)}catch(t){console.error(t),console.error("Server error response:",(r=t==null?void 0:t.response)==null?void 0:r.data),c.error(((o=(p=t==null?void 0:t.response)==null?void 0:p.data)==null?void 0:o.message)||"Failed to save invoice")}},b=e=>{a(e),l(!0)},g=async e=>{try{await d.delete(`/api/invoices/${e}`),c.success("Invoice deleted"),n()}catch{c.error("Delete failed")}},j=e=>{const r=e.toLowerCase(),p=u.filter(o=>{var t,v,w;return((t=o==null?void 0:o.businessName)==null?void 0:t.toLowerCase().includes(r))||((v=o==null?void 0:o.invoiceNumber)==null?void 0:v.toLowerCase().includes(r))||((w=o==null?void 0:o.customerName)==null?void 0:w.toLowerCase().includes(r))});S(p)},I=()=>{l(!1),a(null)};return m.jsxs("div",{style:{padding:24},children:[m.jsx(D,{invoices:f.length>0?f:u,onAddNew:()=>{a(null),l(!0)},onEdit:b,onDelete:g,onSearch:j,refreshInvoices:n,onViewNotes:e=>{a(e),h(!0)}}),m.jsx(L,{title:s?"Edit Invoice":"Create Invoice",open:N,onClose:I,width:"80%",destroyOnClose:!0,children:m.jsx(F,{onCancel:I,onSave:x,initialValues:s||{invoiceType:"Invoice",items:[],taxRate:18,discountAmount:0,businessName:"",customerName:"",customerAddress:"",customerGSTIN:"",companyGSTIN:"",companyName:"",companyAddress:"",contactPerson:"",contactNumber:"",paymentTerms:""}})}),s&&m.jsx(E,{visible:C,onClose:()=>h(!1),invoice:s,refreshInvoices:n})]})};export{me as default};
