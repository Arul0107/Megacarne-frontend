import{r as l,n as e,S as E,o as T,B as N,V as o}from"./index-DD76fs-h.js";import{a as x}from"./index-xsH4HHeE.js";import L from"./QuotationForm-C5oCpMy1.js";import R from"./QuotationList-BE_m7-RP.js";import{F as v}from"./index-CVolLEbg.js";import{D as b}from"./index-CKDW8ldq.js";import{L as D}from"./index-BvxoHc-c.js";import{T as V}from"./index-BjXlmfRw.js";import{I as q}from"./index-Bz8HKjRU.js";import{R as z}from"./index-Cyejg2uk.js";import{R as A}from"./TextArea-CMtgeMII.js";import{R as k}from"./Table-Bd4A0fxf.js";import{P}from"./index-DfZabzEr.js";import{R as _}from"./DeleteOutlined-QhKYsw_D.js";import{R as B}from"./SendOutlined-C8Sl0Eao.js";import"./index-Dx7S66AB.js";import"./index-CFl-p7rD.js";import"./PlusOutlined-M3Xgh6eT.js";import"./row-qnhl_Xtb.js";import"./index-BelEbI9C.js";import"./index-C8gyv-gM.js";import"./SaveOutlined-e6ymyoOE.js";import"./jspdf.es.min-Csoo9Yjq.js";import"./html2canvas.esm-CBrSDip1.js";import"./index-keQBqU8z.js";import"./InfoCircleFilled-AVuMim3v.js";import"./context-CGg-q3Eq.js";import"./useClosable-DEE2SN-J.js";import"./index-C70Jm7S8.js";import"./index-C7mdu0c-.js";import"./MessageOutlined-Wt4EX-mr.js";import"./index-ZtJ4PVaR.js";const{TextArea:$}=q,{Text:O}=V,Y=({visible:S,onClose:F,quotation:n,refreshQuotations:c})=>{const[u]=v.useForm(),[m,d]=l.useState(!1),[I,j]=l.useState(null),[w,p]=l.useState(""),[h,y]=l.useState([]);l.useEffect(()=>{y((n==null?void 0:n.notes)||[])},[n]);const s=async r=>{try{d(!0);const t=o.loading("Adding note..."),i={text:r.note,timestamp:new Date().toLocaleString()},Q=[...h,i];await x.put(`/api/quotations/${n._id}`,{notes:Q}),y(Q),o.success("Note added successfully",{id:t}),u.resetFields(),c()}catch(t){console.error(t),o.error("Failed to add note")}finally{d(!1)}},a=async r=>{try{d(!0);const t=o.loading("Deleting note..."),i=[...h];i.splice(r,1),await x.put(`/api/quotations/${n._id}`,{notes:i}),y(i),o.success("Note deleted successfully",{id:t}),c()}catch(t){console.error(t),o.error("Failed to delete note")}finally{d(!1)}},g=(r,t)=>{j(t),p(r.text)},f=async r=>{try{d(!0);const t=o.loading("Updating note..."),i=[...h];i[r]={...i[r],text:w,timestamp:new Date().toLocaleString()},await x.put(`/api/quotations/${n._id}`,{notes:i}),y(i),o.success("Note updated successfully",{id:t}),j(null),c()}catch(t){console.error(t),o.error("Failed to update note")}finally{d(!1)}},C=()=>{j(null),p("")};return e.jsx(b,{title:`Notes for Quotation #${n==null?void 0:n.quotationNumber}`,open:S,onClose:F,width:400,destroyOnClose:!0,children:e.jsxs(E,{spinning:m,children:[e.jsx("div",{style:{maxHeight:"496px",overflowY:"auto"},children:e.jsx(D,{size:"small",dataSource:h,locale:{emptyText:"No notes added yet"},renderItem:(r,t)=>e.jsx(D.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},actions:[I===t?e.jsxs(T,{children:[e.jsx(N,{size:"small",icon:e.jsx(z,{style:{color:"#52c41a"}}),onClick:()=>f(t),type:"text"}),e.jsx(N,{size:"small",icon:e.jsx(A,{style:{color:"#ff4d4f"}}),onClick:C,type:"text"})]}):e.jsxs(T,{children:[e.jsx(N,{size:"small",icon:e.jsx(k,{style:{color:"#1890ff"}}),onClick:()=>g(r,t),type:"text"}),e.jsx(P,{title:"Are you sure to delete this note?",onConfirm:()=>a(t),okText:"Yes",cancelText:"No",children:e.jsx(N,{size:"small",icon:e.jsx(_,{style:{color:"#ff4d4f"}}),type:"text"})})]})],children:e.jsx(D.Item.Meta,{description:e.jsxs(e.Fragment,{children:[e.jsx(O,{type:"secondary",style:{fontSize:12},children:r.timestamp}),I===t?e.jsx($,{value:w,onChange:i=>p(i.target.value),rows:2,style:{marginTop:8},autoFocus:!0}):e.jsx("div",{style:{marginTop:4,whiteSpace:"pre-wrap"},children:r.text})]})})},t)})}),e.jsxs(v,{form:u,layout:"vertical",style:{marginTop:16},onFinish:s,children:[e.jsx(v.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx($,{rows:3,placeholder:"Type your note here"})}),e.jsx(N,{type:"primary",htmlType:"submit",loading:m,block:!0,icon:e.jsx(B,{}),children:"Add Note"})]})]})})},Ie=()=>{const[S,F]=l.useState([]),[n,c]=l.useState(!1),[u,m]=l.useState(null),[d,I]=l.useState([]),[j,w]=l.useState(!1),p=()=>{const s=o.loading("Loading quotations...");x.get("/api/quotations").then(a=>{F(a.data),o.success("Quotations loaded successfully",{id:s})}).catch(()=>{o.error("Failed to load quotations",{id:s})})};l.useEffect(()=>{p()},[]);const h=s=>{const a=o.loading("Saving quotation...");(u?x.put(`/api/quotations/${u._id}`,s):x.post("/api/quotations",s)).then(()=>{p(),o.success("Quotation saved successfully!",{id:a}),c(!1),m(null)}).catch(f=>{o.error(`Failed to save quotation: ${f.message}`,{id:a})})},y=s=>{const a=s.toLowerCase(),g=S.filter(f=>{var C,r,t;return((C=f.businessName)==null?void 0:C.toLowerCase().includes(a))||((r=f.customerName)==null?void 0:r.toLowerCase().includes(a))||((t=f.quotationNumber)==null?void 0:t.toLowerCase().includes(a))});I(g)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{quotations:d.length?d:S,onAddNew:()=>c(!0),onEdit:s=>{m(s),c(!0)},onDelete:s=>{const a=o.loading("Deleting quotation...");x.delete(`/api/quotations/${s}`).then(()=>{p(),o.success("Quotation deleted successfully",{id:a})}).catch(g=>{o.error(`Failed to delete quotation: ${g.message}`,{id:a})})},onSearch:y,onViewNotes:s=>{m(s),w(!0)}}),e.jsx(b,{open:n,title:u?"Edit Quotation":"Create Quotation",onClose:()=>{c(!1),m(null)},width:720,destroyOnClose:!0,children:e.jsx(L,{initialValues:u,onCancel:()=>{c(!1),m(null)},onSave:h})}),e.jsx(Y,{visible:j,onClose:()=>w(!1),quotation:u,refreshQuotations:p})]})};export{Ie as default};
