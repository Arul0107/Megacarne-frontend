import{r as a,s as n,p as t,B as x,D as ce,M as r}from"./index-Bq7SEXuf.js";import{i as d,I as P}from"./axios-GhlsiOT5.js";import{R as re,E as le}from"./jspdf.es.min-zBOFm9dL.js";import ie from"./html2canvas.esm-CBrSDip1.js";import{B as ue,N as de,F as me,R as pe}from"./FollowUpDrawer-BkBDsWyG.js";import{C as he}from"./index-C_L1RLLK.js";import{a as E}from"./index-BOPJqWeZ.js";import{R as fe,T as M}from"./index-CbdXlDe3.js";import{F as xe,R as ge}from"./Table-Bf67WVZ7.js";import{E as ye}from"./index-gpSYoz0o.js";import{M as V}from"./index-D0lY9ADb.js";import{T as Ce,a as ve}from"./index-SmLCrNGy.js";import{R as we}from"./moment-CYyrXtnG.js";import{R as je}from"./MessageOutlined-DEnj2zof.js";import{R as Ae}from"./DeleteOutlined-DFLVsPO1.js";import"./index-BnkNshhY.js";import"./index-DadFFg_X.js";import"./context-B8wIWz00.js";import"./index-DF_iAJZB.js";import"./index-Dsy7Z7ff.js";import"./index-46gWX4pY.js";import"./index-JPHp6_-t.js";import"./index-BMaUSiUl.js";const{Title:be}=Ce,{TabPane:B}=M,m="/api/accounts",Ye=()=>{const[U,p]=a.useState(!1),[g,F]=a.useState(null),[y,O]=a.useState(""),[C,W]=a.useState("active"),[G,v]=a.useState(!1),[k,w]=a.useState(null),[j,A]=a.useState(null),[_,b]=a.useState([]),[H,D]=a.useState(!1),[z,N]=a.useState(!1),[I,R]=a.useState(null),[K,Y]=a.useState(0),[q,J]=a.useState(0);a.useEffect(()=>{i()},[C]);const i=async()=>{try{let e=`${m}/leads/active`,s=`${m}/customers`;const[o,u]=await Promise.all([d.get(e),d.get(s)]),c=o.data,l=u.data;Y(c.length),J(l.length),b(C==="active"?c:C==="customers"?l:[...c,...l])}catch(e){n.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e)}},Q=async e=>{var s;try{g?(await d.put(`${m}/${g._id}`,e),n.success("Account updated successfully!")):(await d.post(m,e),n.success("Account created successfully!")),p(!1),i()}catch(o){n.error("Failed to save account."),console.error("Save account error:",((s=o.response)==null?void 0:s.data)||o.message)}},X=e=>{F(e),p(!0)},Z=async e=>{var s;try{await d.delete(`${m}/${e}`),n.success("Account deleted successfully (soft delete)!"),i()}catch(o){n.error("Failed to delete account."),console.error("Delete account error:",((s=o.response)==null?void 0:s.data)||o.message)}},ee=e=>{R(e),D(!0)},te=e=>{R(e),N(!0)},T=(e,s)=>{w(s),A(e),v(!0)},se=async()=>{var e;try{const s={...k,isCustomer:j};await d.put(`${m}/${k._id}`,s),n.success(`Account status changed to ${j?"Customer":"Lead"}!`),i()}catch(s){n.error("Failed to update account status."),console.error("Status update error:",((e=s.response)==null?void 0:e.data)||s.message)}finally{v(!1),w(null),A(null)}},oe=()=>{v(!1),w(null),A(null)},ae=async e=>{const s=document.getElementById(`lead-${e._id}`);if(!s){n.error("PDF content not found.");return}n.loading("Generating PDF...",{id:"pdf-toast"});try{const o=await ie(s,{scale:2}),u=o.toDataURL("image/png"),c=new le("p","mm","a4"),l=210,L=297,h=o.height*l/o.width;let f=h,S=0;for(c.addImage(u,"PNG",0,S,l,h),f-=L;f>=0;)S=f-h,c.addPage(),c.addImage(u,"PNG",0,S,l,h),f-=L;c.save(`${e.businessName}-details.pdf`),n.success("PDF generated!",{id:"pdf-toast"})}catch(o){console.error("Error generating PDF:",o),n.error("Failed to generate PDF.",{id:"pdf-toast"})}},ne=[{title:"S.No",key:"sno",render:(e,s,o)=>o+1,width:60},{title:"Business Name",dataIndex:"businessName",key:"businessName",filterDropdown:({setSelectedKeys:e,selectedKeys:s,confirm:o,clearFilters:u})=>t.jsxs("div",{style:{padding:8},children:[t.jsx(P,{placeholder:"Search Business Name",value:s[0],onChange:c=>e(c.target.value?[c.target.value]:[]),onPressEnter:()=>o(),style:{marginBottom:8,display:"block"}}),t.jsx(x,{type:"primary",onClick:()=>o(),icon:t.jsx(E,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t.jsx(x,{onClick:()=>u(),size:"small",style:{width:90},children:"Reset"})]}),onFilter:(e,s)=>s.businessName.toLowerCase().includes(e.toLowerCase()),responsive:["xs","sm","md","lg"]},{title:"Contact Name",dataIndex:"contactName",key:"contactName",responsive:["md","lg"]},{title:"Email",dataIndex:"email",key:"email",responsive:["lg"]},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber",responsive:["md","lg"]},{title:"Lead Type",dataIndex:"type",key:"type",filters:[{text:"Hot",value:"Hot"},{text:"Warm",value:"Warm"},{text:"Cold",value:"Cold"}],onFilter:(e,s)=>s.type.indexOf(e)===0,responsive:["md","lg"]},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(ve,{color:e==="Active"?"green":"red",children:e}),filters:[{text:"Active",value:"Active"},{text:"Inactive",value:"Inactive"}],onFilter:(e,s)=>s.status.indexOf(e)===0,responsive:["sm","md","lg"]},{title:"Source Type",dataIndex:"sourceType",key:"sourceType",filters:[{text:"Direct",value:"Direct"},{text:"Facebook Referral",value:"Facebook Referral "},{text:"Google Ads",value:"Google Ads"},{text:"Website",value:"Website"},{text:"Cold Call",value:"Cold Call"},{text:"Other",value:"Other"}],onFilter:(e,s)=>{var o;return((o=s.sourceType)==null?void 0:o.indexOf(e))===0},responsive:["lg"]},{title:"Action",key:"action",width:80,render:(e,s)=>t.jsx(ce,{overlay:t.jsxs(r,{children:[t.jsx(r.Item,{icon:t.jsx(ge,{}),onClick:()=>X(s),children:"Edit Account"},"edit"),t.jsx(r.Item,{icon:t.jsx(je,{}),onClick:()=>ee(s),children:"View/Add Notes"},"notes"),t.jsx(r.Item,{icon:t.jsx(pe,{}),onClick:()=>te(s),children:"View/Add Follow-ups"},"followup"),t.jsx(r.Item,{icon:t.jsx(re,{}),onClick:()=>ae(s),children:"Generate PDF"},"generate-pdf"),s.isCustomer?t.jsx(r.Item,{onClick:()=>T(!1,s),children:"Change to Lead"},"change-to-lead"):t.jsx(r.Item,{onClick:()=>T(!0,s),children:"Change to Customer"},"change-to-customer"),t.jsx(r.Item,{icon:t.jsx(Ae,{}),danger:!0,onClick:()=>{V.confirm({title:"Delete Account",content:"Are you sure you want to delete this account? This action cannot be undone (soft delete).",okText:"Yes, Delete",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>Z(s._id)})},children:"Delete Account"},"delete")]}),trigger:["click"],children:t.jsx(x,{icon:t.jsx(we,{})})})}],$=_.filter(e=>e.businessName.toLowerCase().includes(y.toLowerCase())||e.contactName.toLowerCase().includes(y.toLowerCase()));return t.jsxs(he,{title:t.jsx(be,{level:2,children:"Manage Leads & Customers"}),children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[t.jsx(P,{placeholder:"Search by business or contact name",prefix:t.jsx(E,{}),style:{width:"100%",maxWidth:300},value:y,onChange:e=>O(e.target.value)}),t.jsx(x,{type:"primary",icon:t.jsx(fe,{}),onClick:()=>{F(null),p(!0)},children:"Add New Account"})]}),t.jsxs(M,{defaultActiveKey:"active",onChange:W,children:[t.jsx(B,{tab:`Active Leads (${K})`},"active"),t.jsx(B,{tab:`Customers (${q})`},"customers")]}),$.length>0?t.jsx(xe,{columns:ne,dataSource:$,rowKey:"_id",scroll:{x:"max-content"}}):t.jsx(ye,{description:"No accounts found."}),t.jsx(ue,{visible:U,onClose:()=>p(!1),onSave:Q,initialValues:g}),I&&t.jsxs(t.Fragment,{children:[t.jsx(de,{visible:H,onClose:()=>D(!1),account:I,refreshAccounts:i}),t.jsx(me,{visible:z,onClose:()=>N(!1),account:I,refreshAccounts:i})]}),t.jsx(V,{title:"Change Account Status",open:G,onOk:se,onCancel:oe,okText:"Yes",cancelText:"No",children:t.jsxs("p",{children:["Are you sure you want to change this account's status to ",j?"Customer":"Lead","?"]})})]})};export{Ye as default};
