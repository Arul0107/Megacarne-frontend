import{r as a,I as G,e as Q,an as n,x as s,H as Ne,B as C,S as Te,ao as Fe,ap as f}from"./index-t5rVtybA.js";import{i as h}from"./axios-tnHzrPy3.js";import{h as Ie,E as De,R as Pe}from"./html2canvas.esm-DSg8unsn.js";import{u as P,a as $e}from"./xlsx-CyWl6TWy.js";import{B as Ee,N as Re,F as Ve,R as ze}from"./FollowUpDrawer-DcMhaduk.js";import{C as Me}from"./index-HqdRO0mP.js";import{I as B}from"./index-C3SbKcBe.js";import{c as H}from"./TextArea-BasEnP5_.js";import{R as Ue}from"./PlusOutlined-CaKX0zvq.js";import{T as W}from"./index-C1Z6Zlef.js";import{F as _e}from"./Table-DRoRyLkd.js";import{E as Oe}from"./index-C9JDh5Qg.js";import{M as Be}from"./index-DZl2lsE-.js";import{T as He}from"./index-CKlYWjIK.js";import{T as Ge}from"./index-BMN95Eud.js";import{R as Qe}from"./EditOutlined-BeogT0LA.js";import{R as We}from"./MessageOutlined-CirgzO9o.js";import{P as qe}from"./index-DNd6prTs.js";import{R as Ye}from"./DeleteOutlined-DdstezQk.js";import"./index-DKyXNU95.js";import"./index-B6r09JUu.js";import"./context-CPH9Yf_c.js";import"./useClosable-Dv5ScLmI.js";import"./index-BxEfyn-m.js";import"./index-DC0_n4Wa.js";import"./moment-C5S46NFB.js";import"./index-q4sPJRMG.js";import"./dayjs.min-mMSNBr-8.js";import"./index-C0FeeXPN.js";import"./Pagination-DSK_3Iwp.js";import"./styleChecker-Cm9BPmqX.js";import"./addEventListener-5Sesl6IS.js";import"./index-CCGxcpAJ.js";import"./InfoCircleFilled-XxpULNiq.js";import"./ActionButton-BsySh9uh.js";import"./index-D71Xh94o.js";var Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},Je=function(u,d){return a.createElement(G,Q({},u,{ref:d,icon:Ke}))},Xe=a.forwardRef(Je),Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},et=function(u,d){return a.createElement(G,Q({},u,{ref:d,icon:Ze}))},tt=a.forwardRef(et);const{Title:st}=He,{TabPane:b}=W,y="/api/accounts",Mt=()=>{const[A,u]=a.useState(!1),[d,$]=a.useState(null),[j,q]=a.useState(""),[m,Y]=a.useState("all"),[K,k]=a.useState(!1),[E,L]=a.useState(null),[N,T]=a.useState(null),[J,x]=a.useState([]),[c,R]=a.useState([]),[X,V]=a.useState(!1),[Z,z]=a.useState(!1),[F,M]=a.useState(null),[ee,te]=a.useState(0),[se,oe]=a.useState(0),[ae,re]=a.useState(0),[ne,le]=a.useState(0),[ie,ce]=a.useState(0),[ue,de]=a.useState(0),[me,pe]=a.useState([]),[fe,U]=a.useState(!1),[he,g]=a.useState(!0),I=JSON.parse(localStorage.getItem("user")),xe=I==null?void 0:I.role,_=a.useRef(null);a.useEffect(()=>{(async()=>{g(!0);try{const t=await h.get(`${y}`);R(t.data),g(!1)}catch(t){n.error("Failed to fetch accounts."),console.error("Fetch accounts error:",t),g(!1)}})(),ge()},[]),a.useEffect(()=>{if(c.length>0){const e=c.filter(l=>l.status==="Active"),t=c.filter(l=>l.status==="Customer"),r=c.filter(l=>l.status==="Pipeline"),o=c.filter(l=>l.status==="Closed"),i=c.filter(l=>l.status==="Quotations");te(e.length),oe(t.length),re(r.length),le(o.length),ce(i.length),de(c.length),m==="active"?x(e):m==="customers"?x(t):m==="Pipeline"?x(r):m==="closed"?x(o):m==="quotations"?x(i):m==="all"&&x(c)}},[c,m]);const v=async()=>{g(!0);try{const e=await h.get(`${y}`);R(e.data),g(!1)}catch(e){n.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e),g(!1)}},ge=async()=>{U(!0);try{const e=await h.get("/api/users");pe(e.data)}catch(e){console.error("Error fetching users:",e),n.error("Failed to load users for assignment.")}finally{U(!1)}},Ce=async e=>{var t;try{const r={...e};d?(await h.put(`${y}/${d._id}`,r),n.success("Account updated successfully!")):(await h.post(y,r),n.success("Account created successfully!")),u(!1),v()}catch(r){n.error("Failed to save account."),console.error("Save account error:",((t=r.response)==null?void 0:t.data)||r.message)}},be=e=>{$(e),u(!0)},ye=async e=>{var t;try{await h.delete(`${y}/${e}`),n.success("Account status set to Closed!"),v()}catch(r){n.error("Failed to set account status to Closed."),console.error("Delete account error:",((t=r.response)==null?void 0:t.data)||r.message)}},ve=e=>{M(e),V(!0)},we=e=>{M(e),z(!0)},O=(e,t)=>{L(t),T(e),k(!0)},Se=async()=>{var e;try{const t={...E,status:N};await h.put(`${y}/${E._id}`,t),n.success(`Account status changed to ${N}!`),v()}catch(t){n.error("Failed to update account status."),console.error("Status update error:",((e=t.response)==null?void 0:e.data)||t.message)}finally{k(!1),L(null),T(null)}},Ae=()=>{k(!1),L(null),T(null)},je=async()=>{const e=_.current;if(!e){n.error("Table content not found for PDF export.");return}n.loading("Generating PDF...",{id:"pdf-toast"});try{const t=await Ie(e,{scale:2}),r=t.toDataURL("image/png"),o=new De("p","mm","a4"),i=210,l=297,p=t.height*i/t.width;let S=p,D=0;for(o.addImage(r,"PNG",0,D,i,p),S-=l;S>=0;)D=S-p,o.addPage(),o.addImage(r,"PNG",0,D,i,p),S-=l;o.save("Leads_Customers_Details.pdf"),n.success("PDF generated!",{id:"pdf-toast"})}catch(t){console.error("Error generating PDF:",t),n.error("Failed to generate PDF.",{id:"pdf-toast"})}},ke=()=>{if(w.length===0){n.error("No data to export to Excel.");return}const e=w.map((o,i)=>{var p;return{"S.No":i+1,"Business Name":o.businessName,"Contact Name":o.contactName,Email:o.email,"Mobile Number":o.mobileNumber,"Lead Type":o.type,Status:o.status,"Source Type":o.sourceType,"Assigned To":((p=o.assignedTo)==null?void 0:p.name)||"Unassigned","GST Number":o.gstNumber,"Phone Number":o.phoneNumber,"Address Line 1":o.addressLine1,"Address Line 2":o.addressLine2,"Address Line 3":o.addressLine3,Landmark:o.landmark,City:o.city,Pincode:o.pincode,State:o.state,Country:o.country,Website:o.website,"Is Customer":o.isCustomer?"Yes":"No","Created At":new Date(o.createdAt).toLocaleString()}}),t=P.json_to_sheet(e),r=P.book_new();P.book_append_sheet(r,t,"Leads & Customers"),$e(r,"Leads_Customers_Data.xlsx"),n.success("Data exported to Excel!")},Le=[{title:"S.No",key:"sno",render:(e,t,r)=>r+1,width:60},{title:"Business Name",dataIndex:"businessName",key:"businessName",filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:o})=>s.jsxs("div",{style:{padding:8},children:[s.jsx(B,{placeholder:"Search Business Name",value:t[0],onChange:i=>e(i.target.value?[i.target.value]:[]),onPressEnter:()=>r(),style:{marginBottom:8,display:"block"}}),s.jsx(C,{type:"primary",onClick:()=>r(),icon:s.jsx(H,{}),size:"small",style:{width:90,marginRight:8,backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:"Search"}),s.jsx(C,{onClick:()=>o(),size:"small",style:{width:90},children:"Reset"})]}),onFilter:(e,t)=>t.businessName.toLowerCase().includes(e.toLowerCase()),responsive:["xs","sm","md","lg"]},{title:"Contact Name",dataIndex:"contactName",key:"contactName",responsive:["md","lg"]},{title:"Email",dataIndex:"email",key:"email",responsive:["lg"]},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber",responsive:["md","lg"]},{title:"Status",dataIndex:"status",key:"status",render:e=>{let t;switch(e){case"Active":t="green";break;case"Pipeline":t="orange";break;case"Closed":t="purple";break;case"Customer":t="blue";break;case"Quotations":t="cyan";break;default:t="gray"}return s.jsx(Ge,{color:t,children:e})},filters:[{text:"Active",value:"Active"},{text:"Pipeline",value:"Pipeline"},{text:"Closed",value:"Closed"},{text:"Customer",value:"Customer"},{text:"Quotations",value:"Quotations"}],onFilter:(e,t)=>t.status.indexOf(e)===0,filterMultiple:!0,responsive:["sm","md","lg"]},{title:"Assigned To",dataIndex:"assignedTo",key:"assignedTo",render:e=>e?e.name:"Unassigned",responsive:["md","lg"]},{title:"Source Type",dataIndex:"sourceType",key:"sourceType",filters:[{text:"Direct",value:"Direct"},{text:"Facebook",value:"Facebook"},{text:"Google Ads",value:"Google Ads"},{text:"Website",value:"Website"},{text:"Cold Call",value:"Cold Call"},{text:"Client",value:"Client"},{text:"Tradefair",value:"Tradefair"},{text:"Other",value:"Other"}],onFilter:(e,t)=>{var r;return((r=t.sourceType)==null?void 0:r.indexOf(e))===0},responsive:["lg"]},{title:"Action",key:"action",width:80,render:(e,t)=>s.jsx(Fe,{overlay:s.jsxs(f,{children:[s.jsx(f.Item,{icon:s.jsx(Qe,{}),onClick:()=>be(t),children:"Edit Account"},"edit"),s.jsx(f.Item,{icon:s.jsx(We,{}),onClick:()=>ve(t),children:"View/Add Notes"},"notes"),s.jsx(f.Item,{icon:s.jsx(ze,{}),onClick:()=>we(t),children:"View/Add Follow-ups"},"followup"),t.status==="Customer"?s.jsx(f.Item,{onClick:()=>O("Active",t),children:"Change to Lead"},"change-to-lead"):s.jsx(f.Item,{onClick:()=>O("Customer",t),children:"Change to Customer"},"change-to-customer"),xe==="Superadmin"&&s.jsx(f.Item,{children:s.jsxs(qe,{title:"Are you sure you want to close this account? This will set its status to 'Closed'.",onConfirm:()=>ye(t._id),okText:"Yes",cancelText:"No",children:[s.jsx(Ye,{}),"Close Account"]})},"close-account")]}),trigger:["click"],children:s.jsx(C,{icon:s.jsx(Pe,{})})})}],w=J.filter(e=>e.businessName.toLowerCase().includes(j.toLowerCase())||e.contactName.toLowerCase().includes(j.toLowerCase()));return s.jsxs(Me,{title:s.jsx(st,{level:4,children:"Manage Leads & Customers"}),children:[s.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[s.jsx(B,{placeholder:"Search by business or contact name",prefix:s.jsx(H,{}),style:{width:"100%",maxWidth:300},value:j,onChange:e=>q(e.target.value)}),s.jsxs(Ne,{children:[s.jsx(C,{type:"primary",icon:s.jsx(Ue,{}),style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:()=>{$(null),u(!0)},children:"Add New Account"}),s.jsx(C,{icon:s.jsx(tt,{}),onClick:je}),s.jsx(C,{icon:s.jsx(Xe,{}),onClick:ke})]})]}),s.jsxs(W,{defaultActiveKey:"all",onChange:Y,children:[s.jsx(b,{tab:`All Leads (${ue})`},"all"),s.jsx(b,{tab:`Enquiry (${ee})`},"active"),s.jsx(b,{tab:`Proposed (${ae})`},"Pipeline"),s.jsx(b,{tab:`Quotations Sent (${ie})`},"quotations"),s.jsx(b,{tab:`Customers (${se})`},"customers"),s.jsx(b,{tab:`Closed Accounts (${ne})`},"closed")]}),s.jsx("div",{ref:_,children:he?s.jsx(Te,{size:"large",style:{display:"block",margin:"50px auto"}}):w.length>0?s.jsx(_e,{columns:Le,dataSource:w,rowKey:"_id",scroll:{x:"max-content"}}):s.jsx(Oe,{description:"No accounts found."})}),s.jsx(Ee,{visible:A,onClose:()=>u(!1),onSave:Ce,initialValues:d,allUsers:me,loadingUsers:fe}),F&&s.jsxs(s.Fragment,{children:[s.jsx(Re,{visible:X,onClose:()=>V(!1),account:F,refreshAccounts:v}),s.jsx(Ve,{visible:Z,onClose:()=>z(!1),account:F,refreshAccounts:v})]}),s.jsx(Be,{title:"Change Account Status",open:K,onOk:Se,onCancel:Ae,okText:"Yes",cancelText:"No",children:s.jsxs("p",{children:["Are you sure you want to change this account's status to"," ","**",N,"**?"]})})]})};export{Mt as default};
