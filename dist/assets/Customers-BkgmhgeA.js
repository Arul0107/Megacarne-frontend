import{r as a,u as ne,p as e,s as l,B as m}from"./index-DO2xjt6F.js";import{i as p}from"./axios-0yhrvgHk.js";import{B as ie,F as le,N as re,S as ce}from"./FollowUpDrawer-cVq4peM5.js";import{C as ue,T as R}from"./index-BqrCpxkO.js";import{T as de}from"./index-c71wm61D.js";import{I as me,R as pe}from"./index-Bsc_TH0P.js";import{R as he}from"./TextArea-BGWnTIhk.js";import{F as V,R as fe}from"./Table-ytN7lPLD.js";import{E as $}from"./index-Dr8C4fpI.js";import{M as B}from"./index-Ct-tprs0.js";import{R as xe}from"./MessageOutlined-DxjfJFqs.js";import{T as x}from"./index-B1nrcjBb.js";import"./index-xsH4HHeE.js";import"./index-DrHZk4bw.js";import"./row-CodefCjq.js";import"./index-0HGn5QE1.js";import"./context-D0XoKNUb.js";import"./useClosable-C4HlJzLH.js";import"./extendsObject-78o_rR5W.js";import"./index-CYt6p7Zn.js";import"./index-CneINHzn.js";import"./PlusOutlined-CozxblFd.js";import"./index-DtYsO9Lt.js";import"./index-B6-Yjovu.js";import"./index-Cx609xem.js";const{Title:je}=de,{TabPane:L}=R,qe=()=>{const[g,E]=a.useState(""),[M,U]=a.useState("active"),[O,v]=a.useState([]),[h,i]=a.useState(!1),[K,j]=a.useState(!1),[o,w]=a.useState(null),[P,C]=a.useState(!1),[u,q]=a.useState(null),[S,H]=a.useState(null),[W,y]=a.useState(!1),[r,b]=a.useState(null),[Y,N]=a.useState(!1),[z,T]=a.useState(!1),[f,k]=a.useState(null),G=ne(),c=()=>{i(!0),p.get("/api/accounts/customers").then(t=>{const s=Array.isArray(t.data)?t.data:[];v(s),l.success("Customers loaded")}).catch(()=>{l.error("Failed to load customers"),v([])}).finally(()=>i(!1))};a.useEffect(()=>{c()},[]);const J=t=>{w(t),j(!0)},Q=t=>{i(!0),(o!=null&&o._id?p.put(`/api/accounts/${o._id}`,t):p.post("/api/accounts",t)).then(()=>{l.success(`Customer ${o!=null&&o._id?"updated":"created"} successfully`),c()}).catch(()=>{l.error(`Failed to ${o!=null&&o._id?"update":"create"} customer`)}).finally(()=>{j(!1),w(null),i(!1)})},X=(t,s)=>{q(s),H(t?"Active":"Inactive"),C(!0)},Z=()=>{i(!0);const t={...u,status:S};p.put(`/api/accounts/${u._id}`,t).then(()=>{l.success("Status updated"),c()}).catch(()=>{l.error("Failed to update status")}).finally(()=>{C(!1),i(!1)})},ee=t=>{b(t),y(!0)},te=()=>{r!=null&&r._id&&(i(!0),p.delete(`/api/accounts/${r._id}`).then(()=>{l.success("Customer deleted successfully"),c()}).catch(()=>{l.error("Failed to delete customer")}).finally(()=>{y(!1),b(null),i(!1)}))},se=t=>{k(t),N(!0)},ae=t=>{k(t),T(!0)},oe=t=>{G(`/customers/${t._id}`)},A=O.filter(t=>{var n,d,D;const s=g.toLowerCase();return((n=t.businessName)==null?void 0:n.toLowerCase().includes(s))||((d=t.contactName)==null?void 0:d.toLowerCase().includes(s))||((D=t.email)==null?void 0:D.toLowerCase().includes(s))}),I=A.filter(t=>t.status==="Active"),_=A.filter(t=>t.status==="Inactive"),F=[{title:"Sno.",render:(t,s,n)=>n+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(x,{color:"red",children:"Hot"});case"Warm":return e.jsx(x,{color:"orange",children:"Warm"});case"Cold":return e.jsx(x,{color:"blue",children:"Cold"});default:return e.jsx(x,{children:"Unknown"})}}},{title:"Latest Note",render:(t,s)=>{var d;const n=(d=s.notes)==null?void 0:d[s.notes.length-1];return n?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:n.timestamp}),e.jsx("br",{}),n.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsxs("span",{style:{color:s.status==="Inactive"?"red":"inherit"},children:[e.jsx(ce,{checked:s.status==="Active",onChange:n=>X(n,s),checkedChildren:"Active",unCheckedChildren:"Inactive"}),e.jsx("span",{style:{marginLeft:8},children:s.status})]})},{title:"Actions",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:e.jsx(fe,{}),onClick:()=>J(s),type:"link"}),e.jsx(m,{icon:e.jsx(xe,{}),onClick:()=>se(s),type:"link"}),e.jsx(m,{icon:e.jsx(pe,{}),onClick:()=>oe(s),type:"link",children:"View"}),e.jsx(m,{onClick:()=>ae(s),type:"link",children:"Follow-ups"}),e.jsx(m,{danger:!0,onClick:()=>ee(s),type:"link",children:"Delete"})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(ue,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:e.jsx(je,{level:4,children:"Customers"})}),e.jsx(me,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(he,{}),value:g,onChange:t=>E(t.target.value),style:{width:400,marginBottom:16}}),e.jsxs(R,{activeKey:M,onChange:U,children:[e.jsx(L,{tab:`Active (${I.length})`,children:e.jsx(V,{columns:F,dataSource:I,rowKey:"_id",pagination:!1,loading:h,locale:{emptyText:e.jsx($,{description:"No active customers"})}})},"active"),e.jsx(L,{tab:`Inactive (${_.length})`,children:e.jsx(V,{columns:F,dataSource:_,rowKey:"_id",pagination:!1,loading:h,locale:{emptyText:e.jsx($,{description:"No inactive customers"})}})},"inactive")]})]}),e.jsx(ie,{visible:K,onClose:()=>j(!1),onSave:Q,initialValues:o}),e.jsx(B,{title:"Confirm Status Change",open:P,onOk:Z,onCancel:()=>C(!1),okText:"Yes",cancelText:"No",confirmLoading:h,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:u==null?void 0:u.businessName})," to ",e.jsx("strong",{children:S}),"?"]})}),e.jsx(B,{title:"Confirm Delete",open:W,onOk:te,onCancel:()=>y(!1),okText:"Delete",okButtonProps:{danger:!0},cancelText:"Cancel",confirmLoading:h,children:e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:r==null?void 0:r.businessName}),"?"]})}),f&&e.jsx(le,{visible:z,onClose:()=>T(!1),account:f,refreshAccounts:c}),f&&e.jsx(re,{visible:Y,onClose:()=>N(!1),account:f,refreshAccounts:c})]})};export{qe as default};
