import{r as u,I as K,a as Q,o as e,B as L,ak as j}from"./index-DzA004c_.js";import{F as s}from"./index-BydMaA6s.js";import{D as E}from"./index-CBg6Ra2V.js";import{R as F,C as x}from"./TextArea-Bpv_7zs6.js";import{I as a}from"./index-CzjHKQ4D.js";import{T as X}from"./index-Bns0Y_mk.js";import{S as C}from"./index-B6lXhOkS.js";import{i as A}from"./axios-YBtE4rUB.js";import{D as z}from"./index--zdzth6Z.js";import{R as Z,T as J}from"./index-OVVEqnda.js";import{T as $}from"./index-DzPD6LJJ.js";import{h as S}from"./moment-C5S46NFB.js";import{D as V}from"./index-CAI7yw_p.js";import{L as P}from"./index-BpMXJl6E.js";import{M as ee}from"./index-FxzqxQ64.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},se=function(w,l){return u.createElement(K,Q({},w,{ref:l,icon:te}))},Ne=u.forwardRef(se);const{TextArea:le}=a,{Option:i}=C,Ie=({visible:f,onClose:w,onSave:l,initialValues:n,allUsers:g,loadingUsers:b})=>{var y;const[d]=s.useForm(),[m,v]=u.useState(!1);s.useWatch("sourceType",d),u.useEffect(()=>{var r;d.resetFields(),n?d.setFieldsValue({...n,assignedTo:((r=n.assignedTo)==null?void 0:r._id)||null}):d.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null})},[n,d]);const N=()=>{d.validateFields().then(r=>{v(!0);const o=new Date().toLocaleString(),p=r.noteInput?{text:r.noteInput,timestamp:o}:null,h=(n==null?void 0:n.notes)||[],I=p?[...h,p]:h,T={...r,notes:I,assignedTo:r.assignedTo===null?null:r.assignedTo};delete T.noteInput,l(T),j.success(`Account ${n?"updated":"created"} successfully!`),v(!1),w()}).catch(r=>{console.log("Validate Failed:",r),j.error("Please fill in all required fields correctly.")})};return e.jsx(E,{title:n?"Edit Business Account":"Create New Business Account",width:720,onClose:w,visible:f,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(L,{onClick:w,style:{marginRight:8},children:"Cancel"}),e.jsx(L,{onClick:N,type:"primary",loading:m,children:n?"Update Account":"Create Account"})]}),children:e.jsxs(s,{form:d,layout:"vertical",children:[e.jsxs(F,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsx(s.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(x,{span:12,children:e.jsx(s.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(a,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(s.Item,{name:"landmark",label:"Landmark",children:e.jsx(a,{placeholder:"Landmark (Optional)"})}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(X,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(x,{span:8,children:e.jsx(s.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(s.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(s.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(s.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(C,{placeholder:"Select Type",children:[e.jsx(i,{value:"Hot",children:"Hot"}),e.jsx(i,{value:"Warm",children:"Warm"}),e.jsx(i,{value:"Cold",children:"Cold"})]})}),e.jsx(s.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(C,{placeholder:"Select Status",children:[e.jsx(i,{value:"Active",children:"Active"}),e.jsx(i,{value:"Inactive",children:"Inactive"}),e.jsx(i,{value:"Pipeline",children:"Pipeline"}),e.jsx(i,{value:"Closed",children:"Closed"})]})}),e.jsx(s.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(C,{placeholder:"How did you hear about us?",children:[e.jsx(i,{value:"Direct",children:"Direct"}),e.jsx(i,{value:"Facebook",children:"Facebook "}),e.jsx(i,{value:"Google Ads",children:"Google Ads"}),e.jsx(i,{value:"Website",children:"Website"}),e.jsx(i,{value:"Cold Call",children:"Cold Call"}),e.jsx(i,{value:"Other",children:"Other"})]})}),e.jsx(s.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(C,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:b,showSearch:!0,optionFilterProp:"children",filterOption:(r,o)=>o.children.toLowerCase().indexOf(r.toLowerCase())>=0,children:g&&g.map(r=>e.jsxs(i,{value:r._id,children:[r.name," (",r.role,")"]},r._id))})}),e.jsx(s.Item,{name:"noteInput",label:"Add Note",children:e.jsx(le,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((y=n==null?void 0:n.notes)==null?void 0:y.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:n.notes.map((r,o)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[r.timestamp,":"]})," ",r.text]},o))})]})]})})},{TextArea:re}=a,{Title:oe,Text:ne}=$,Te=({visible:f,onClose:w,account:l,refreshAccounts:n})=>{const[g]=s.useForm(),[b,d]=u.useState(!1),[m,v]=u.useState([]);u.useEffect(()=>{f&&(l!=null&&l._id)&&v(l.notes||[])},[f,l]);const N=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},y=async()=>{try{const{note:o}=await g.validateFields();d(!0);const p={text:o,timestamp:new Date().toLocaleString(),author:N()},h=[...m,p];await A.put(`/api/accounts/${l._id}`,{...l,notes:h}),j.success("Note added successfully!"),v(h),g.resetFields(),n()}catch{j.error("Failed to add note.")}finally{d(!1)}},r=()=>!m||m.length===0?e.jsx(ne,{type:"secondary",children:"No notes to show"}):m.map((o,p)=>{const h=p>0?m[p-1]:null,I=new Date(o.timestamp).toDateString(),T=h?new Date(h.timestamp).toDateString():null,k=I!==T;return e.jsxs("div",{children:[k&&e.jsx("div",{className:"note-date-header",children:I}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[o.author,"    ",o.timestamp]}),e.jsx("div",{className:"note-text",children:o.text})]})]},p)});return e.jsxs(E,{title:e.jsxs(oe,{level:4,style:{margin:0},children:["Notes for ",l.businessName]}),open:f,onClose:w,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[r(),e.jsx(z,{}),e.jsxs(s,{form:g,layout:"vertical",children:[e.jsx(s.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(re,{rows:3,placeholder:"Type your note here...",disabled:b})}),e.jsx(L,{type:"primary",icon:e.jsx(Z,{}),onClick:y,loading:b,block:!0,children:"Add Note"})]})]})},{TextArea:ae}=a,{TabPane:U}=J,Se=({visible:f,onClose:w,account:l,refreshAccounts:n})=>{const[g,b]=u.useState(""),[d,m]=u.useState(null),[v,N]=u.useState(!1),[y,r]=u.useState([]),[o,p]=u.useState(null);u.useEffect(()=>{f&&(l!=null&&l._id)&&h()},[f,l]);const h=async()=>{try{const t=await A.get(`/api/accounts/${l._id}/followups`);r(t.data||[])}catch{j.error("Failed to fetch follow-ups")}},I=()=>{if(!g||!d){j.error("Please fill in all fields");return}const t=JSON.parse(localStorage.getItem("user")),c=t==null?void 0:t._id;if(!c){j.error("User not found");return}N(!0);const D={date:d.format("YYYY-MM-DD"),note:g,addedBy:c};(o===null?A.post(`/api/accounts/${l._id}/followups`,D):A.put(`/api/accounts/${l._id}/followups/${o}`,D)).then(()=>{j.success(o===null?"Follow-up added":"Follow-up updated"),b(""),m(null),p(null),h(),n()}).catch(M=>{var W,G;j.error(((G=(W=M==null?void 0:M.response)==null?void 0:W.data)==null?void 0:G.message)||"Failed to save follow-up")}).finally(()=>N(!1))},T=t=>{const c=y[t];b(c.note),m(S(c.date)),p(t)},k=t=>{ee.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up?",okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{A.delete(`/api/accounts/${l._id}/followups/${t}`).then(()=>{j.success("Follow-up deleted"),h(),n()}).catch(()=>j.error("Failed to delete follow-up"))}})},Y=S().format("YYYY-MM-DD"),O=[...y].sort((t,c)=>new Date(c.date)-new Date(t.date)),_=O.filter(t=>S(t.date).format("YYYY-MM-DD")===Y),R=O.filter(t=>S(t.date).isAfter(Y,"day")),H=O.filter(t=>S(t.date).isBefore(Y,"day")),B=(t,c)=>{var D,q;return e.jsx(P.Item,{actions:[e.jsx("a",{onClick:()=>T(c),children:"Edit"},"edit"),e.jsx("a",{onClick:()=>k(c),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx($.Text,{strong:!0,children:S(t.date).format("DD-MM-YYYY")}),e.jsx("br",{}),t.note,e.jsx("br",{}),e.jsxs($.Text,{type:"secondary",children:["By ",((D=t.addedBy)==null?void 0:D.name)||((q=t.addedBy)==null?void 0:q.email)||"Unknown"]})]})})};return e.jsxs(E,{title:`Follow-ups: ${l==null?void 0:l.businessName}`,open:f,onClose:()=>{p(null),b(""),m(null),w()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(V,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:d,onChange:t=>m(t)}),e.jsx(ae,{rows:4,placeholder:"Enter follow-up note",value:g,onChange:t=>b(t.target.value)}),e.jsx(L,{type:"primary",block:!0,onClick:I,loading:v,style:{marginTop:10},children:o===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(z,{}),e.jsxs(J,{defaultActiveKey:"today",children:[e.jsx(U,{tab:`Today's Follow-ups (${_.length})`,children:e.jsx(P,{dataSource:_,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No follow-ups for today"}})},"today"),e.jsx(U,{tab:`Upcoming Follow-ups (${R.length})`,children:e.jsx(P,{dataSource:R,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No upcoming follow-ups"}})},"upcoming"),e.jsx(U,{tab:`Past Follow-ups (${H.length})`,children:e.jsx(P,{dataSource:H,renderItem:(t,c)=>B(t,y.indexOf(t)),locale:{emptyText:"No past follow-ups"}})},"past")]})]})};export{Ie as B,Se as F,Te as N,Ne as R};
