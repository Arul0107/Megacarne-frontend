import{r as u,I as $,e as _,x as e,B as D,an as y,K as M}from"./index-CuM4TiFX.js";import{F as r}from"./index-DPVeCYMP.js";import{D as L}from"./index-B7ezPVWn.js";import{R as T,C as h}from"./TextArea-CzDgEUcr.js";import{I as a}from"./index-9qapg5qh.js";import{T as Y}from"./index-DEabMIRF.js";import{S as A}from"./index-BH4MDtWK.js";import{i as P}from"./axios-YBtE4rUB.js";import{D as E}from"./index-DocOD8MG.js";import{R as H}from"./PlusOutlined-B9RQQTZY.js";import{T as O}from"./index-D4RF15dB.js";import{h as R}from"./moment-C5S46NFB.js";import{D as G,d as W}from"./index-D8s0gBqr.js";import{L as k}from"./index-CYJ6Kzbe.js";import{R as z}from"./MessageOutlined-Rc44LvQC.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},K=function(f,s){return u.createElement($,_({},f,{ref:s,icon:J}))},fe=u.forwardRef(K);const{TextArea:Q}=a,{Option:i}=A,ge=({visible:x,onClose:f,onSave:s,initialValues:o,allUsers:j,loadingUsers:g})=>{var v;const[d]=r.useForm(),[m,b]=u.useState(!1);r.useWatch("sourceType",d),u.useEffect(()=>{var t;d.resetFields(),o?d.setFieldsValue({...o,assignedTo:((t=o.assignedTo)==null?void 0:t._id)||null}):d.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null})},[o,d]);const w=()=>{d.validateFields().then(t=>{b(!0);const l=new Date().toLocaleString(),c=t.noteInput?{text:t.noteInput,timestamp:l}:null,p=(o==null?void 0:o.notes)||[],I=c?[...p,c]:p,C={...t,notes:I,assignedTo:t.assignedTo===null?null:t.assignedTo};delete C.noteInput,s(C),y.success(`Account ${o?"updated":"created"} successfully!`),b(!1),f()}).catch(t=>{console.log("Validate Failed:",t),y.error("Please fill in all required fields correctly.")})};return e.jsx(L,{title:o?"Edit Business Account":"Create New Business Account",width:720,onClose:f,visible:x,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(D,{onClick:f,style:{marginRight:8},children:"Cancel"}),e.jsx(D,{onClick:w,type:"primary",loading:m,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:o?"Update Account":"Create Account"})]}),children:e.jsxs(r,{form:d,layout:"vertical",children:[e.jsxs(T,{gutter:16,children:[" ",e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!1,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(T,{gutter:16,children:[" ",e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(T,{gutter:16,children:[" ",e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsxs(T,{gutter:16,children:[" ",e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})})]}),e.jsxs(T,{gutter:16,children:[" ",e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(Y,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(r.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(r.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(r.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(A,{placeholder:"Select Type",children:[e.jsx(i,{value:"Hot",children:"Hot"}),e.jsx(i,{value:"Warm",children:"Warm"}),e.jsx(i,{value:"Cold",children:"Cold"})]})}),e.jsx(r.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(A,{placeholder:"Select Status",children:[e.jsx(i,{value:"Enquiry",children:"Enquiry"})," ",e.jsx(i,{value:"Proposed",children:"Proposed"}),e.jsx(i,{value:"Customer",children:"Customer"}),e.jsx(i,{value:"Closed",children:"Closed"})]})}),e.jsx(r.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(A,{placeholder:"How did you hear about us?",children:[e.jsx(i,{value:"Direct",children:"Direct"}),e.jsx(i,{value:"socialmedia",children:"Social Media"}),e.jsx(i,{value:"online",children:"Online"}),e.jsx(i,{value:"Client",children:"Client"}),e.jsx(i,{value:"Tradefair",children:"Tradefair"}),e.jsx(i,{value:"Other",children:"Other"})]})}),e.jsx(r.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(A,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:g,showSearch:!0,optionFilterProp:"children",filterOption:(t,l)=>String(l.children||"").toLowerCase().includes(t.toLowerCase()),children:j&&j.map(t=>e.jsxs(i,{value:t._id,children:[t.name," (",t.role,") "]},t._id))})}),e.jsx(r.Item,{name:"noteInput",label:"Add Note",children:e.jsx(Q,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((v=o==null?void 0:o.notes)==null?void 0:v.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:o.notes.map((t,l)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[t.timestamp,":"]})," ",t.text]},l))})]})]})})},{TextArea:X}=a,{Title:Z,Text:V}=O,ye=({visible:x,onClose:f,account:s,refreshAccounts:o})=>{const[j]=r.useForm(),[g,d]=u.useState(!1),[m,b]=u.useState([]);u.useEffect(()=>{x&&(s!=null&&s._id)&&b(s.notes||[])},[x,s]);const w=()=>{try{const l=JSON.parse(localStorage.getItem("user"));return(l==null?void 0:l.email)||"Unknown"}catch{return"Unknown"}},v=async()=>{try{const{note:l}=await j.validateFields();d(!0);const c={text:l,timestamp:new Date().toLocaleString(),author:w()},p=[...m,c];await P.put(`/api/accounts/${s._id}`,{...s,notes:p}),y.success("Note added successfully!"),b(p),j.resetFields(),o()}catch{y.error("Failed to add note.")}finally{d(!1)}},t=()=>!m||m.length===0?e.jsx(V,{type:"secondary",children:"No notes to show"}):m.map((l,c)=>{const p=c>0?m[c-1]:null,I=new Date(l.timestamp).toDateString(),C=p?new Date(p.timestamp).toDateString():null,n=I!==C;return e.jsxs("div",{children:[n&&e.jsx("div",{className:"note-date-header",children:I}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[l.author,"    ",l.timestamp]}),e.jsx("div",{className:"note-text",children:l.text})]})]},c)});return e.jsxs(L,{title:e.jsxs(Z,{level:4,style:{margin:0},children:["Notes for ",s.businessName]}),open:x,onClose:f,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[t(),e.jsx(E,{}),e.jsxs(r,{form:j,layout:"vertical",children:[e.jsx(r.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(X,{rows:3,placeholder:"Type your note here...",disabled:g})}),e.jsx(D,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(H,{}),onClick:v,loading:g,block:!0,children:"Add Note"})]})]})},{TextArea:ee}=a,{Text:q}=O,we=({visible:x,onClose:f,account:s,refreshAccounts:o})=>{const[j,g]=u.useState(""),[d,m]=u.useState(null),[b,w]=u.useState(!1),[v,t]=u.useState([]),[l,c]=u.useState(null);u.useEffect(()=>{x&&(s!=null&&s._id)?p():(t([]),c(null),g(""),m(null))},[x,s]);const p=async()=>{if(s!=null&&s._id){w(!0);try{const n=await P.get(`/api/accounts/${s._id}/followups`);t(n.data.sort((N,S)=>R(S.createdAt).diff(R(N.createdAt)))||[])}catch(n){console.error("Error fetching follow-ups:",n),y.error("Failed to fetch follow-ups")}finally{w(!1)}}},I=()=>{if(!j.trim()||!d){y.error("Please select a date and enter a note for the follow-up.");return}const n=JSON.parse(localStorage.getItem("user")),N=n==null?void 0:n._id;if(!N){y.error("User information not found. Please log in.");return}w(!0);const S={date:d.toISOString(),note:j.trim(),addedBy:N};(l===null?P.post(`/api/accounts/${s._id}/followups`,S):P.put(`/api/accounts/${s._id}/followups/${l._id}`,S)).then(()=>{y.success(l===null?"Follow-up added successfully!":"Follow-up updated successfully!"),g(""),m(null),c(null),p(),typeof o=="function"&&o()}).catch(F=>{var B,U;console.error("Error saving follow-up:",F),y.error(((U=(B=F==null?void 0:F.response)==null?void 0:B.data)==null?void 0:U.message)||"Failed to save follow-up.")}).finally(()=>w(!1))},C=n=>{var N,S;return e.jsx(k.Item,{children:e.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[e.jsx(M,{style:{marginRight:"5px",color:"#888"}}),e.jsx(q,{strong:!0,style:{marginRight:"10px",color:"#333"},children:((N=n.addedBy)==null?void 0:N.name)||((S=n.addedBy)==null?void 0:S.email)||"Unknown User"}),e.jsx(W,{style:{marginRight:"5px",color:"#888"}}),e.jsxs(q,{type:"secondary",style:{fontSize:"0.8em"},children:[R(n.createdAt).format("DD/MM/YYYY, h:mm:ss A")," "]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsx(z,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),e.jsx(q,{style:{flexGrow:1},children:n.note})]})]})})};return e.jsxs(L,{title:`Follow-ups for Account: ${(s==null?void 0:s.businessName)||"N/A"}`,open:x,onClose:()=>{c(null),g(""),m(null),f()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(G,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:d,onChange:n=>m(n),placeholder:"Select follow-up date"}),e.jsx(ee,{rows:4,placeholder:"Enter follow-up note",value:j,onChange:n=>g(n.target.value)}),e.jsx(D,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#ef7a1b",color:"white"},block:!0,onClick:I,loading:b,children:l===null?"Add Follow-up":"Update Follow-up"})]}),e.jsxs(E,{children:["All Follow-ups (",v.length,")"]}),e.jsx(k,{dataSource:v,renderItem:C,locale:{emptyText:"No follow-ups found for this account."},style:{marginTop:16}})]})};export{ge as B,we as F,ye as N,fe as R};
