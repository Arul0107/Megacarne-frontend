import{r as i,p as t,S as C,B as F,V as r}from"./index-CKWzJZwz.js";import{i as g}from"./axios-0yhrvgHk.js";import I from"./QuotationForm-acmpCQ6g.js";import L from"./QuotationList-CMClYL3H.js";import{F as S}from"./index-BkOdznK5.js";import{D as b}from"./index-snvmcnDO.js";import{I as V}from"./index-D547GtUq.js";import{R as T}from"./SendOutlined-BaB-WZ9I.js";import{T as E}from"./index-CLITIDam.js";import"./index-xsH4HHeE.js";import"./index-C6aGBovD.js";import"./TextArea-DEWBu-8c.js";import"./index-DHfbdJKK.js";import"./index-XKyTlcS0.js";import"./PlusOutlined-B6wL2tqI.js";import"./row-vY193qbU.js";import"./index-Be92sfkX.js";import"./index-DZ16B_2c.js";import"./DeleteOutlined-CaapTf6n.js";import"./SaveOutlined-DnDqHt09.js";import"./jspdf.es.min-lsgphRXx.js";import"./html2canvas.esm-CBrSDip1.js";import"./Table-3OmVxXfu.js";import"./index-D13QqeyP.js";import"./useClosable-C-JeMfnB.js";import"./index-Cmwzh1KE.js";import"./context-CcDF2xFV.js";import"./index-BoCMTNxl.js";import"./index-B5gKA1RP.js";import"./MessageOutlined-CUbqQmA7.js";import"./index-DDMbkuBX.js";const{TextArea:A}=V,{Title:$,Text:q}=E,k=({visible:w,onClose:N,quotation:a,refreshQuotations:d})=>{const[l]=S.useForm(),[n,h]=i.useState(!1),[m,x]=i.useState([]);i.useEffect(()=>{x((a==null?void 0:a.notes)||[])},[a]);const y=()=>{try{const s=JSON.parse(localStorage.getItem("user"));return(s==null?void 0:s.email)||"Unknown"}catch{return"Unknown"}},p=async s=>{try{h(!0);const c=r.loading("Adding note..."),e={text:s.note,timestamp:new Date().toLocaleString(),author:y()},o=[...m,e];await g.put(`/api/quotations/${a._id}`,{notes:o}),x(o),r.success("Note added",{id:c}),l.resetFields(),d()}catch{r.error("Failed to add note")}finally{h(!1)}},j=()=>m.length?m.map((s,c)=>{const e=c>0?m[c-1]:null,o=new Date(s.timestamp).toDateString(),u=e?new Date(e.timestamp).toDateString():null,f=o!==u;return t.jsxs("div",{children:[f&&t.jsx("div",{className:"note-date-header",children:o}),t.jsxs("div",{className:"note-bubble",children:[t.jsxs("div",{className:"note-meta",children:[s.author,"    ",s.timestamp]}),t.jsx("div",{className:"note-text",children:s.text})]})]},c)}):t.jsx(q,{type:"secondary",children:"No notes added yet"});return t.jsx(b,{title:t.jsxs($,{level:4,style:{margin:0},children:["Notes for Quotation #",a==null?void 0:a.quotationNumber]}),open:w,onClose:N,width:440,destroyOnClose:!0,children:t.jsxs(C,{spinning:n,children:[t.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:j()}),t.jsxs(S,{form:l,layout:"vertical",onFinish:p,children:[t.jsx(S.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:t.jsx(A,{rows:3,placeholder:"Type your note here"})}),t.jsx(F,{type:"primary",htmlType:"submit",loading:n,block:!0,icon:t.jsx(T,{}),children:"Add Note"})]})]})})},ft=()=>{const[w,N]=i.useState([]),[a,d]=i.useState(!1),[l,n]=i.useState(null),[h,m]=i.useState([]),[x,y]=i.useState(!1),p=async()=>{const e=r.loading("Loading quotations...");try{const o=await g.get("/api/quotations");N(o.data),r.success("Quotations loaded successfully",{id:e})}catch{r.error("Failed to load quotations",{id:e})}};i.useEffect(()=>{p()},[]);const j=async e=>{const o=r.loading("Saving quotation...");try{l?await g.put(`/api/quotations/${l._id}`,e):await g.post("/api/quotations",e),r.success("Quotation saved successfully!",{id:o}),p(),d(!1),n(null)}catch(u){r.error(`Failed to save quotation: ${u.message}`,{id:o})}},s=async e=>{const o=r.loading("Deleting quotation...");try{await g.delete(`/api/quotations/${e}`),r.success("Quotation deleted successfully",{id:o}),p()}catch(u){r.error(`Failed to delete quotation: ${u.message}`,{id:o})}},c=e=>{const o=e.toLowerCase(),u=w.filter(f=>{var v,D,Q;return((v=f.businessName)==null?void 0:v.toLowerCase().includes(o))||((D=f.customerName)==null?void 0:D.toLowerCase().includes(o))||((Q=f.quotationNumber)==null?void 0:Q.toLowerCase().includes(o))});m(u)};return t.jsxs(t.Fragment,{children:[t.jsx(L,{quotations:h.length?h:w,onAddNew:()=>{n(null),d(!0)},onEdit:e=>{n(e),d(!0)},onDelete:s,onSearch:c,onViewNotes:e=>{n(e),y(!0)}}),t.jsx(b,{open:a,title:l?"Edit Quotation":"Create Quotation",onClose:()=>{d(!1),n(null)},width:720,destroyOnClose:!0,children:t.jsx(I,{initialValues:l,onSave:j,onCancel:()=>{d(!1),n(null)}})}),t.jsx(k,{visible:x,onClose:()=>{y(!1),n(null)},quotation:l,refreshQuotations:p})]})};export{ft as default};
