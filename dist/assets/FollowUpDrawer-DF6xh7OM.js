import{r as o,I as E,e as O,x as e,B as L,an as x,K as k}from"./index-Bh972cwr.js";import{i as F}from"./axios-tnHzrPy3.js";import{F as r}from"./index-BL5iROut.js";import{D as $}from"./index-C32tZoDq.js";import{R as T,C as g}from"./TextArea-BEg0asyq.js";import{I as u}from"./index-7-75ZJ3V.js";import{T as M}from"./index-BP62iKyl.js";import{S as C}from"./index-CcaSAig_.js";import{D as _}from"./index-h8gceX7I.js";import{R as H}from"./PlusOutlined-B66sc2o9.js";import{T as z}from"./index-DJmVeEIg.js";import{h as D}from"./moment-C5S46NFB.js";import{D as Y,d as G}from"./index-BB8Ze6MZ.js";import{L as B}from"./index-DdY89v7F.js";import{R as W}from"./MessageOutlined-yp-41fzR.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},Q=function(h,s){return o.createElement(E,O({},h,{ref:s,icon:J}))},Se=o.forwardRef(Q),K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},V=function(h,s){return o.createElement(E,O({},h,{ref:s,icon:K}))},Ie=o.forwardRef(V),X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},Z=function(h,s){return o.createElement(E,O({},h,{ref:s,icon:X}))},Pe=o.forwardRef(Z);const{TextArea:ee}=u,{Option:i}=C,te="/api/product",se=async()=>{try{return(await F.get(`${te}`)).data}catch(n){throw console.error("Error fetching all products:",n),n}},Ne=({visible:n,onClose:h,onSave:s,initialValues:c,allUsers:j,loadingUsers:w})=>{const[m]=r.useForm(),[p,I]=o.useState(!1),[b,P]=o.useState([]),[N,a]=o.useState(!1);r.useWatch("sourceType",m),o.useEffect(()=>{var t,d;m.resetFields(),c?m.setFieldsValue({...c,assignedTo:((t=c.assignedTo)==null?void 0:t._id)||null,selectedProduct:((d=c.selectedProduct)==null?void 0:d._id)||null}):m.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null,selectedProduct:null})},[c,m]),o.useEffect(()=>{n&&(async()=>{a(!0);try{const d=await se();P(d)}catch(d){console.error("Error fetching products:",d),x.error("Failed to load products.")}finally{a(!1)}})()},[n]);const f=async()=>{try{const t=await m.validateFields();I(!0);const d=new Date().toLocaleString(),S=t.noteInput?{text:t.noteInput,timestamp:d,author:"User"}:null,l=(c==null?void 0:c.notes)||[],v=S?[...l,S]:l,y={...t,notes:v,assignedTo:t.assignedTo===void 0?null:t.assignedTo,selectedProduct:t.selectedProduct===void 0?null:t.selectedProduct};delete y.noteInput,await s(y),x.success(`Account ${c?"updated":"created"} successfully!`),h()}catch(t){console.error("Validation Failed or API Error:",t),t&&t.response&&t.response.status===409&&t.response.data&&t.response.data.message?x.error(t.response.data.message):t&&t.errorFields?x.error("Please fill in all required fields correctly."):x.error("Failed to save account. Please try again.")}finally{I(!1)}};return e.jsx($,{title:c?"Edit Business Account":"Create New Business Account",width:720,onClose:h,open:n,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(L,{onClick:h,style:{marginRight:8},children:"Cancel"}),e.jsx(L,{onClick:f,type:"primary",loading:p,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:c?"Update Account":"Create Account"})]}),children:e.jsxs(r,{form:m,layout:"vertical",children:[e.jsxs(T,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(u,{placeholder:"Business Name"})})}),e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!1,message:"Please enter GST Number"}],children:e.jsx(u,{placeholder:"GST Number"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(u,{placeholder:"Contact Person Name"})})}),e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(u,{placeholder:"Email"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(u,{placeholder:"Phone Number (Optional)"})})}),e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(u,{placeholder:"Mobile Number"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(u,{placeholder:"Address Line 1"})})}),e.jsx(g,{span:12,children:e.jsx(r.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(u,{placeholder:"Address Line 2 (Optional)"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(g,{span:8,children:e.jsx(r.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(u,{placeholder:"City"})})}),e.jsx(g,{span:8,children:e.jsx(r.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(M,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(g,{span:8,children:e.jsx(r.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(u,{placeholder:"State"})})})]}),e.jsx(r.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(u,{placeholder:"Country"})}),e.jsx(r.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(u,{placeholder:"https://www.example.com"})}),e.jsx(r.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(C,{placeholder:"Select Type",children:[e.jsx(i,{value:"Hot",children:"Hot"}),e.jsx(i,{value:"Warm",children:"Warm"}),e.jsx(i,{value:"Cold",children:"Cold"})]})}),e.jsx(r.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(C,{placeholder:"Select Status",children:[e.jsx(i,{value:"Active",children:"Lead"}),e.jsx(i,{value:"Pipeline",children:"Enquiry"}),e.jsx(i,{value:"Quotations",children:"Quotations"}),e.jsx(i,{value:"Customer",children:"Converted"}),e.jsx(i,{value:"Closed",children:"Closed"})]})}),e.jsx(r.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(C,{placeholder:"How did you hear about us?",children:[e.jsx(i,{value:"Direct",children:"Direct"}),e.jsx(i,{value:"socialmedia",children:"Social Media"}),e.jsx(i,{value:"online",children:"Online"}),e.jsx(i,{value:"client",children:"Client"}),e.jsx(i,{value:"tradefair",children:"Tradefair"}),e.jsx(i,{value:"Other",children:"Other"})]})}),e.jsx(r.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(C,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:w,showSearch:!0,optionFilterProp:"children",filterOption:(t,d)=>String(d.children||"").toLowerCase().includes(t.toLowerCase()),children:j&&j.map(t=>e.jsxs(i,{value:t._id,children:[t.name," (",t.role,")"]},t._id))})}),e.jsx(r.Item,{name:"selectedProduct",label:"Select Product",rules:[{required:!1,message:"Please select a product"}],children:e.jsx(C,{placeholder:"Select a product (optional)",allowClear:!0,loading:N,showSearch:!0,optionFilterProp:"children",filterOption:(t,d)=>String(d.children||"").toLowerCase().includes(t.toLowerCase()),children:b.map(t=>e.jsx(i,{value:t._id,children:t.productName},t._id))})}),e.jsx(r.Item,{name:"noteInput",label:"Add Note",children:e.jsx(ee,{rows:3,placeholder:"Add a note (it will be timestamped)"})})]})})},{TextArea:re}=u,{Title:le,Text:oe}=z,Ce=({visible:n,onClose:h,account:s,refreshAccounts:c})=>{const[j]=r.useForm(),[w,m]=o.useState(!1),[p,I]=o.useState([]);o.useEffect(()=>{n&&(s!=null&&s._id)&&I(s.notes||[])},[n,s]);const b=()=>{try{const a=JSON.parse(localStorage.getItem("user"));return(a==null?void 0:a.email)||"Unknown"}catch{return"Unknown"}},P=async()=>{try{const{note:a}=await j.validateFields();m(!0);const f={text:a,timestamp:new Date().toLocaleString(),author:b()},t=[...p,f];await F.put(`/api/accounts/${s._id}`,{...s,notes:t}),x.success("Note added successfully!"),I(t),j.resetFields(),c()}catch{x.error("Failed to add note.")}finally{m(!1)}},N=()=>!p||p.length===0?e.jsx(oe,{type:"secondary",children:"No notes to show"}):p.map((a,f)=>{const t=f>0?p[f-1]:null,d=new Date(a.timestamp).toDateString(),S=t?new Date(t.timestamp).toDateString():null,l=d!==S;return e.jsxs("div",{children:[l&&e.jsx("div",{className:"note-date-header",children:d}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[a.author,"    ",a.timestamp]}),e.jsx("div",{className:"note-text",children:a.text})]})]},f)});return e.jsxs($,{title:e.jsxs(le,{level:4,style:{margin:0},children:["Notes for ",s.businessName]}),open:n,onClose:h,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[N(),e.jsx(_,{}),e.jsxs(r,{form:j,layout:"vertical",children:[e.jsx(r.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(re,{rows:3,placeholder:"Type your note here...",disabled:w})}),e.jsx(L,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(H,{}),onClick:P,loading:w,block:!0,children:"Add Note"})]})]})},{TextArea:ae}=u,{Text:R}=z,Te=({visible:n,onClose:h,account:s,refreshAccounts:c})=>{const[j,w]=o.useState(""),[m,p]=o.useState(null),[I,b]=o.useState(!1),[P,N]=o.useState([]),[a,f]=o.useState(null);o.useEffect(()=>{n&&(s!=null&&s._id)?t():(N([]),f(null),w(""),p(null))},[n,s]);const t=async()=>{if(s!=null&&s._id){b(!0);try{const l=await F.get(`/api/accounts/${s._id}/followups`);N(l.data.sort((v,y)=>D(y.createdAt).diff(D(v.createdAt)))||[])}catch(l){console.error("Error fetching follow-ups:",l),x.error("Failed to fetch follow-ups")}finally{b(!1)}}},d=()=>{if(!j.trim()||!m){x.error("Please select a date and enter a note for the follow-up.");return}const l=JSON.parse(localStorage.getItem("user")),v=l==null?void 0:l._id;if(!v){x.error("User information not found. Please log in.");return}b(!0);const y={date:m.toISOString(),note:j.trim(),addedBy:v};(a===null?F.post(`/api/accounts/${s._id}/followups`,y):F.put(`/api/accounts/${s._id}/followups/${a._id}`,y)).then(()=>{x.success(a===null?"Follow-up added successfully!":"Follow-up updated successfully!"),w(""),p(null),f(null),t(),typeof c=="function"&&c()}).catch(A=>{var q,U;console.error("Error saving follow-up:",A),x.error(((U=(q=A==null?void 0:A.response)==null?void 0:q.data)==null?void 0:U.message)||"Failed to save follow-up.")}).finally(()=>b(!1))},S=l=>{var v,y;return e.jsx(B.Item,{children:e.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[e.jsx(k,{style:{marginRight:"5px",color:"#888"}}),e.jsx(R,{strong:!0,style:{marginRight:"10px",color:"#333"},children:((v=l.addedBy)==null?void 0:v.name)||((y=l.addedBy)==null?void 0:y.email)||"Unknown User"}),e.jsx(G,{style:{marginRight:"5px",color:"#888"}}),e.jsxs(R,{type:"secondary",style:{fontSize:"0.8em"},children:[D(l.createdAt).format("DD/MM/YYYY, h:mm:ss A")," "]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsx(W,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),e.jsx(R,{style:{flexGrow:1},children:l.note})]})]})})};return e.jsxs($,{title:`Follow-ups for Account: ${(s==null?void 0:s.businessName)||"N/A"}`,open:n,onClose:()=>{f(null),w(""),p(null),h()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(Y,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:m,onChange:l=>p(l),placeholder:"Select follow-up date"}),e.jsx(ae,{rows:4,placeholder:"Enter follow-up note",value:j,onChange:l=>w(l.target.value)}),e.jsx(L,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#ef7a1b",color:"white"},block:!0,onClick:d,loading:I,children:a===null?"Add Follow-up":"Update Follow-up"})]}),e.jsxs(_,{children:["All Follow-ups (",P.length,")"]}),e.jsx(B,{dataSource:P,renderItem:S,locale:{emptyText:"No follow-ups found for this account."},style:{marginTop:16}})]})};export{Ne as B,Te as F,Ce as N,Pe as R,Ie as a,Se as b};
