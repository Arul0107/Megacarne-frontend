import{r as n,p as e,B as h,s as r}from"./index-fS215O19.js";import{i as u}from"./axios-0yhrvgHk.js";import{B as G,N as J,S as Q}from"./NotesDrawer-CPn7qsAs.js";import{C as X,T as L}from"./index-3VpTVQao.js";import{T as Z}from"./index-DiK8nUoW.js";import{R as ee}from"./PlusOutlined-Cz-1buRv.js";import{I as te}from"./index-B-_pGqCM.js";import{R as se}from"./TextArea-Co8uFBok.js";import{F as A,R as ae}from"./Table-MfejmcjA.js";import{E as _}from"./index-DnhZLHTZ.js";import{M as ne}from"./index-BFHY3vVZ.js";import{R as oe}from"./MessageOutlined-B67BpbGW.js";import{T as f}from"./index-D8FCgLlF.js";import"./index-xsH4HHeE.js";import"./index-CnPqHcoB.js";import"./row-c-DpJoir.js";import"./index-BDnPFkYq.js";import"./context-i-CA71ds.js";import"./useClosable-D3UbAc8i.js";import"./index-DAphrRlW.js";import"./index-5cM7FWRD.js";import"./index-BYvt_HXh.js";const{Title:ie}=Z,{TabPane:k}=L,m="/api/accounts",ke=()=>{const[$,p]=n.useState(!1),[o,x]=n.useState(null),[y,R]=n.useState(""),[F,B]=n.useState("active"),[E,j]=n.useState(!1),[c,V]=n.useState(null),[v,D]=n.useState(null),[M,K]=n.useState([]),[O,g]=n.useState(!1),[S,q]=n.useState(null),[C,i]=n.useState(!1),l=()=>{i(!0),u.get(m).then(t=>{const s=t.data.filter(a=>!a.isCustomer);K(s),r.success("Leads loaded successfully")}).catch(()=>{r.error("Failed to load leads")}).finally(()=>i(!1))};n.useEffect(()=>{l()},[]);const H=t=>{i(!0),(o!=null&&o._id?u.put(`${m}/${o._id}`,t):u.post(m,t)).then(()=>{r.success(`Account ${o!=null&&o._id?"updated":"created"} successfully`),l()}).catch(()=>{r.error(`Failed to ${o!=null&&o._id?"update":"create"} account`)}).finally(()=>{p(!1),x(null),i(!1)})},P=t=>{x(t),p(!0)},U=t=>{q(t),g(!0)},W=(t,s)=>{V(s),D(t?"Active":"Inactive"),j(!0)},Y=()=>{i(!0);const t={...c,status:v};u.put(`${m}/${c._id}`,t).then(()=>{r.success("Status updated"),l()}).catch(()=>{r.error("Failed to update status")}).finally(()=>{j(!1),i(!1)})},z=t=>{i(!0),u.put(`${m}/${t._id}`,{...t,isCustomer:!0}).then(()=>{r.success("Converted to customer"),l()}).catch(()=>{r.error("Failed to convert")}).finally(()=>i(!1))},b=M.filter(t=>{var a,d,I;const s=y.toLowerCase();return((a=t.businessName)==null?void 0:a.toLowerCase().includes(s))||((d=t.contactName)==null?void 0:d.toLowerCase().includes(s))||((I=t.email)==null?void 0:I.toLowerCase().includes(s))}),T=b.filter(t=>t.status==="Active"),w=b.filter(t=>t.status==="Inactive"),N=[{title:"Sno.",render:(t,s,a)=>a+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(f,{color:"red",children:"Hot"});case"Warm":return e.jsx(f,{color:"orange",children:"Warm"});case"Cold":return e.jsx(f,{color:"blue",children:"Cold"});default:return e.jsx(f,{children:"Unknown"})}}},{title:"Latest Note",render:(t,s)=>{var d;const a=(d=s.notes)==null?void 0:d.at(-1);return a?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:a.timestamp}),e.jsx("br",{}),a.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsxs("span",{style:{color:s.status==="Inactive"?"red":"inherit"},children:[e.jsx(Q,{checked:s.status==="Active",onChange:a=>W(a,s),checkedChildren:"Active",unCheckedChildren:"Inactive"}),e.jsx("span",{style:{marginLeft:8},children:s.status})]})},{title:"Actions",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx(h,{icon:e.jsx(ae,{}),onClick:()=>P(s),type:"link"}),e.jsx(h,{icon:e.jsx(oe,{}),onClick:()=>U(s),type:"link"}),!s.isCustomer&&e.jsx(h,{type:"link",style:{color:"green"},onClick:()=>z(s),children:"Convert to Customer"})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(X,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx(ie,{level:4,children:"Leads"}),e.jsx(h,{type:"primary",icon:e.jsx(ee,{}),onClick:()=>{x(null),p(!0)},children:"Add Lead"})]}),e.jsx(te,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(se,{}),value:y,onChange:t=>R(t.target.value),style:{width:400,marginBottom:16}}),e.jsxs(L,{activeKey:F,onChange:B,children:[e.jsx(k,{tab:`Active (${T.length})`,children:e.jsx(A,{columns:N,dataSource:T,pagination:!1,rowKey:"_id",loading:C,locale:{emptyText:e.jsx(_,{description:"No active leads"})}})},"active"),e.jsx(k,{tab:`Inactive (${w.length})`,children:e.jsx(A,{columns:N,dataSource:w,pagination:!1,rowKey:"_id",loading:C,locale:{emptyText:e.jsx(_,{description:"No inactive leads"})}})},"inactive")]})]}),e.jsx(G,{visible:$,onClose:()=>p(!1),onSave:H,initialValues:o}),e.jsx(ne,{title:"Confirm Status Change",open:E,onOk:Y,onCancel:()=>j(!1),okText:"Yes",cancelText:"No",confirmLoading:C,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:c==null?void 0:c.businessName})," to ",e.jsx("strong",{children:v}),"?"]})}),S&&e.jsx(J,{visible:O,onClose:()=>g(!1),account:S,refreshAccounts:l})]})};export{ke as default};
