import{m as re,r as y,n as e,S as Ge,B as H,w as fe,V as z,ak as K,al as Pe,aC as De,a3 as Xe,am as qe,an as X}from"./index-BxUAznnX.js";import{u as me,w as We}from"./xlsx-CyWl6TWy.js";import{i as q}from"./axios-YBtE4rUB.js";import{F as _}from"./index-BjwwNMEl.js";import{D as ye}from"./index-CnAMJFg8.js";import{I as Z,b as Je}from"./index-PwdRyfCR.js";import{R as Ke}from"./SendOutlined-fo6gOtYX.js";import{T as pe}from"./index-aw9NpNYx.js";import{s as ve}from"./index-BsdlsR4j.js";import{D as de,d as xe}from"./index-y-AEraVK.js";import{D as I}from"./index-U6UYywSW.js";import{S as M}from"./index-BpNbUA2a.js";import{F as D}from"./Table-Di3FjhfK.js";import{M as ce}from"./index-CzaeX_mx.js";import{P as Oe}from"./index-Dw20VyBP.js";import{h as te}from"./moment-C5S46NFB.js";import{D as le}from"./index-BIwb_-H0.js";import{T as Re,R as Qe}from"./index-kMGBPy9G.js";import{L as ae}from"./index-DXs-2Fr8.js";import{E as Ze,h as et,R as tt}from"./html2canvas.esm-BGjCEV5z.js";import{C as st}from"./index-CxlRiecW.js";import{c as nt}from"./TextArea-B6Xpuu3I.js";import{T as Ee}from"./index-26GsdBxa.js";import{R as ot}from"./PrinterOutlined-DHZMuMrq.js";import{R as rt}from"./MessageOutlined-bCpa50s0.js";import{R as at}from"./ScheduleOutlined-Tle-Bm2q.js";import{R as lt}from"./DollarOutlined-BKFZVaeO.js";import{R as it}from"./EditOutlined-BKTsHuld.js";import{R as dt}from"./DeleteOutlined-DMMmF65q.js";var ie={exports:{}},ct=ie.exports,Me;function pt(){return Me||(Me=1,function(r,$){(function(n,u){u()})(ct,function(){function n(i,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function u(i,t,c){var a=new XMLHttpRequest;a.open("GET",i),a.responseType="blob",a.onload=function(){A(a.response,t,c)},a.onerror=function(){console.error("could not download file")},a.send()}function S(i){var t=new XMLHttpRequest;t.open("HEAD",i,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function b(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(t)}}var g=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof re=="object"&&re.global===re?re:void 0,f=g.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),A=g.saveAs||(typeof window!="object"||window!==g?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(i,t,c){var a=g.URL||g.webkitURL,x=document.createElement("a");t=t||i.name||"download",x.download=t,x.rel="noopener",typeof i=="string"?(x.href=i,x.origin===location.origin?b(x):S(x.href)?u(i,t,c):b(x,x.target="_blank")):(x.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(x.href)},4e4),setTimeout(function(){b(x)},0))}:"msSaveOrOpenBlob"in navigator?function(i,t,c){if(t=t||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(n(i,c),t);else if(S(i))u(i,t,c);else{var a=document.createElement("a");a.href=i,a.target="_blank",setTimeout(function(){b(a)})}}:function(i,t,c,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof i=="string")return u(i,t,c);var x=i.type==="application/octet-stream",O=/constructor/i.test(g.HTMLElement)||g.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||x&&O||f)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var N=m.result;N=E?N:N.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=N:location=N,a=null},m.readAsDataURL(i)}else{var T=g.URL||g.webkitURL,j=T.createObjectURL(i);a?a.location=j:location.href=j,a=null,setTimeout(function(){T.revokeObjectURL(j)},4e4)}});g.saveAs=A.saveAs=A,r.exports=A})}(ie)),ie.exports}var _e=pt();const{TextArea:ut}=Z,mt=({visible:r,onClose:$,account:n,invoice:u,refreshInvoices:S,refreshAccounts:b})=>{const[g]=_.useForm(),[f,A]=y.useState([]),[i,t]=y.useState(!1);y.useEffect(()=>{var T;const m=((T=u||n)==null?void 0:T.notes)||[];A(Array.isArray(m)?m:[])},[u,n]);const c=()=>{try{const m=JSON.parse(localStorage.getItem("user"));return(m==null?void 0:m.name)||(m==null?void 0:m.email)||"Unknown"}catch{return"Unknown"}},a=()=>u?`/api/invoices/${u._id}`:`/api/accounts/${n._id}`,x=async({note:m})=>{if(!m)return;const T={text:m,timestamp:new Date().toISOString(),addedBy:c()},j=[...f,T];try{t(!0),await q.put(a(),{...u||n,notes:j}),ve.success("Note added"),A(j),g.resetFields(),u?S==null||S():b==null||b()}catch(N){console.error("Failed to add note:",N),ve.error("Failed to add note")}finally{t(!1)}},E=(m=>{const T={};return m.forEach(j=>{if(!j||typeof j!="object")return;const N=j.timestamp?new Date(j.timestamp).toLocaleDateString():"Unknown Date";T[N]||(T[N]=[]),T[N].push(j)}),T})(f);return e.jsx(ye,{title:e.jsxs("div",{children:["Notes for ",u?"Invoice":"Account"," ",e.jsxs(pe.Text,{code:!0,children:["#",(u==null?void 0:u.invoiceNumber)||(n==null?void 0:n.businessName)]})]}),open:r,onClose:$,width:450,destroyOnClose:!0,children:e.jsxs(Ge,{spinning:i,children:[e.jsx("div",{style:{padding:"0 8px"},children:Object.entries(E).map(([m,T])=>e.jsxs("div",{children:[e.jsx("div",{className:"note-date-header",children:m}),T.map((j,N)=>e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[j.addedBy||"Unknown"," • ",j.timestamp?new Date(j.timestamp).toLocaleTimeString():""]}),e.jsx("div",{className:"note-text",children:typeof j.text=="string"?j.text:JSON.stringify(j.text)})]},N))]},m))}),e.jsxs(_,{form:g,layout:"vertical",onFinish:x,style:{marginTop:16},children:[e.jsx(_.Item,{name:"note",rules:[{required:!0,message:"Enter note"}],children:e.jsx(ut,{rows:3,placeholder:"Type your note here..."})}),e.jsx(H,{htmlType:"submit",type:"primary",icon:e.jsx(Ke,{}),block:!0,children:"Add Note"})]})]})})},{Text:he}=pe,xt=({visible:r,onClose:$,invoice:n,refreshInvoices:u})=>{var L;const[S]=_.useForm(),[b]=_.useForm(),[g,f]=y.useState(!1),[A,i]=y.useState({paymentHistory:[]}),[t,c]=y.useState(!1),[a,x]=y.useState(null),[O,E]=y.useState(0),[m,T]=y.useState(0),[j,N]=y.useState(!1),Y=h=>{const w=h.paymentHistory.reduce((C,U)=>C+U.amount,0);if(E(w),n!=null&&n.totalAmount){const C=n.totalAmount-w;T(C),N(C<=.01)}else T(0),N(!1)},G=()=>{try{const h=JSON.parse(localStorage.getItem("user"));return(h==null?void 0:h.email)||"Unknown"}catch{return"Unknown"}},p=async()=>{if(n!=null&&n._id)try{const h=await q.get(`/api/invoices/${n._id}`),w={...h.data,paymentHistory:Array.isArray(h.data.paymentHistory)?h.data.paymentHistory:[]};i(w),Y(w)}catch(h){z.error("Failed to fetch invoice details."),console.error("Error fetching invoice:",h),i({paymentHistory:[]}),Y({paymentHistory:[]})}};y.useEffect(()=>{r&&p()},[r,n==null?void 0:n._id]),y.useEffect(()=>{Y(A)},[n==null?void 0:n.totalAmount,A.paymentHistory]);const V=async h=>{const w=parseFloat(h.amount);if(isNaN(w)||w<=0){z.error("Please enter a valid positive amount!");return}const C=A.paymentHistory.reduce((W,ue)=>W+ue.amount,0),U=(n==null?void 0:n.totalAmount)||0;if(C+w>U+.01){z.error(`Payment amount exceeds outstanding balance. Outstanding: ₹${(U-C).toFixed(2)}`);return}f(!0);try{const W={...h,date:h.date.format("YYYY-MM-DD"),addedBy:G()};await q.post(`/api/invoices/${n._id}/payments`,W),z.success("Payment added successfully!"),S.resetFields(),await p(),u()}catch(W){z.error("Failed to add payment."),console.error("Error adding payment:",W)}finally{f(!1)}},d=async h=>{try{await q.delete(`/api/invoices/${n._id}/payments/${h}`),z.success("Payment deleted successfully!"),await p(),u()}catch(w){z.error("Failed to delete payment."),console.error("Error deleting payment:",w)}},P=async h=>{try{const w={...h,date:h.date.format("YYYY-MM-DD")};await q.put(`/api/invoices/${n._id}/payments/${a}`,w),z.success("Payment updated successfully!"),c(!1),await p(),u()}catch(w){z.error("Failed to update payment."),console.error("Error updating payment:",w)}},B=[{title:"Amount",dataIndex:"amount",key:"amount",render:h=>`₹${Number(h).toFixed(2)}`},{title:"Method",dataIndex:"method",key:"method"},{title:"Reference",dataIndex:"reference",key:"reference"},{title:"Date",dataIndex:"date",key:"date",render:h=>xe(h).format("DD/MM/YYYY")},{title:"Added By",dataIndex:"addedBy",key:"addedBy"},{title:"Actions",key:"actions",render:(h,w)=>e.jsxs(fe,{size:"middle",children:[e.jsx(H,{type:"link",onClick:()=>{x(w._id),b.setFieldsValue({amount:w.amount,method:w.method,reference:w.reference,date:xe(w.date)}),c(!0)},children:"Edit"}),e.jsx(Oe,{title:"Are you sure to delete this payment?",onConfirm:()=>d(w._id),okText:"Yes",cancelText:"No",children:e.jsx(H,{type:"link",danger:!0,children:"Delete"})})]})}];return e.jsxs(ye,{title:`Payment History for Invoice #${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,placement:"right",onClose:$,open:r,width:720,children:[e.jsxs(I,{bordered:!0,column:1,size:"small",style:{marginBottom:20},children:[e.jsx(I.Item,{label:"Invoice Total",children:e.jsxs(he,{strong:!0,children:["₹",((L=n==null?void 0:n.totalAmount)==null?void 0:L.toFixed(2))||"0.00"]})}),e.jsx(I.Item,{label:"Total Paid",children:e.jsxs(he,{strong:!0,style:{color:O>0?"green":"inherit"},children:["₹",O.toFixed(2)]})}),e.jsx(I.Item,{label:"Outstanding Balance",children:e.jsxs(he,{strong:!0,style:{color:m>0?"red":"green"},children:["₹",m.toFixed(2)]})})]}),!j&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Add New Payment"}),e.jsx(_,{form:S,layout:"vertical",onFinish:V,style:{marginBottom:20},children:e.jsxs(fe,{children:[e.jsx(_.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please input amount!"}],children:e.jsx(Z,{type:"number",step:"0.01"})}),e.jsx(_.Item,{name:"method",label:"Method",rules:[{required:!0,message:"Please select method!"}],children:e.jsxs(M,{style:{width:120},children:[e.jsx(M.Option,{value:"Cash",children:"Cash"}),e.jsx(M.Option,{value:"UPI",children:"UPI"}),e.jsx(M.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(M.Option,{value:"Card",children:"Card"})]})}),e.jsx(_.Item,{name:"reference",label:"Reference",children:e.jsx(Z,{})}),e.jsx(_.Item,{name:"date",label:"Date",rules:[{required:!0,message:"Please select date!"}],children:e.jsx(de,{style:{width:"100%"},defaultValue:xe(),format:"DD/MM/YYYY"})}),e.jsx(H,{type:"primary",htmlType:"submit",loading:g,children:"Add Payment"})]})})]}),e.jsx("h3",{children:"Payment History"}),e.jsx(D,{dataSource:A.paymentHistory,columns:B,rowKey:"_id",pagination:!1,scroll:{x:"max-content"}}),e.jsx(ce,{open:t,title:"Edit Payment Entry",onCancel:()=>c(!1),onOk:()=>b.submit(),okText:"Update",cancelText:"Cancel",children:e.jsxs(_,{layout:"vertical",form:b,onFinish:P,children:[e.jsx(_.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(Z,{type:"number"})}),e.jsx(_.Item,{name:"method",label:"Method",rules:[{required:!0}],children:e.jsxs(M,{children:[e.jsx(M.Option,{value:"Cash",children:"Cash"}),e.jsx(M.Option,{value:"UPI",children:"UPI"}),e.jsx(M.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(M.Option,{value:"Card",children:"Card"})]})}),e.jsx(_.Item,{name:"reference",label:"Reference",rules:[{required:!0}],children:e.jsx(Z,{})}),e.jsx(_.Item,{name:"date",label:"Date",rules:[{required:!0}],children:e.jsx(de,{style:{width:"100%"},format:"DD/MM/YYYY"})})]})})]})},{TextArea:ht}=Z,{TabPane:ge}=Re,{Text:Be}=pe,gt=({visible:r,onClose:$,invoice:n,refreshInvoices:u})=>{const[S,b]=y.useState(""),[g,f]=y.useState(null),[A,i]=y.useState(!1),[t,c]=y.useState([]),[a,x]=y.useState(null);y.useEffect(()=>{r&&(n!=null&&n._id)&&O()},[r,n]);const O=async()=>{try{const d=await q.get(`/api/invoices/${n._id}/followups`);c(d.data||[])}catch(d){console.error("Failed to fetch follow-ups:",d),K.error("Failed to fetch follow-ups")}},E=()=>{if(!S||!g){K.error("Please fill in both date and note fields.");return}const d=JSON.parse(localStorage.getItem("user")),P=d==null?void 0:d._id;if(!P){K.error("User information not found. Please log in.");return}i(!0);const B={date:g.format("YYYY-MM-DD"),note:S,addedBy:P};(a===null?q.post(`/api/invoices/${n._id}/followups`,B):q.put(`/api/invoices/${n._id}/followups/${a}`,B)).then(()=>{K.success(a===null?"Follow-up added successfully!":"Follow-up updated successfully!"),b(""),f(null),x(null),O(),u()}).catch(h=>{var w,C;console.error("Error saving follow-up:",h),K.error(((C=(w=h==null?void 0:h.response)==null?void 0:w.data)==null?void 0:C.message)||"Failed to save follow-up.")}).finally(()=>i(!1))},m=d=>{const P=t[d];b(P.note),f(te(P.date)),x(d)},T=d=>{ce.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up? This action cannot be undone.",okText:"Yes, Delete",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{q.delete(`/api/invoices/${n._id}/followups/${d}`).then(()=>{K.success("Follow-up deleted successfully!"),O(),u()}).catch(P=>{var B,L;console.error("Error deleting follow-up:",P),K.error(((L=(B=P==null?void 0:P.response)==null?void 0:B.data)==null?void 0:L.message)||"Failed to delete follow-up.")})}})},j=te().format("YYYY-MM-DD"),N=[...t].sort((d,P)=>new Date(P.date)-new Date(d.date)),Y=N.filter(d=>te(d.date).format("YYYY-MM-DD")===j),G=N.filter(d=>te(d.date).isAfter(j,"day")),p=N.filter(d=>te(d.date).isBefore(j,"day")),V=(d,P)=>{var B,L;return e.jsx(ae.Item,{actions:[e.jsx(H,{type:"link",onClick:()=>m(P),children:"Edit"},"edit"),e.jsx(H,{type:"link",danger:!0,onClick:()=>T(P),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(Be,{strong:!0,children:te(d.date).format("DD-MM-YYYY")}),e.jsx("br",{}),d.note,e.jsx("br",{}),e.jsxs(Be,{type:"secondary",children:["By ",((B=d.addedBy)==null?void 0:B.name)||((L=d.addedBy)==null?void 0:L.email)||"Unknown User"]})]})})};return e.jsxs(ye,{title:`Follow-ups for Invoice: ${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,open:r,onClose:()=>{x(null),b(""),f(null),$()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(de,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:g,onChange:d=>f(d),placeholder:"Select follow-up date"}),e.jsx(ht,{rows:4,placeholder:"Enter follow-up note",value:S,onChange:d=>b(d.target.value)}),e.jsx(H,{type:"primary",block:!0,onClick:E,loading:A,style:{marginTop:10},children:a===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(le,{children:"Existing Follow-ups"}),e.jsxs(Re,{defaultActiveKey:"today",children:[e.jsx(ge,{tab:`Today's (${Y.length})`,children:e.jsx(ae,{dataSource:Y,renderItem:d=>V(d,t.indexOf(d)),locale:{emptyText:"No follow-ups scheduled for today."}})},"today"),e.jsx(ge,{tab:`Upcoming (${G.length})`,children:e.jsx(ae,{dataSource:G,renderItem:d=>V(d,t.indexOf(d)),locale:{emptyText:"No upcoming follow-ups."}})},"upcoming"),e.jsx(ge,{tab:`Past (${p.length})`,children:e.jsx(ae,{dataSource:p,renderItem:d=>V(d,t.indexOf(d)),locale:{emptyText:"No past follow-ups."}})},"past")]})]})},Q=r=>isNaN(r)?"0.00":r.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),ft=r=>{if(typeof r!="number"||isNaN(r))return"N/A";let $=Math.floor(r),n=Math.round((r-$)*100);const u=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],S=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],b=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],g=["","Thousand","Lakh","Crore"],f=a=>a<10?u[a]:a>=10&&a<20?S[a-10]:b[Math.floor(a/10)]+(a%10!==0?" "+u[a%10]:"");let A=[],i=0;if($===0)A.push("Zero");else{let a=$%1e3;for(a>0&&(a<100?A.push(f(a)):A.push(u[Math.floor(a/100)]+" Hundred"+(a%100!==0?" "+f(a%100):""))),$=Math.floor($/1e3);$>0;){let x=$%100;x>0?A.push(f(x)+" "+g[++i]):i++,$=Math.floor($/100)}}const t=A.reverse().filter(Boolean).join(" ").trim();let c=t?t+" Rupees":"Zero Rupees";return n>0&&(c+=` and ${f(n)} Paisa`),c+=" Only",c.replace(/\s+/g," ")},yt=r=>{var E,m,T,j,N,Y,G;const $=((E=r.businessId)==null?void 0:E.contactName)||r.contactName||"N/A",n=r.mobileNumber||((m=r.businessId)==null?void 0:m.mobileNumber)||((T=r.businessId)==null?void 0:T.phone)||"N/A",u=((j=r.businessId)==null?void 0:j.email)||r.email||"N/A",S=((N=r.businessId)==null?void 0:N.gstNumber)||r.gstin||"N/A",b=r.businessId?`${r.businessId.addressLine1||""}, ${r.businessId.addressLine2||""}, ${r.businessId.addressLine3||""}, ${r.businessId.city||""} - ${r.businessId.pincode||""}, ${r.businessId.state||""}, ${r.businessId.country||""}`:r.customerAddress||"N/A",g=parseFloat(r.subTotal)||0,f=parseFloat(r.igstAmount)||0,A=parseFloat(r.cgstAmount)||0,i=parseFloat(r.sgstAmount)||0,t=parseFloat(r.totalAmount)||0,c=Pe,a=Pe,x=()=>{if(r.gstType==="interstate")return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">IGST (${r.gstPercentage||0}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Q(f)}</td>
                </tr>
            `;if(r.gstType==="intrastate"){const p=(r.gstPercentage||0)/2;return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">CGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Q(A)}</td>
                </tr>
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">SGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Q(i)}</td>
                </tr>
            `}return""},O=r.notes&&Array.isArray(r.notes)&&r.notes.length>0?r.notes.map(p=>`<p style="margin: 2px 0;">${p.text}</p>`).join(""):'<p style="margin: 2px 0;">Thank you for your business!</p>';return`
    <div style="padding: 10px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; width: 100%; box-sizing: border-box;">
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="display: flex; align-items: center;">
                    <img src="${c}" alt="Company Logo" style="height: 60px; margin-right: 10px;">
                    <div>
                        <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 3px;">ACE AUTOMATION</h2>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">S.F. No. 91, 14B, Padiveedu Thottam,</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Kalapatty road, Saravanampatti (PO),</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Coimbatore - 641 035. TN, INDIA.</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">+91 98422 53389 | aceautomation.cbe@gmail.com</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">www.aceautomation.in | GST No. : 33AVDPD3093Q1ZD</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; padding: 10px 20px; font-weight: 600; font-size: 18px; text-align: center; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    TAX INVOICE
                </div>
            </div>
            <div style="border-bottom: 1px solid #eee; margin-bottom: 10px;"></div>
        </div>

        <div style="margin-bottom: 20px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Bill To</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${((Y=r.businessId)==null?void 0:Y.businessName)||r.customerName||"N/A"}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Invoice No</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${r.invoiceNumber||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Contact Person</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${$}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${r.date||new Date().toLocaleDateString("en-IN")}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Mobile</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${n}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Due Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${r.dueDate||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Email</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${u}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">GSTIN</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${S}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Address</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${b}
                    </td>
                </tr>
            </table>
        </div>

        ${((G=r.items)==null?void 0:G.length)>0?`
                <div style="margin-top: 20px; overflow: hidden; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; font-size: 11px;">
                        <colgroup>
                            <col style="width: 5%;"> <col style="width: 20%;"> <col style="width: 25%;"> <col style="width: 10%;"> <col style="width: 8%;"> <col style="width: 12%;"> <col style="width: 10%;"> <col style="width: 10%;"> </colgroup>
                        <thead>
                            <tr style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white;">
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">S.No</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Product Name</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Specification</th>
                                <th style="1px solid #2c3e50; padding: 8px; text-align: center;">Qty</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">HSN/SAC</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Unit Price (₹)</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Total (₹)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${r.items.map((p,V)=>{var w;let d=(p==null?void 0:p.productName)||(p==null?void 0:p.description)||"";if(!d&&((w=p.specifications)==null?void 0:w.length)>0){const C=p.specifications.find(U=>U.name==="Model");C?d=C.value:p.specifications.length>0&&(d=p.specifications.map(U=>`${U.name}: ${U.value}`).join(", "))}d=d||"N/A";const P=p!=null&&p.specifications&&p.specifications.length>0?p.specifications.map(C=>`${C.name}: ${C.value}`).join(", "):"N/A",B=parseFloat(p.quantity)||0,L=parseFloat(p.rate)||0,h=(B*L).toFixed(2);return`
                                    <tr style="${V%2===0?"background: #fff;":"background: #f9fafb;"}">
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${V+1}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${d}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${P}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${B}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.quantityType||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.hsnSac||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; vertical-align: top;">₹${Q(L)}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; vertical-align: top;">₹${Q(parseFloat(h))}</td>
                                    </tr>
                                `}).join("")}
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 15px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%; background: #f0f2f5;">Sub Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%;">₹${Q(g)}</td>
                        </tr>
                        ${x()}
                        <tr style="background: #e8f5e9;">
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">Grand Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">₹${Q(t)}</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-top: 10px; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="font-weight: 600; padding: 3px; width: 25%; color: #555;">Amount In Words</td>
                            <td style="padding: 3px; font-style: italic; width: 75%;">${ft(t)}</td>
                        </tr>
                    </table>
                </div>
            `:""}

        <div style="margin-top: 15px; font-size: 11px; color: #555;">
            <p style="margin: 4px 0; font-weight: 600; color: #2c3e50;">Payment Terms:</p>
            <p style="margin: 1px 0;">${r.paymentTerms||"Payment due within 15 days of invoice date."}</p>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Notes:</p>
            <div style="margin-left: 5px;">
                ${O}
            </div>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Bank Details:</p>
            <p style="margin: 1px 0;">Bank Name: Your Bank Name</p>
            <p style="margin: 1px 0;">Account Number: XXXXXXXXXXXX</p>
            <p style="margin: 1px 0;">IFSC Code: XXXXXXXXXX</p>
            <p style="1px 0;">Branch: Your Branch Name</p>
        </div>

        <div style="margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;">
            <div style="text-align: right;">
                <img src="${a}" alt="Authorized Signature" style="height: 50px; display: block; margin-left: auto; margin-bottom: 3px;">
                <p style="margin: 4px 0; font-size: 11px; font-weight: 600; color: #2c3e50;">Authorized Signatory</p>
            </div>
            <p style="text-align: center; font-size: 9px; color: #999; margin-top: 15px;">
                This is Computer Generated Invoice & requires no Signature
            </p>
        </div>
    </div>
    `},bt=async r=>{if(!r)return;const $=z.loading("Generating Invoice PDF...",{position:"top-center"});let n=null;try{const u=yt(r),S=new Ze({orientation:"portrait",unit:"mm",format:"a4",hotfixes:["px_scaling"]});S.setProperties({title:`Invoice - ${r.invoiceNumber}`,subject:"Invoice",author:r.companyName||"ACE AUTOMATION",keywords:"invoice, billing",creator:"Invoice Management System"});const b=S.internal.pageSize.getWidth(),g=S.internal.pageSize.getHeight(),f=5;n=document.createElement("div"),n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",n.style.width=`${b-2*f}mm`,n.style.background="white",n.style.zIndex="-1",n.style.display="block",n.innerHTML=u,document.body.appendChild(n),await new Promise(E=>setTimeout(E,200));const i=(await et(n,{scale:2,useCORS:!0,logging:!1,allowTaint:!0,letterRendering:!0,backgroundColor:"#ffffff"})).toDataURL("image/jpeg",.8),t=S.getImageProperties(i),c=t.height*(b-2*f)/t.width;let a=f,x=g-2*f;if(c>x){let E=c,m=0;for(S.addImage(i,"JPEG",f,a,b-2*f,c),E-=x,m-=x;E>0;)S.addPage(),S.addImage(i,"JPEG",f,m+a,b-2*f,c),E-=x,m-=x}else S.addImage(i,"JPEG",f,a,b-2*f,c);const O=S.output("blob");_e.saveAs(O,`invoice-${r.invoiceNumber||"draft"}.pdf`),z.success("Invoice PDF downloaded successfully!",{id:$})}catch(u){console.error("Error generating PDF:",u),z.error("Failed to generate PDF. Please try again.",{id:$})}finally{n&&document.body.contains(n)&&document.body.removeChild(n)}},{Text:k}=pe,{RangePicker:wt}=de,jt=({invoices:r,onAddNew:$,onEdit:n,onDelete:u,onSearch:S,refreshInvoices:b})=>{var je,Ie,Se,Ne,Ae,Te,Ce,Fe;const[g,f]=y.useState(""),[A,i]=y.useState(!1),[t,c]=y.useState(null),[a,x]=y.useState("all"),[O,E]=y.useState(!1),[m,T]=y.useState(!1),[j,N]=y.useState(!1),[Y,G]=y.useState(null),[p,V]=y.useState("all"),[d,P]=y.useState(!1),[B,L]=y.useState({}),h=[...new Set(r.map(s=>s.businessName))],w=y.useCallback(s=>{var F;const o=parseFloat(s.totalAmount)||0,l=((F=s.paymentHistory)==null?void 0:F.reduce((R,v)=>R+parseFloat(v.amount||0),0))||0;return o<=0?"N/A":l>=o-.01?"paid":l>0&&l<o?"partial":"pending"},[]);y.useEffect(()=>{const s={};r.forEach(o=>{s[o._id]=w(o)}),L(s)},[r,w]),y.useEffect(()=>{t&&console.log(`Selected Invoice ${t.invoiceNumber} isClosed: ${t.isClosed}`)},[t]);const C=y.useCallback(s=>isNaN(s)?"0.00":s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),[]),U=s=>{f(s),S(s)},W=s=>{c(s),i(!0)},ue=s=>{c(s),E(!0)},Le=s=>{c(s),N(!0)},Ye=s=>{c(s),P(!0)},Ue=s=>{c(s),T(!0)},ze=()=>{const s=be.map((v,J)=>({SNo:J+1,Number:v.invoiceNumber,Business:v.businessName,Customer:v.customerName,ContactName:v.contactName||"N/A",Email:v.email||"N/A",MobileNumber:v.mobileNumber||"N/A",TotalAmount:v.totalAmount||0,Date:v.date,DueDate:v.dueDate||"",Status:B[v._id]||v.paymentStatus})),o=me.json_to_sheet(s),l=me.book_new();me.book_append_sheet(l,o,"Invoices");const F=We(l,{bookType:"xlsx",type:"array"}),R=new Blob([F],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});_e.saveAs(R,`Invoices-${new Date().toISOString().split("T")[0]}.xlsx`)},be=r.filter(s=>{var ee,ne,oe,se,ke,$e;const o=s.invoiceType==="Invoice",l=!g||((ee=s.invoiceNumber)==null?void 0:ee.toLowerCase().includes(g.toLowerCase()))||((ne=s.businessName)==null?void 0:ne.toLowerCase().includes(g.toLowerCase()))||((oe=s.customerName)==null?void 0:oe.toLowerCase().includes(g.toLowerCase()))||((se=s.contactName)==null?void 0:se.toLowerCase().includes(g.toLowerCase()))||((ke=s.email)==null?void 0:ke.toLowerCase().includes(g.toLowerCase()))||(($e=s.mobileNumber)==null?void 0:$e.toLowerCase().includes(g.toLowerCase())),F=!Y||new Date(s.date)>=Y[0].toDate()&&new Date(s.date)<=Y[1].toDate(),R=B[s._id],v=a==="all"?!0:a==="overdue"?R!=="paid"&&new Date(s.dueDate)<new Date:R===a,J=p==="all"?!0:s.businessName===p;return o&&l&&F&&v&&J}),we=s=>{let o="red",l="Payment Pending";return s==="paid"?(o="green",l="Completed Payment"):s==="partial"&&(o="orange",l="Partial Payment"),e.jsx(Ee,{color:o,children:l})},He=()=>[{title:"S.No",width:60,align:"center",render:(s,o,l)=>l+1},{title:"Product Name",dataIndex:"productName",ellipsis:!0,render:(s,o)=>{var F;let l=s||o.description||"";if(!l&&((F=o.specifications)==null?void 0:F.length)>0){const R=o.specifications.find(v=>v.name==="Model");R&&(l=R.value)}return l||"N/A"}},{title:"Description",dataIndex:"description",ellipsis:!0,render:(s,o)=>{var l;if(!s&&((l=o.specifications)==null?void 0:l.length)>0){const F=o.specifications.find(R=>R.name==="SPECIFICATION");return F?F.value:"N/A"}return s||"N/A"}},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center",render:s=>s||"N/A"},{title:"Qty",dataIndex:"quantity",width:80,align:"center",render:s=>parseFloat(s)||0},{title:"Unit Price (₹)",width:140,align:"right",render:(s,o)=>C(o.rate||0)},{title:"Total (₹)",width:140,align:"right",render:(s,o)=>e.jsx(k,{strong:!0,style:{color:"#52c41a"},children:C((o.quantity||0)*(o.rate||0))})}],Ve=[{title:"S.No",render:(s,o,l)=>e.jsx(k,{strong:!0,children:l+1}),width:60},{title:"Invoice Number",render:(s,o)=>e.jsx(Ee,{icon:e.jsx(De,{}),color:"blue",children:o.invoiceNumber})},{title:"Business",render:(s,o)=>{var F;const l=((F=o.businessId)==null?void 0:F.businessName)||o.businessName;return e.jsx(Xe,{title:l,children:e.jsx(k,{strong:!0,children:l})})}},{title:"Contact Person",dataIndex:"contactName",render:(s,o)=>{var l;return((l=o.businessId)==null?void 0:l.contactName)||s||"N/A"}},{title:"Email",dataIndex:"email",render:(s,o)=>{var l;return((l=o.businessId)==null?void 0:l.email)||s||"N/A"}},{title:"Mobile",dataIndex:"mobileNumber",render:(s,o)=>{var l,F;return((l=o.businessId)==null?void 0:l.mobileNumber)||((F=o.businessId)==null?void 0:F.phoneNumber)||s||"N/A"}},{title:"Amount",dataIndex:"totalAmount",align:"right",render:s=>e.jsxs(k,{style:{color:"#52c41a"},children:["₹",s||0]})},{title:"Due Date",dataIndex:"dueDate",align:"center",render:s=>e.jsx(k,{children:s||"N/A"})},{title:"Payment Status",key:"paymentStatusLabel",align:"center",render:(s,o)=>{const l=B[o._id]||"pending";return we(l)}},{title:"Actions",width:80,render:(s,o)=>e.jsx(qe,{overlay:e.jsxs(X,{children:[e.jsx(X.Item,{icon:e.jsx(Je,{}),onClick:()=>W(o),children:"View Invoice Details"},"view"),e.jsx(X.Item,{icon:e.jsx(De,{}),onClick:()=>Ye(o),children:"View Item Specifications"},"view-specs"),e.jsx(X.Item,{icon:e.jsx(ot,{}),onClick:()=>bt(o),children:"Generate PDF"},"generate-pdf"),e.jsx(X.Item,{icon:e.jsx(rt,{}),onClick:()=>ue(o),children:"View Notes"},"view-notes"),e.jsx(X.Item,{icon:e.jsx(at,{}),onClick:()=>Ue(o),children:"Add/View Follow-ups"},"add-followup"),e.jsx(X.Item,{icon:e.jsx(lt,{}),onClick:()=>Le(o),children:"View Payments"},"view-payments"),!o.isClosed&&e.jsx(X.Item,{icon:e.jsx(it,{}),onClick:()=>n(o),children:"Edit Invoice"},"edit"),e.jsx(X.Item,{icon:e.jsx(dt,{}),disabled:o.isClosed,children:e.jsx(Oe,{title:o.isClosed?"This invoice is locked and cannot be deleted.":"Are you sure you want to delete this invoice? This action cannot be undone.",onConfirm:()=>u(o._id),okText:"Yes, Delete",cancelText:"No",disabled:o.isClosed,children:"Delete Invoice"})},"delete")]}),trigger:["click"],children:e.jsx(H,{icon:e.jsx(tt,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(st,{title:"Invoice Management",extra:e.jsxs(fe,{wrap:!0,children:[e.jsx(wt,{onChange:G,format:"YYYY-MM-DD"}),e.jsxs(M,{value:a,onChange:x,style:{width:140},children:[e.jsx(M.Option,{value:"all",children:"All Status"}),e.jsx(M.Option,{value:"paid",children:"Paid"}),e.jsx(M.Option,{value:"pending",children:"Pending"}),e.jsx(M.Option,{value:"partial",children:"Partial"}),e.jsx(M.Option,{value:"overdue",children:"Overdue"})]}),e.jsxs(M,{value:p,onChange:V,placeholder:"Filter by Business",style:{width:200},allowClear:!0,children:[e.jsx(M.Option,{value:"all",children:"All Businesses"}),h.map(s=>e.jsx(M.Option,{value:s,children:s},s))]}),e.jsx(Z.Search,{placeholder:"Search invoices",onSearch:U,onChange:s=>U(s.target.value),style:{width:240},allowClear:!0,prefix:e.jsx(nt,{})}),e.jsx(H,{onClick:ze,children:"Export Excel"}),e.jsx(H,{type:"primary",icon:e.jsx(Qe,{}),onClick:$,children:"New Invoice"})]}),children:e.jsx(D,{dataSource:be,columns:Ve,rowKey:"_id",pagination:{pageSize:10},bordered:!0,scroll:{x:!0}})}),e.jsx(ce,{title:"Invoice Details",open:A,onCancel:()=>i(!1),footer:e.jsx(H,{onClick:()=>i(!1),children:"Close"}),width:1e3,children:t&&e.jsxs("div",{children:[e.jsxs(I,{bordered:!0,column:2,size:"small",children:[e.jsx(I.Item,{label:"Invoice No",children:t.invoiceNumber}),e.jsx(I.Item,{label:"Date",children:t.date?new Date(t.date).toLocaleDateString("en-IN"):"N/A"}),e.jsx(I.Item,{label:"Due Date",children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-IN"):"N/A"}),e.jsx(I.Item,{label:"Business",children:t.businessName}),e.jsx(I.Item,{label:"Customer",children:t.contactName||t.customerName||"N/A"}),e.jsx(I.Item,{label:"Contact Person",children:t.contactName||"N/A"}),e.jsx(I.Item,{label:"Email",children:t.email||"N/A"}),e.jsx(I.Item,{label:"Mobile Number",children:t.mobileNumber||"N/A"}),e.jsx(I.Item,{label:"GSTIN",span:2,children:e.jsx(k,{code:!0,children:((je=t.businessId)==null?void 0:je.gstNumber)||t.gstin||"N/A"})}),e.jsx(I.Item,{label:"Business Info",span:2,children:e.jsx(k,{style:{whiteSpace:"pre-wrap"},children:t.businessId?`${t.businessId.addressLine1||""}
${t.businessId.addressLine2||""}
${t.businessId.addressLine3||""}
${t.businessId.city||""} - ${t.businessId.pincode||""}
${t.businessId.state||""}, ${t.businessId.country||""}`.trim():t.customerAddress||"N/A"})})]}),((Ie=t.items)==null?void 0:Ie.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{orientation:"left",children:["Items (",t.items.length,")"]}),e.jsx(D,{dataSource:t.items,columns:He(),pagination:!1,size:"small",rowKey:(s,o)=>`${t._id}-item-${o}`,bordered:!0,expandable:{expandedRowRender:s=>{var o;return e.jsx("div",{style:{margin:0,padding:0},children:((o=s.specifications)==null?void 0:o.length)>0&&e.jsx(I,{column:1,size:"small",children:s.specifications.filter(l=>l.name!=="SPECIFICATION").map((l,F)=>e.jsx(I.Item,{label:l.name,children:l.value},F))})})},rowExpandable:s=>{var o;return((o=s.specifications)==null?void 0:o.length)>0}},summary:s=>{const o=s.reduce((oe,se)=>oe+(se.quantity||0)*(se.rate||0),0),l=t.gstPercentage||0,F=t.gstType||"intrastate";let R=0,v=0,J=0,ee=0;F==="interstate"?(ee=o*(l/100),R=ee):(v=o*(l/200),J=o*(l/200),R=v+J);const ne=o+R;return e.jsxs(D.Summary,{fixed:!0,children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsx(k,{strong:!0,children:"Sub Total:"})}),e.jsx(D.Summary.Cell,{index:7,children:e.jsx(k,{strong:!0,children:C(o)})})]}),F==="interstate"?e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsxs(k,{strong:!0,children:["IGST (",l,"%):"]})}),e.jsx(D.Summary.Cell,{index:7,children:e.jsx(k,{strong:!0,children:C(ee)})})," "]}):e.jsxs(e.Fragment,{children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsxs(k,{strong:!0,children:["CGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(k,{strong:!0,children:C(v)})})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsxs(k,{strong:!0,children:["SGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(k,{strong:!0,children:C(J)})})]})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsx(k,{strong:!0,children:"Grand Total:"})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(k,{strong:!0,style:{color:"#52c41a"},children:C(ne)})})]}),e.jsx(D.Summary.Row,{children:e.jsx(D.Summary.Cell,{index:0,colSpan:6,children:e.jsxs(k,{italic:!0,children:["Amount in words:"," ","Rupees Only"]})})})]})}})]}),e.jsxs(I,{column:4,bordered:!0,size:"small",style:{marginTop:"20px"},children:[e.jsxs(I.Item,{label:"Sub Total",span:2,children:["₹",((Se=t.subTotal)==null?void 0:Se.toFixed(2))||"0.00"]}),t.gstType==="interstate"?e.jsxs(I.Item,{label:"IGST Amount",span:2,children:["₹",((Ne=t.igstAmount)==null?void 0:Ne.toFixed(2))||"0.00"]}):e.jsxs(e.Fragment,{children:[e.jsxs(I.Item,{label:"CGST Amount",span:1,children:["₹",((Ae=t.cgstAmount)==null?void 0:Ae.toFixed(2))||"0.00"]}),e.jsxs(I.Item,{label:"SGST Amount",span:1,children:["₹",((Te=t.sgstAmount)==null?void 0:Te.toFixed(2))||"0.00"]})]}),e.jsx(I.Item,{label:"Grand Total",span:2,children:e.jsxs(k,{strong:!0,style:{fontSize:"18px",color:"#52c41a"},children:["₹",((Ce=t.totalAmount)==null?void 0:Ce.toFixed(2))||"0.00"]})}),e.jsx(I.Item,{label:"Amount in Words",span:2,children:e.jsx(k,{italic:!0,children:"Rupees Only"})}),e.jsx(I.Item,{label:"Status",span:2,children:we(B[t._id])})]}),((Fe=t.notes)==null?void 0:Fe.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{orientation:"left",children:["Notes (",t.notes.length,")"]}),t.notes.map((s,o)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(k,{strong:!0,children:s.author})," on"," ",e.jsx(k,{type:"secondary",children:s.timestamp}),e.jsx("p",{children:s.text})]},o))]})]})}),e.jsx(ce,{title:"Item Specifications",open:d,onCancel:()=>P(!1),footer:e.jsx(H,{onClick:()=>P(!1),children:"Close"}),width:800,children:t&&t.items&&t.items.map((s,o)=>e.jsxs("div",{style:{marginBottom:"20px",border:"1px solid #f0f0f0",padding:"15px",borderRadius:"5px"},children:[e.jsxs(k,{strong:!0,style:{fontSize:"16px",marginBottom:"10px",display:"block"},children:["Item ",o+1,": ",s.productName||s.description||"N/A"]}),e.jsxs(I,{bordered:!0,column:2,size:"small",style:{marginBottom:"15px"},children:[e.jsx(I.Item,{label:"Name",children:s.productName||s.description||"N/A"}),e.jsxs(I.Item,{label:"Price",children:["₹",C(s.rate)]}),e.jsx(I.Item,{label:"Qty",children:s.quantity}),e.jsx(I.Item,{label:"Description",children:s.description||"N/A"})]}),s.specifications&&s.specifications.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(le,{orientation:"left",style:{margin:"15px 0"},children:e.jsx(k,{strong:!0,children:"Product Options"})}),e.jsx(D,{dataSource:s.specifications,columns:[{title:"Type",dataIndex:"name",render:l=>l||"N/A"},{title:"Description",dataIndex:"value",render:l=>l||"N/A"}],pagination:!1,size:"small",rowKey:(l,F)=>`spec-${F}`,bordered:!0})]})]},o))}),t&&e.jsx(mt,{visible:O,onClose:()=>E(!1),invoice:t,refreshInvoices:b}),t&&e.jsx(gt,{visible:m,onClose:()=>T(!1),invoice:t,refreshInvoices:b}),e.jsx(xt,{visible:j,onClose:()=>N(!1),invoice:t,refreshInvoices:b})]})},Kt=Object.freeze(Object.defineProperty({__proto__:null,default:jt},Symbol.toStringTag,{value:"Module"}));export{jt as I,mt as N,Kt as a};
