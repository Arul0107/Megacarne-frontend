import{r as x,I as Q,t as X,R as z,p as e,B as P,s as h}from"./index-Bq7SEXuf.js";import{F as t}from"./index-BnkNshhY.js";import{D as $}from"./index-DadFFg_X.js";import{R as T,C as p}from"./index-BOPJqWeZ.js";import{I as a,i as S}from"./axios-GhlsiOT5.js";import{T as Z}from"./index-DF_iAJZB.js";import{S as U}from"./index-gpSYoz0o.js";import{D as J}from"./index-Dsy7Z7ff.js";import{R as V,T as K}from"./index-CbdXlDe3.js";import{T as M}from"./index-SmLCrNGy.js";import{h as F}from"./moment-CYyrXtnG.js";import{D as ee}from"./index-46gWX4pY.js";import{L as C}from"./index-JPHp6_-t.js";import{M as se}from"./index-D0lY9ADb.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},re=function(f,r){return x.createElement(Q,X({},f,{ref:r,icon:te}))},ve=x.forwardRef(re);const{TextArea:le}=a,{Option:b}=U,Ie=({visible:j,onClose:f,onSave:r,initialValues:l})=>{var N;const[d]=t.useForm(),[y,g]=z.useState(!1),i=t.useWatch("sourceType",d);z.useEffect(()=>{d.resetFields(),l?d.setFieldsValue(l):d.setFieldsValue({sourceType:"Direct"})},[l,d]);const I=()=>{d.validateFields().then(n=>{g(!0);const v=new Date().toLocaleString(),o=n.noteInput?{text:n.noteInput,timestamp:v}:null,m=(l==null?void 0:l.notes)||[],u=o?[...m,o]:m,w={...n,notes:u};delete w.noteInput,w.sourceType!=="Facebook Referral"&&delete w.referralPersonName,r(w),h.success(`Account ${l?"updated":"created"} successfully!`),g(!1),f()}).catch(n=>{console.log("Validate Failed:",n),h.error("Please fill in all required fields.")})};return e.jsx($,{title:l?"Edit Business Account":"Create New Business Account",width:720,onClose:f,visible:j,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(P,{onClick:f,style:{marginRight:8},children:"Cancel"}),e.jsx(P,{onClick:I,type:"primary",loading:y,children:l?"Update Account":"Create Account"})]}),children:e.jsxs(t,{form:d,layout:"vertical",initialValues:l,children:[e.jsxs(T,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"contactName",label:"Contact Person Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsx(t.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})}),e.jsxs(T,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(p,{span:12,children:e.jsx(t.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(a,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(t.Item,{name:"landmark",label:"Landmark",children:e.jsx(a,{placeholder:"Landmark (Optional)"})}),e.jsxs(T,{gutter:16,children:[e.jsx(p,{span:8,children:e.jsx(t.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(p,{span:8,children:e.jsx(t.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(Z,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(p,{span:8,children:e.jsx(t.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(t.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(t.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(t.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(U,{placeholder:"Select Type",children:[e.jsx(b,{value:"Hot",children:"Hot"}),e.jsx(b,{value:"Warm",children:"Warm"}),e.jsx(b,{value:"Cold",children:"Cold"})]})}),e.jsx(t.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(U,{placeholder:"How did you hear about us?",children:[e.jsx(b,{value:"Direct",children:"Direct"}),e.jsx(b,{value:"Facebook Referral",children:"Facebook Referral"}),e.jsx(b,{value:"Google Ads",children:"Google Ads"}),e.jsx(b,{value:"Website",children:"Website"}),e.jsx(b,{value:"Cold Call",children:"Cold Call"}),e.jsx(b,{value:"Other",children:"Other"})]})}),i==="Facebook Referral"&&e.jsx(t.Item,{name:"referralPersonName",label:"Referral Person Name",rules:[{required:!0,message:"Please enter the referral person's name"}],children:e.jsx(a,{placeholder:"Name of the person who referred from Facebook"})}),e.jsx(t.Item,{name:"noteInput",label:"Add Note",children:e.jsx(le,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((N=l==null?void 0:l.notes)==null?void 0:N.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:l.notes.map((n,v)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[n.timestamp,":"]})," ",n.text]},v))})]})]})})},{TextArea:oe}=a,{Title:ae,Text:ne}=M,Fe=({visible:j,onClose:f,account:r,refreshAccounts:l})=>{const[d]=t.useForm(),[y,g]=x.useState(!1),[i,I]=x.useState([]);x.useEffect(()=>{j&&(r!=null&&r._id)&&I(r.notes||[])},[j,r]);const N=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},n=async()=>{try{const{note:o}=await d.validateFields();g(!0);const m={text:o,timestamp:new Date().toLocaleString(),author:N()},u=[...i,m];await S.put(`/api/accounts/${r._id}`,{...r,notes:u}),h.success("Note added successfully!"),I(u),d.resetFields(),l()}catch{h.error("Failed to add note.")}finally{g(!1)}},v=()=>!i||i.length===0?e.jsx(ne,{type:"secondary",children:"No notes to show"}):i.map((o,m)=>{const u=m>0?i[m-1]:null,w=new Date(o.timestamp).toDateString(),A=u?new Date(u.timestamp).toDateString():null,k=w!==A;return e.jsxs("div",{children:[k&&e.jsx("div",{className:"note-date-header",children:w}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[o.author,"    ",o.timestamp]}),e.jsx("div",{className:"note-text",children:o.text})]})]},m)});return e.jsxs($,{title:e.jsxs(ae,{level:4,style:{margin:0},children:["Notes for ",r.businessName]}),open:j,onClose:f,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[v(),e.jsx(J,{}),e.jsxs(t,{form:d,layout:"vertical",children:[e.jsx(t.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(oe,{rows:3,placeholder:"Type your note here...",disabled:y})}),e.jsx(P,{type:"primary",icon:e.jsx(V,{}),onClick:n,loading:y,block:!0,children:"Add Note"})]})]})},{TextArea:de}=a,{TabPane:q}=K,De=({visible:j,onClose:f,account:r,refreshAccounts:l})=>{const[d,y]=x.useState(""),[g,i]=x.useState(null),[I,N]=x.useState(!1),[n,v]=x.useState([]),[o,m]=x.useState(null);x.useEffect(()=>{j&&(r!=null&&r._id)&&u()},[j,r]);const u=async()=>{try{const s=await S.get(`/api/accounts/${r._id}/followups`);v(s.data||[])}catch{h.error("Failed to fetch follow-ups")}},w=()=>{if(!d||!g){h.error("Please fill in all fields");return}const s=JSON.parse(localStorage.getItem("user")),c=s==null?void 0:s._id;if(!c){h.error("User not found");return}N(!0);const D={date:g.format("YYYY-MM-DD"),note:d,addedBy:c};(o===null?S.post(`/api/accounts/${r._id}/followups`,D):S.put(`/api/accounts/${r._id}/followups/${o}`,D)).then(()=>{h.success(o===null?"Follow-up added":"Follow-up updated"),y(""),i(null),m(null),u(),l()}).catch(R=>{var W,G;h.error(((G=(W=R==null?void 0:R.response)==null?void 0:W.data)==null?void 0:G.message)||"Failed to save follow-up")}).finally(()=>N(!1))},A=s=>{const c=n[s];y(c.note),i(F(c.date)),m(s)},k=s=>{se.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up?",okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{S.delete(`/api/accounts/${r._id}/followups/${s}`).then(()=>{h.success("Follow-up deleted"),u(),l()}).catch(()=>h.error("Failed to delete follow-up"))}})},L=F().format("YYYY-MM-DD"),Y=[...n].sort((s,c)=>new Date(c.date)-new Date(s.date)),E=Y.filter(s=>F(s.date).format("YYYY-MM-DD")===L),_=Y.filter(s=>F(s.date).isAfter(L,"day")),H=Y.filter(s=>F(s.date).isBefore(L,"day")),B=(s,c)=>{var D,O;return e.jsx(C.Item,{actions:[e.jsx("a",{onClick:()=>A(c),children:"Edit"},"edit"),e.jsx("a",{onClick:()=>k(c),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(M.Text,{strong:!0,children:F(s.date).format("DD-MM-YYYY")}),e.jsx("br",{}),s.note,e.jsx("br",{}),e.jsxs(M.Text,{type:"secondary",children:["By ",((D=s.addedBy)==null?void 0:D.name)||((O=s.addedBy)==null?void 0:O.email)||"Unknown"]})]})})};return e.jsxs($,{title:`Follow-ups: ${r==null?void 0:r.businessName}`,open:j,onClose:()=>{m(null),y(""),i(null),f()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(ee,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:g,onChange:s=>i(s)}),e.jsx(de,{rows:4,placeholder:"Enter follow-up note",value:d,onChange:s=>y(s.target.value)}),e.jsx(P,{type:"primary",block:!0,onClick:w,loading:I,style:{marginTop:10},children:o===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(J,{}),e.jsxs(K,{defaultActiveKey:"today",children:[e.jsx(q,{tab:`Today's Follow-ups (${E.length})`,children:e.jsx(C,{dataSource:E,renderItem:(s,c)=>B(s,n.indexOf(s)),locale:{emptyText:"No follow-ups for today"}})},"today"),e.jsx(q,{tab:`Upcoming Follow-ups (${_.length})`,children:e.jsx(C,{dataSource:_,renderItem:(s,c)=>B(s,n.indexOf(s)),locale:{emptyText:"No upcoming follow-ups"}})},"upcoming"),e.jsx(q,{tab:`Past Follow-ups (${H.length})`,children:e.jsx(C,{dataSource:H,renderItem:(s,c)=>B(s,n.indexOf(s)),locale:{emptyText:"No past follow-ups"}})},"past")]})]})};export{Ie as B,De as F,Fe as N,ve as R};
