import{r as c,I as E,e as _,x as e,B as D,an as y,K as M}from"./index-CNsAxfGJ.js";import{F as t}from"./index-D423zgUx.js";import{D as R}from"./index-Dy-31xHo.js";import{R as T,C as h}from"./TextArea-DKzxOqx8.js";import{I as a}from"./index-DzLXiL0j.js";import{T as Y}from"./index-B54T0t6-.js";import{S as A}from"./index-CpsewJ9b.js";import{i as P}from"./axios-YBtE4rUB.js";import{D as U}from"./index-DtupPNVk.js";import{R as G}from"./index-CjcVXFIv.js";import{T as $}from"./index-2H_wPnT3.js";import{h as L}from"./moment-C5S46NFB.js";import{D as H,d as W}from"./index-BSvTAXtO.js";import{L as O}from"./index-zyGHzt1c.js";import{R as z}from"./MessageOutlined-B107IwQ_.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},K=function(f,s){return c.createElement(E,_({},f,{ref:s,icon:J}))},fe=c.forwardRef(K);const{TextArea:Q}=a,{Option:d}=A,ge=({visible:x,onClose:f,onSave:s,initialValues:o,allUsers:j,loadingUsers:g})=>{var v;const[i]=t.useForm(),[m,b]=c.useState(!1);t.useWatch("sourceType",i),c.useEffect(()=>{var r;i.resetFields(),o?i.setFieldsValue({...o,assignedTo:((r=o.assignedTo)==null?void 0:r._id)||null}):i.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null})},[o,i]);const w=()=>{i.validateFields().then(r=>{b(!0);const l=new Date().toLocaleString(),u=r.noteInput?{text:r.noteInput,timestamp:l}:null,p=(o==null?void 0:o.notes)||[],I=u?[...p,u]:p,S={...r,notes:I,assignedTo:r.assignedTo===null?null:r.assignedTo};delete S.noteInput,s(S),y.success(`Account ${o?"updated":"created"} successfully!`),b(!1),f()}).catch(r=>{console.log("Validate Failed:",r),y.error("Please fill in all required fields correctly.")})};return e.jsx(R,{title:o?"Edit Business Account":"Create New Business Account",width:720,onClose:f,visible:x,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(D,{onClick:f,style:{marginRight:8},children:"Cancel"}),e.jsx(D,{onClick:w,type:"primary",loading:m,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:o?"Update Account":"Create Account"})]}),children:e.jsxs(t,{form:i,layout:"vertical",children:[e.jsxs(T,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsx(t.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})}),e.jsxs(T,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(t.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(a,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(t.Item,{name:"landmark",label:"Landmark",children:e.jsx(a,{placeholder:"Landmark (Optional)"})}),e.jsxs(T,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(t.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(h,{span:8,children:e.jsx(t.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(Y,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(h,{span:8,children:e.jsx(t.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(t.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(t.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(t.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(A,{placeholder:"Select Type",children:[e.jsx(d,{value:"Hot",children:"Hot"}),e.jsx(d,{value:"Warm",children:"Warm"}),e.jsx(d,{value:"Cold",children:"Cold"})]})}),e.jsx(t.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(A,{placeholder:"Select Status",children:[e.jsx(d,{value:"Active",children:"Enquiry"}),e.jsx(d,{value:"Pipeline",children:"Proposed"}),e.jsx(d,{value:"Customer",children:"Customer"})," ",e.jsx(d,{value:"Closed",children:"Closed"})]})}),e.jsx(t.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(A,{placeholder:"How did you hear about us?",children:[e.jsx(d,{value:"Direct",children:"Direct"}),e.jsx(d,{value:"Facebook",children:"Facebook"}),e.jsx(d,{value:"Google Ads",children:"Google Ads"}),e.jsx(d,{value:"Website",children:"Website"}),e.jsx(d,{value:"Cold Call",children:"Cold Call"}),e.jsx(d,{value:"Client",children:"Client"})," ",e.jsx(d,{value:"Tradefair",children:"Tradefair"})," ",e.jsx(d,{value:"Other",children:"Other"})]})}),e.jsx(t.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(A,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:g,showSearch:!0,optionFilterProp:"children",filterOption:(r,l)=>l.children.toLowerCase().indexOf(r.toLowerCase())>=0,children:j&&j.map(r=>e.jsxs(d,{value:r._id,children:[r.name," (",r.role,")"]},r._id))})}),e.jsx(t.Item,{name:"noteInput",label:"Add Note",children:e.jsx(Q,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((v=o==null?void 0:o.notes)==null?void 0:v.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:o.notes.map((r,l)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[r.timestamp,":"]})," ",r.text]},l))})]})]})})},{TextArea:X}=a,{Title:Z,Text:V}=$,ye=({visible:x,onClose:f,account:s,refreshAccounts:o})=>{const[j]=t.useForm(),[g,i]=c.useState(!1),[m,b]=c.useState([]);c.useEffect(()=>{x&&(s!=null&&s._id)&&b(s.notes||[])},[x,s]);const w=()=>{try{const l=JSON.parse(localStorage.getItem("user"));return(l==null?void 0:l.email)||"Unknown"}catch{return"Unknown"}},v=async()=>{try{const{note:l}=await j.validateFields();i(!0);const u={text:l,timestamp:new Date().toLocaleString(),author:w()},p=[...m,u];await P.put(`/api/accounts/${s._id}`,{...s,notes:p}),y.success("Note added successfully!"),b(p),j.resetFields(),o()}catch{y.error("Failed to add note.")}finally{i(!1)}},r=()=>!m||m.length===0?e.jsx(V,{type:"secondary",children:"No notes to show"}):m.map((l,u)=>{const p=u>0?m[u-1]:null,I=new Date(l.timestamp).toDateString(),S=p?new Date(p.timestamp).toDateString():null,n=I!==S;return e.jsxs("div",{children:[n&&e.jsx("div",{className:"note-date-header",children:I}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[l.author,"    ",l.timestamp]}),e.jsx("div",{className:"note-text",children:l.text})]})]},u)});return e.jsxs(R,{title:e.jsxs(Z,{level:4,style:{margin:0},children:["Notes for ",s.businessName]}),open:x,onClose:f,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[r(),e.jsx(U,{}),e.jsxs(t,{form:j,layout:"vertical",children:[e.jsx(t.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(X,{rows:3,placeholder:"Type your note here...",disabled:g})}),e.jsx(D,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(G,{}),onClick:v,loading:g,block:!0,children:"Add Note"})]})]})},{TextArea:ee}=a,{Text:k}=$,we=({visible:x,onClose:f,account:s,refreshAccounts:o})=>{const[j,g]=c.useState(""),[i,m]=c.useState(null),[b,w]=c.useState(!1),[v,r]=c.useState([]),[l,u]=c.useState(null);c.useEffect(()=>{x&&(s!=null&&s._id)?p():(r([]),u(null),g(""),m(null))},[x,s]);const p=async()=>{if(s!=null&&s._id){w(!0);try{const n=await P.get(`/api/accounts/${s._id}/followups`);r(n.data.sort((N,C)=>L(C.createdAt).diff(L(N.createdAt)))||[])}catch(n){console.error("Error fetching follow-ups:",n),y.error("Failed to fetch follow-ups")}finally{w(!1)}}},I=()=>{if(!j.trim()||!i){y.error("Please select a date and enter a note for the follow-up.");return}const n=JSON.parse(localStorage.getItem("user")),N=n==null?void 0:n._id;if(!N){y.error("User information not found. Please log in.");return}w(!0);const C={date:i.toISOString(),note:j.trim(),addedBy:N};(l===null?P.post(`/api/accounts/${s._id}/followups`,C):P.put(`/api/accounts/${s._id}/followups/${l._id}`,C)).then(()=>{y.success(l===null?"Follow-up added successfully!":"Follow-up updated successfully!"),g(""),m(null),u(null),p(),typeof o=="function"&&o()}).catch(F=>{var q,B;console.error("Error saving follow-up:",F),y.error(((B=(q=F==null?void 0:F.response)==null?void 0:q.data)==null?void 0:B.message)||"Failed to save follow-up.")}).finally(()=>w(!1))},S=n=>{var N,C;return e.jsx(O.Item,{children:e.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[e.jsx(M,{style:{marginRight:"5px",color:"#888"}}),e.jsx(k,{strong:!0,style:{marginRight:"10px",color:"#333"},children:((N=n.addedBy)==null?void 0:N.name)||((C=n.addedBy)==null?void 0:C.email)||"Unknown User"}),e.jsx(W,{style:{marginRight:"5px",color:"#888"}}),e.jsxs(k,{type:"secondary",style:{fontSize:"0.8em"},children:[L(n.createdAt).format("DD/MM/YYYY, h:mm:ss A")," "]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsx(z,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),e.jsx(k,{style:{flexGrow:1},children:n.note})]})]})})};return e.jsxs(R,{title:`Follow-ups for Account: ${(s==null?void 0:s.businessName)||"N/A"}`,open:x,onClose:()=>{u(null),g(""),m(null),f()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(H,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:i,onChange:n=>m(n),placeholder:"Select follow-up date"}),e.jsx(ee,{rows:4,placeholder:"Enter follow-up note",value:j,onChange:n=>g(n.target.value)}),e.jsx(D,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#ef7a1b",color:"white"},block:!0,onClick:I,loading:b,children:l===null?"Add Follow-up":"Update Follow-up"})]}),e.jsxs(U,{children:["All Follow-ups (",v.length,")"]}),e.jsx(O,{dataSource:v,renderItem:S,locale:{emptyText:"No follow-ups found for this account."},style:{marginTop:16}})]})};export{ge as B,we as F,ye as N,fe as R};
