import{r as o,I as U,e as F,x as e,B as d,V as i,H as A}from"./index-CNsAxfGJ.js";import{i as u}from"./axios-YBtE4rUB.js";import{F as a}from"./index-D423zgUx.js";import{F as E}from"./Table-CaafSxEr.js";import{D as O}from"./index-Dy-31xHo.js";import{I as p}from"./index-DzLXiL0j.js";import{S as l}from"./index-CpsewJ9b.js";import{R}from"./EditOutlined-Dmcr6Ce6.js";import{P as D}from"./index-Bkr2_N7T.js";import{R as k}from"./DeleteOutlined-BfJLLPTm.js";import"./TextArea-DKzxOqx8.js";import"./addEventListener-CwTguuxU.js";import"./index-BALQX2Wl.js";import"./useClosable-CTgjBh3k.js";import"./context-CnIe8Cz3.js";import"./ActionButton-Bgh6-r2z.js";var q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},M=function(h,x){return o.createElement(U,F({},h,{ref:x,icon:q}))},P=o.forwardRef(M);const Z=()=>{const[g,h]=o.useState([]),[x,n]=o.useState(!1),[r,v]=o.useState(null),[m]=a.useForm(),f=JSON.parse(localStorage.getItem("user")),w=(f==null?void 0:f.role)==="Superadmin",j=async()=>{try{const s=await u.get("/api/users");h(s.data)}catch{i.error("Failed to load users")}};o.useEffect(()=>{j()},[]);const b=()=>{v(null),m.resetFields(),n(!0)},y=s=>{v(s),m.setFieldsValue({name:s.name,email:s.email,mobile:s.mobile,role:s.role,status:s.status}),n(!0)},I=async()=>{var s,c;try{const t=await m.validateFields();r&&!t.password&&delete t.password,r?(await u.put(`/api/users/${r._id}`,t),i.success("User updated successfully")):(await u.post("/api/users",t),i.success("User created successfully")),n(!1),j()}catch(t){console.error(t),i.error(((c=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:c.message)||"Failed to submit user")}},C=async s=>{try{await u.delete(`/api/users/${s}`),i.success("User deleted"),j()}catch{i.error("Delete failed")}},S=[{title:"Name",dataIndex:"name"},{title:"Email",dataIndex:"email"},{title:"Mobile",dataIndex:"mobile"},{title:"Role",dataIndex:"role"},{title:"Status",dataIndex:"status"},{title:"Actions",render:(s,c)=>e.jsxs(A,{children:[e.jsx(d,{icon:e.jsx(R,{}),onClick:()=>y(c)}),e.jsx(D,{title:"Delete this user?",onConfirm:()=>C(c._id),children:e.jsx(d,{danger:!0,icon:e.jsx(k,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"User Management"}),e.jsx(d,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(P,{}),onClick:b,children:"Create User"})]}),e.jsx(E,{columns:S,dataSource:g,rowKey:"_id",bordered:!0}),e.jsx(O,{title:r?"Edit User":"Create User",open:x,onClose:()=>n(!1),width:420,destroyOnClose:!0,footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(d,{onClick:()=>n(!1),style:{marginRight:8},children:"Cancel"}),e.jsx(d,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:I,children:r?"Update":"Create"})]}),children:e.jsxs(a,{form:m,layout:"vertical",children:[e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:e.jsx(p,{})}),e.jsx(a.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Invalid email format"}],children:e.jsx(p,{})}),e.jsx(a.Item,{name:"mobile",label:"Mobile",children:e.jsx(p,{})}),(!r||w)&&e.jsx(a.Item,{name:"password",label:"Password",rules:r?[]:[{required:!0,message:"Password is required"}],children:e.jsx(p.Password,{placeholder:r?"Leave blank to keep current password":""})}),e.jsx(a.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsxs(l,{placeholder:"Select role",children:[e.jsx(l.Option,{value:"Superadmin",children:"Superadmin"}),e.jsx(l.Option,{value:"Admin",children:"Admin"}),e.jsx(l.Option,{value:"Employee",children:"Employee"})]})}),e.jsx(a.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:e.jsxs(l,{placeholder:"Select status",children:[e.jsx(l.Option,{value:"Active",children:"Active"}),e.jsx(l.Option,{value:"Inactive",children:"Inactive"})]})})]})})]})};export{Z as default};
