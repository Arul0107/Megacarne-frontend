import{r as y,n as e,o as S,B as n,p as i}from"./index-D8hBozCl.js";import{i as x}from"./axios-0yhrvgHk.js";import{F as f}from"./index-CPerZvUG.js";import{D as v}from"./index-YrUoHE_M.js";import{L as h}from"./index-CYOxmhgj.js";import{T as C}from"./index-BzrSXtxJ.js";import{R as D}from"./index-Bbm8COQ-.js";import{R as E}from"./TextArea-Bs5ukQS9.js";import{R as $}from"./EditOutlined-BpfENuYh.js";import{P}from"./index-dpbpQePb.js";import{R as L}from"./DeleteOutlined-CQNFutBi.js";import{I as z}from"./index-c-xDjV6w.js";import{D as B}from"./index-CCO00Sgq.js";import{R as _}from"./PlusOutlined-PtbJYp9O.js";import"./index-xsH4HHeE.js";import"./row-pMcTJa_w.js";import"./context-BFUfbSjF.js";import"./useClosable-BMf6yXpE.js";const{TextArea:g}=z,{Text:N,Title:A}=C,re=({visible:b,onClose:w,account:o,refreshAccounts:d})=>{const[c]=f.useForm(),[r,a]=y.useState(!1),[u,p]=y.useState(null),[j,l]=y.useState(""),I=async()=>{try{const{note:s}=await c.validateFields();a(!0);const t={text:s,timestamp:new Date().toLocaleString()},m=[...o.notes||[],t];await x.put(`/api/accounts/${o._id}`,{...o,notes:m}),i.success("Note added successfully!"),c.resetFields(),d()}catch(s){console.error(s),i.error("Failed to add note. Please try again.")}finally{a(!1)}},R=async s=>{try{a(!0);const t=[...o.notes];t.splice(s,1),await x.put(`/api/accounts/${o._id}`,{...o,notes:t}),i.success("Note deleted successfully!"),d()}catch(t){console.error(t),i.error("Failed to delete note. Please try again.")}finally{a(!1)}},k=(s,t)=>{p(t),l(s.text)},T=async s=>{try{a(!0);const t=[...o.notes];t[s]={...t[s],text:j},await x.put(`/api/accounts/${o._id}`,{...o,notes:t}),i.success("Note updated successfully!"),p(null),l(""),d()}catch(t){console.error(t),i.error("Failed to update note. Please try again.")}finally{a(!1)}},F=()=>{p(null),l("")};return e.jsxs(v,{title:e.jsxs(A,{level:4,style:{margin:0},children:["Notes for ",o.businessName]}),open:b,onClose:w,width:420,bodyStyle:{padding:"24px"},children:[o.notes&&o.notes.length>0?e.jsx(h,{size:"small",bordered:!0,dataSource:o.notes,renderItem:(s,t)=>e.jsxs(h.Item,{style:{padding:"12px 16px",borderRadius:4,backgroundColor:"#fafafa",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(N,{type:"secondary",style:{fontSize:12},children:s.timestamp}),e.jsx(S,{size:"middle",children:u===t?e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:e.jsx(D,{}),type:"link",onClick:()=>T(t),loading:r}),e.jsx(n,{icon:e.jsx(E,{}),type:"link",onClick:F,disabled:r})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:e.jsx($,{}),type:"link",onClick:()=>k(s,t),disabled:r}),e.jsx(P,{title:"Delete this note?",okText:"Yes",cancelText:"No",onConfirm:()=>R(t),disabled:r,children:e.jsx(n,{icon:e.jsx(L,{}),type:"link",danger:!0,disabled:r})})]})})]}),u===t?e.jsx(g,{value:j,onChange:m=>l(m.target.value),rows:2,style:{marginTop:4},disabled:r}):e.jsx("div",{style:{marginTop:4},children:s.text})]},t)}):e.jsx(N,{type:"secondary",children:"No notes to show"}),e.jsx(B,{}),e.jsxs(f,{form:c,layout:"vertical",style:{marginTop:16},children:[e.jsx(f.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(g,{rows:3,placeholder:"Type your note here...",disabled:r})}),e.jsx(n,{type:"primary",icon:e.jsx(_,{}),onClick:I,loading:r,block:!0,children:"Add Note"})]})]})};export{re as default};
