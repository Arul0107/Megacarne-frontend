import{r as m,I as B,t as M,p as e,q as H,B as b,V as x,S as Q,aD as O,T as C}from"./index-OdYoXqOt.js";import{i as v}from"./axios-BVNKluDM.js";import{d as U,D as K}from"./index-D-Ar94d9.js";import{F as i}from"./index-Dmc8TwUP.js";import{D as T}from"./index-DZrLd_wq.js";import{R as F,C as k}from"./index-BBliv2OJ.js";import{I as g,R as J}from"./index-CyF63g_w.js";import{R as E,T as $}from"./index-BMSFUza1.js";import{S as W}from"./index-C2QcUUjQ.js";import{R as Y}from"./SendOutlined-D-aOcye6.js";import{T as G,a as A}from"./index-CE07GngT.js";import{F as R,R as X}from"./Table-BUjwp330.js";import{D as c}from"./index-Bzs9NVYI.js";import{C as q}from"./Collapse-ChsWsInv.js";import{R as Z}from"./MessageOutlined-FcG8y4wq.js";import{P as V}from"./index-BTx-wPRv.js";import{R as ee}from"./DeleteOutlined-D7u6MCin.js";import"./TextArea-BBpwzQlG.js";import"./index-BEcng5S8.js";import"./context-B06BlMR-.js";import"./index-Bq00u7W1.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},se=function(I,d){return m.createElement(B,M({},I,{ref:d,icon:te}))},re=m.forwardRef(se);const oe=({visible:j,onClose:I,onSave:d,initialValues:n})=>{const[u]=i.useForm();m.useEffect(()=>{j&&n?u.setFieldsValue({...n,stockLoadDate:n.stockLoadDate?U(n.stockLoadDate):null,options:n.options||[]}):u.resetFields()},[j,n]);const y=async t=>{var a;const{product_id:h,productId:S,_id:w,...r}=t,P={...r,price:Number(r.price)||0,quantity:Number(r.quantity)||0,inStock:Number(r.inStock)||0,outStock:Number(r.outStock)||0,stockLoadDate:r.stockLoadDate?r.stockLoadDate.toISOString():null,isActive:r.isActive||!1,options:(r.options||[]).filter(o=>{var f,p;return((f=o==null?void 0:o.type)==null?void 0:f.trim())&&((p=o==null?void 0:o.description)==null?void 0:p.trim())})};try{n!=null&&n._id?(await v.put(`/api/products/${n._id}`,P),x.success("Product updated")):(await v.post("/api/products",P),x.success("Product added")),d(),I()}catch(o){x.error("Failed to save product"),console.error(((a=o==null?void 0:o.response)==null?void 0:a.data)||o.message)}};return e.jsx(T,{title:n?"Edit Product":"Add Product",open:j,onClose:I,width:640,destroyOnClose:!0,children:e.jsxs(i,{layout:"vertical",form:u,onFinish:y,children:[e.jsxs(F,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"productName",label:"Product Name",rules:[{required:!0,message:"Enter product name"}],children:e.jsx(g,{placeholder:"Product name"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"price",label:"Price (INR)",rules:[{required:!0,message:"Enter price"}],children:e.jsx(g,{type:"number",placeholder:"Price"})})})]}),e.jsxs(F,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"quantity",label:"Quantity",children:e.jsx(g,{type:"number",placeholder:"Quantity"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"inStock",label:"In Stock",children:e.jsx(g,{type:"number",placeholder:"In Stock"})})})]}),e.jsxs(F,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"outStock",label:"Out Stock",children:e.jsx(g,{type:"number",placeholder:"Out Stock"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"stockLoadDate",label:"Stock Load Date",children:e.jsx(K,{style:{width:"100%"}})})})]}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{rows:2,placeholder:"Description"})}),e.jsx(i.List,{name:"options",children:(t,{add:h,remove:S})=>e.jsxs(e.Fragment,{children:[e.jsx("label",{style:{fontWeight:600},children:"Product Options"}),t.map(({key:w,name:r})=>e.jsxs(H,{style:{display:"flex",marginBottom:8},align:"start",children:[e.jsx(i.Item,{name:[r,"type"],rules:[{required:!0,message:"Enter type"}],children:e.jsx(g,{placeholder:"Type"})}),e.jsx(i.Item,{name:[r,"description"],rules:[{required:!0,message:"Enter description"}],children:e.jsx(g,{placeholder:"Description"})}),e.jsx(re,{onClick:()=>S(r)})]},w)),e.jsx(i.Item,{children:e.jsx(b,{onClick:()=>h(),icon:e.jsx(E,{}),children:"Add Option"})})]})}),e.jsx(i.Item,{name:"isActive",label:"Active",valuePropName:"checked",children:e.jsx(W,{})}),e.jsx(i.Item,{children:e.jsx(b,{type:"primary",htmlType:"submit",block:!0,children:n?"Update":"Create"})})]})})},{TextArea:ne}=g,{Title:ie,Text:ce}=G,ae=({visible:j,onClose:I,product:d,refreshProducts:n})=>{const[u]=i.useForm(),[y,t]=m.useState(!1),[h,S]=m.useState([]);m.useEffect(()=>{S((d==null?void 0:d.notes)||[])},[d]);const w=()=>{try{const a=JSON.parse(localStorage.getItem("user"));return(a==null?void 0:a.email)||"Unknown"}catch{return"Unknown"}},r=async a=>{try{t(!0);const o=x.loading("Adding note..."),f={text:a.note,timestamp:new Date().toLocaleString(),author:w()},p=[...h,f];await v.put(`/api/products/${d._id}/notes`,{notes:p}),S(p),x.success("Note added",{id:o}),u.resetFields(),n()}catch{x.error("Failed to add note")}finally{t(!1)}},P=()=>h.length?h.map((a,o)=>{const f=o>0?h[o-1]:null,p=new Date(a.timestamp).toDateString(),D=f?new Date(f.timestamp).toDateString():null,N=p!==D;return e.jsxs("div",{children:[N&&e.jsx("div",{className:"note-date-header",children:p}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[a.author," Â Â  ",a.timestamp]}),e.jsx("div",{className:"note-text",children:a.text})]})]},o)}):e.jsx(ce,{type:"secondary",children:"No notes added yet"});return e.jsx(T,{title:e.jsxs(ie,{level:4,style:{margin:0},children:["Notes for Product: ",d==null?void 0:d.productName]}),open:j,onClose:I,width:440,destroyOnClose:!0,children:e.jsxs(Q,{spinning:y,children:[e.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:P()}),e.jsxs(i,{form:u,layout:"vertical",onFinish:r,children:[e.jsx(i.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(ne,{rows:3,placeholder:"Type your note here"})}),e.jsx(b,{type:"primary",htmlType:"submit",loading:y,block:!0,icon:e.jsx(Y,{}),children:"Add Note"})]})]})})},{Content:de,Header:le}=O,{TabPane:L}=$,{Panel:_}=q,Te=()=>{var N;const[j,I]=m.useState([]),[d,n]=m.useState(!1),[u,y]=m.useState(null),[t,h]=m.useState(null),[S,w]=m.useState(!1),r=async()=>{try{const{data:s}=await v.get("/api/products");I(s)}catch{x.error("Failed to load products")}};m.useEffect(()=>{r()},[]);const P=()=>{r()},a=async s=>{try{await v.delete(`/api/products/${s}`),x.success("Product deleted"),r()}catch{x.error("Failed to delete product")}},o=async s=>{try{const{data:l}=await v.get(`/api/products/${s}`);h(l)}catch{x.error("Failed to fetch product details")}},f=j.filter(s=>s.isActive),p=j.filter(s=>!s.isActive),D=()=>[{title:"S.No",render:(s,l,z)=>z+1,width:60},{title:"Product ID",dataIndex:"product_id",width:120},{title:"Name",dataIndex:"productName",width:160},{title:"Qty",dataIndex:"quantity",width:80},{title:"Price (â‚¹)",dataIndex:"price",render:s=>`â‚¹${s==null?void 0:s.toFixed(2)}`,width:100},{title:"In Stock",dataIndex:"inStock",width:100},{title:"Out Stock",dataIndex:"outStock",width:100},{title:"Status",dataIndex:"isActive",render:s=>s?e.jsx(A,{color:"green",children:"Active"}):e.jsx(A,{color:"red",children:"Inactive"}),width:100},{title:"Actions",fixed:"right",width:180,render:(s,l)=>e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"View",children:e.jsx(b,{type:"text",icon:e.jsx(J,{}),onClick:()=>o(l._id)})}),e.jsx(C,{title:"Edit",children:e.jsx(b,{type:"text",icon:e.jsx(X,{}),onClick:()=>{y(l),n(!0)}})}),e.jsx(C,{title:"Notes",children:e.jsx(b,{type:"text",icon:e.jsx(Z,{}),onClick:()=>{y(l),w(!0)}})}),e.jsx(V,{title:"Confirm delete?",onConfirm:()=>a(l._id),children:e.jsx(b,{type:"text",icon:e.jsx(ee,{}),danger:!0})})]})}];return e.jsxs(O,{style:{minHeight:"100vh"},children:[e.jsx(le,{style:{color:"white",fontSize:20},children:"ðŸ“¦ Product Inventory"}),e.jsxs(de,{style:{padding:20},children:[e.jsxs($,{defaultActiveKey:"1",children:[e.jsxs(L,{tab:"Active Products",children:[e.jsx(b,{type:"primary",icon:e.jsx(E,{}),onClick:()=>{y(null),n(!0)},style:{marginBottom:16},children:"Add Product"}),e.jsx(R,{columns:D(),dataSource:f,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})]},"1"),e.jsx(L,{tab:"Inactive Products",children:e.jsx(R,{columns:D(),dataSource:p,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})},"2")]}),e.jsx(oe,{visible:d,onClose:()=>{y(null),n(!1)},onSave:P,initialValues:u}),e.jsx(T,{open:!!t,title:"Product Details",width:820,onClose:()=>h(null),children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{bordered:!0,column:1,size:"small",children:[e.jsx(c.Item,{label:"Product ID",children:t.product_id}),e.jsx(c.Item,{label:"Name",children:t.productName}),e.jsx(c.Item,{label:"Price",children:`â‚¹${(N=t.price)==null?void 0:N.toFixed(2)}`}),e.jsx(c.Item,{label:"Qty",children:t.quantity}),e.jsx(c.Item,{label:"In Stock",children:t.inStock}),e.jsx(c.Item,{label:"Out Stock",children:t.outStock}),e.jsx(c.Item,{label:"Stock Load Date",children:t.stockLoadDate&&new Date(t.stockLoadDate).toLocaleDateString()}),e.jsx(c.Item,{label:"Description",children:t.description||"N/A"}),e.jsx(c.Item,{label:"Status",children:t.isActive?e.jsx(A,{color:"green",children:"Active"}):e.jsx(A,{color:"red",children:"Inactive"})})]}),e.jsxs(q,{style:{marginTop:20},children:[e.jsx(_,{header:"Product Options",children:Array.isArray(t.options)&&t.options.length>0?t.options.map((s,l)=>e.jsxs(c,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(c.Item,{label:"Type",children:s.type}),e.jsx(c.Item,{label:"Description",children:s.description})]},l)):e.jsx("p",{children:"No product options available."})},"1"),e.jsx(_,{header:"Product Notes",children:Array.isArray(t.notes)&&t.notes.length>0?t.notes.map((s,l)=>e.jsxs(c,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(c.Item,{label:"Note",span:2,children:s.text}),e.jsx(c.Item,{label:"Author",children:s.author}),e.jsx(c.Item,{label:"Time",children:new Date(s.timestamp).toLocaleString()})]},l)):e.jsx("p",{children:"No notes available."})},"2")]})]})}),u&&e.jsx(ae,{visible:S,onClose:()=>w(!1),product:u,refreshProducts:r})]})]})};export{Te as default};
