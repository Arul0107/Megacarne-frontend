import{r as l,n as t,S as E,o as T,B as N,V as o}from"./index-CbQ4neKm.js";import{i as y}from"./axios-0yhrvgHk.js";import L from"./QuotationForm-Q4MK_9Pg.js";import R from"./QuotationList-C4MhQiu7.js";import{F as v}from"./index-B_0nFRCB.js";import{D as b}from"./index-zt7-XpP7.js";import{L as D}from"./index-DRb7tW4R.js";import{T as V}from"./index-DwjjM2DK.js";import{I as z}from"./index-wTp2Nwtg.js";import{R as A}from"./index-BSJhI5q2.js";import{R as k}from"./TextArea-D1q5OdR1.js";import{R as q}from"./Table-BO4so_y9.js";import{P}from"./index-DpQnoVfG.js";import{R as _}from"./DeleteOutlined-BMNat55n.js";import{R as B}from"./SendOutlined-C9Mox248.js";import"./index-xsH4HHeE.js";import"./index-xHf9oXLl.js";import"./index-D9TSRuZX.js";import"./PlusOutlined-B7sLjvKG.js";import"./row-CrhmcT0I.js";import"./index-CkSg7-Tt.js";import"./index-BtH2dZQ0.js";import"./SaveOutlined-CDx4Y_dF.js";import"./jspdf.es.min-R-7iyhvL.js";import"./html2canvas.esm-CBrSDip1.js";import"./index-FOB2b15T.js";import"./InfoCircleFilled-BSSlmzZM.js";import"./context-c0oM5sb7.js";import"./useClosable-CE9FIZtw.js";import"./index-QG5vLWYt.js";import"./index-DXafqAks.js";import"./MessageOutlined-ChhDcAD1.js";import"./index-DKNh7R9V.js";const{TextArea:$}=z,{Text:O}=V,Y=({visible:S,onClose:C,quotation:i,refreshQuotations:d})=>{const[m]=v.useForm(),[c,u]=l.useState(!1),[I,g]=l.useState(null),[j,p]=l.useState(""),[x,h]=l.useState([]);l.useEffect(()=>{h((i==null?void 0:i.notes)||[])},[i]);const F=async a=>{try{u(!0);const e=o.loading("Adding note..."),r={text:a.note,timestamp:new Date().toLocaleString()},Q=[...x,r];await y.put(`/api/quotations/${i._id}`,{notes:Q}),h(Q),o.success("Note added successfully",{id:e}),m.resetFields(),d()}catch(e){console.error(e),o.error("Failed to add note")}finally{u(!1)}},s=async a=>{try{u(!0);const e=o.loading("Deleting note..."),r=[...x];r.splice(a,1),await y.put(`/api/quotations/${i._id}`,{notes:r}),h(r),o.success("Note deleted successfully",{id:e}),d()}catch(e){console.error(e),o.error("Failed to delete note")}finally{u(!1)}},n=(a,e)=>{g(e),p(a.text)},f=async a=>{try{u(!0);const e=o.loading("Updating note..."),r=[...x];r[a]={...r[a],text:j,timestamp:new Date().toLocaleString()},await y.put(`/api/quotations/${i._id}`,{notes:r}),h(r),o.success("Note updated successfully",{id:e}),g(null),d()}catch(e){console.error(e),o.error("Failed to update note")}finally{u(!1)}},w=()=>{g(null),p("")};return t.jsx(b,{title:`Notes for Quotation #${i==null?void 0:i.quotationNumber}`,open:S,onClose:C,width:400,destroyOnClose:!0,children:t.jsxs(E,{spinning:c,children:[t.jsx("div",{style:{maxHeight:"496px",overflowY:"auto"},children:t.jsx(D,{size:"small",dataSource:x,locale:{emptyText:"No notes added yet"},renderItem:(a,e)=>t.jsx(D.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},actions:[I===e?t.jsxs(T,{children:[t.jsx(N,{size:"small",icon:t.jsx(A,{style:{color:"#52c41a"}}),onClick:()=>f(e),type:"text"}),t.jsx(N,{size:"small",icon:t.jsx(k,{style:{color:"#ff4d4f"}}),onClick:w,type:"text"})]}):t.jsxs(T,{children:[t.jsx(N,{size:"small",icon:t.jsx(q,{style:{color:"#1890ff"}}),onClick:()=>n(a,e),type:"text"}),t.jsx(P,{title:"Are you sure to delete this note?",onConfirm:()=>s(e),okText:"Yes",cancelText:"No",children:t.jsx(N,{size:"small",icon:t.jsx(_,{style:{color:"#ff4d4f"}}),type:"text"})})]})],children:t.jsx(D.Item.Meta,{description:t.jsxs(t.Fragment,{children:[t.jsx(O,{type:"secondary",style:{fontSize:12},children:a.timestamp}),I===e?t.jsx($,{value:j,onChange:r=>p(r.target.value),rows:2,style:{marginTop:8},autoFocus:!0}):t.jsx("div",{style:{marginTop:4,whiteSpace:"pre-wrap"},children:a.text})]})})},e)})}),t.jsxs(v,{form:m,layout:"vertical",style:{marginTop:16},onFinish:F,children:[t.jsx(v.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:t.jsx($,{rows:3,placeholder:"Type your note here"})}),t.jsx(N,{type:"primary",htmlType:"submit",loading:c,block:!0,icon:t.jsx(B,{}),children:"Add Note"})]})]})})},Ct=()=>{const[S,C]=l.useState([]),[i,d]=l.useState(!1),[m,c]=l.useState(null),[u,I]=l.useState([]),[g,j]=l.useState(!1),p=async()=>{const s=o.loading("Loading quotations...");try{const n=await y.get("/api/quotations");C(n.data),o.success("Quotations loaded successfully",{id:s})}catch{o.error("Failed to load quotations",{id:s})}};l.useEffect(()=>{p()},[]);const x=async s=>{const n=o.loading("Saving quotation...");try{m?await y.put(`/api/quotations/${m._id}`,s):await y.post("/api/quotations",s),o.success("Quotation saved successfully!",{id:n}),p(),d(!1),c(null)}catch(f){o.error(`Failed to save quotation: ${f.message}`,{id:n})}},h=async s=>{const n=o.loading("Deleting quotation...");try{await y.delete(`/api/quotations/${s}`),o.success("Quotation deleted successfully",{id:n}),p()}catch(f){o.error(`Failed to delete quotation: ${f.message}`,{id:n})}},F=s=>{const n=s.toLowerCase(),f=S.filter(w=>{var a,e,r;return((a=w.businessName)==null?void 0:a.toLowerCase().includes(n))||((e=w.customerName)==null?void 0:e.toLowerCase().includes(n))||((r=w.quotationNumber)==null?void 0:r.toLowerCase().includes(n))});I(f)};return t.jsxs(t.Fragment,{children:[t.jsx(R,{quotations:u.length?u:S,onAddNew:()=>{c(null),d(!0)},onEdit:s=>{c(s),d(!0)},onDelete:h,onSearch:F,onViewNotes:s=>{c(s),j(!0)}}),t.jsx(b,{open:i,title:m?"Edit Quotation":"Create Quotation",onClose:()=>{d(!1),c(null)},width:720,destroyOnClose:!0,children:t.jsx(L,{initialValues:m,onSave:x,onCancel:()=>{d(!1),c(null)}})}),t.jsx(Y,{visible:g,onClose:()=>{j(!1),c(null)},quotation:m,refreshQuotations:p})]})};export{Ct as default};
