import{p as me,q as ue,s as K,r as c,t as pe,v as L,C as fe,w as xe,x as ge,c as he,d as ye,f as be,y as H,n as e,B as R,o as je}from"./index-DD76fs-h.js";import{R as Ie,E as Se}from"./jspdf.es.min-Csoo9Yjq.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{d as q,D as X}from"./index-Dx7S66AB.js";import{a as ve}from"./index-xsH4HHeE.js";import{F as x}from"./index-CVolLEbg.js";import{C as $e}from"./index-CFl-p7rD.js";import{R as O,C as p}from"./row-qnhl_Xtb.js";import{S as Z}from"./index-Cyejg2uk.js";import{a as Ce,b as De,I as j}from"./index-Bz8HKjRU.js";import{R as F}from"./index-ZtJ4PVaR.js";import{p as Ne,b as Ee,R as we}from"./TextArea-CMtgeMII.js";import{R as Te}from"./InfoCircleFilled-AVuMim3v.js";import{_ as Be}from"./callSuper-BwtWTB_J.js";import{D as Q}from"./index-BelEbI9C.js";import{T as U}from"./index-C8gyv-gM.js";import{R as Oe}from"./DeleteOutlined-QhKYsw_D.js";import{R as Me}from"./SaveOutlined-e6ymyoOE.js";import"./PlusOutlined-M3Xgh6eT.js";const A=(o,s,t,a,i)=>({background:o,border:`${K(a.lineWidth)} ${a.lineType} ${s}`,[`${i}-icon`]:{color:t}}),Ye=o=>{const{componentCls:s,motionDurationSlow:t,marginXS:a,marginSM:i,fontSize:l,fontSizeLG:d,lineHeight:g,borderRadiusLG:m,motionEaseInOutCirc:h,withDescriptionIconSize:I,colorText:S,colorTextHeading:N,withDescriptionPadding:v,defaultPadding:u}=o;return{[s]:Object.assign(Object.assign({},ue(o)),{position:"relative",display:"flex",alignItems:"center",padding:u,wordWrap:"break-word",borderRadius:m,[`&${s}-rtl`]:{direction:"rtl"},[`${s}-content`]:{flex:1,minWidth:0},[`${s}-icon`]:{marginInlineEnd:a,lineHeight:0},"&-description":{display:"none",fontSize:l,lineHeight:g},"&-message":{color:N},[`&${s}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${t} ${h}, opacity ${t} ${h},
        padding-top ${t} ${h}, padding-bottom ${t} ${h},
        margin-bottom ${t} ${h}`},[`&${s}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${s}-with-description`]:{alignItems:"flex-start",padding:v,[`${s}-icon`]:{marginInlineEnd:i,fontSize:I,lineHeight:0},[`${s}-message`]:{display:"block",marginBottom:a,color:N,fontSize:d},[`${s}-description`]:{display:"block",color:S}},[`${s}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},Pe=o=>{const{componentCls:s,colorSuccess:t,colorSuccessBorder:a,colorSuccessBg:i,colorWarning:l,colorWarningBorder:d,colorWarningBg:g,colorError:m,colorErrorBorder:h,colorErrorBg:I,colorInfo:S,colorInfoBorder:N,colorInfoBg:v}=o;return{[s]:{"&-success":A(i,a,t,o,s),"&-info":A(v,N,S,o,s),"&-warning":A(g,d,l,o,s),"&-error":Object.assign(Object.assign({},A(I,h,m,o,s)),{[`${s}-description > pre`]:{margin:0,padding:0}})}}},Re=o=>{const{componentCls:s,iconCls:t,motionDurationMid:a,marginXS:i,fontSizeIcon:l,colorIcon:d,colorIconHover:g}=o;return{[s]:{"&-action":{marginInlineStart:i},[`${s}-close-icon`]:{marginInlineStart:i,padding:0,overflow:"hidden",fontSize:l,lineHeight:K(l),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${t}-close`]:{color:d,transition:`color ${a}`,"&:hover":{color:g}}},"&-close-text":{color:d,transition:`color ${a}`,"&:hover":{color:g}}}}},Fe=o=>({withDescriptionIconSize:o.fontSizeHeading3,defaultPadding:`${o.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${o.paddingMD}px ${o.paddingContentHorizontalLG}px`}),Ae=me("Alert",o=>[Ye(o),Pe(o),Re(o)],Fe);var J=function(o,s){var t={};for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&s.indexOf(a)<0&&(t[a]=o[a]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(o);i<a.length;i++)s.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(o,a[i])&&(t[a[i]]=o[a[i]]);return t};const ze={success:De,info:Te,error:Ee,warning:Ce},He=o=>{const{icon:s,prefixCls:t,type:a}=o,i=ze[a]||null;return s?ge(s,c.createElement("span",{className:`${t}-icon`},s),()=>({className:L(`${t}-icon`,s.props.className)})):c.createElement(i,{className:`${t}-icon`})},qe=o=>{const{isClosable:s,prefixCls:t,closeIcon:a,handleClose:i,ariaProps:l}=o,d=a===!0||a===void 0?c.createElement(we,null):a;return s?c.createElement("button",Object.assign({type:"button",onClick:i,className:`${t}-close-icon`,tabIndex:0},l),d):null},V=c.forwardRef((o,s)=>{const{description:t,prefixCls:a,message:i,banner:l,className:d,rootClassName:g,style:m,onMouseEnter:h,onMouseLeave:I,onClick:S,afterClose:N,showIcon:v,closable:u,closeText:E,closeIcon:$,action:w,id:T}=o,M=J(o,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[Y,z]=c.useState(!1),r=c.useRef(null);c.useImperativeHandle(s,()=>({nativeElement:r.current}));const{getPrefixCls:n,direction:b,closable:f,closeIcon:P,className:D,style:te}=pe("alert"),y=n("alert",a),[ne,oe,se]=Ae(y),re=C=>{var B;z(!0),(B=o.onClose)===null||B===void 0||B.call(o,C)},_=c.useMemo(()=>o.type!==void 0?o.type:l?"warning":"info",[o.type,l]),ae=c.useMemo(()=>typeof u=="object"&&u.closeIcon||E?!0:typeof u=="boolean"?u:$!==!1&&$!==null&&$!==void 0?!0:!!f,[E,$,u,f]),G=l&&v===void 0?!0:v,ie=L(y,`${y}-${_}`,{[`${y}-with-description`]:!!t,[`${y}-no-icon`]:!G,[`${y}-banner`]:!!l,[`${y}-rtl`]:b==="rtl"},D,d,g,se,oe),ce=Ne(M,{aria:!0,data:!0}),le=c.useMemo(()=>typeof u=="object"&&u.closeIcon?u.closeIcon:E||($!==void 0?$:typeof f=="object"&&f.closeIcon?f.closeIcon:P),[$,u,E,P]),de=c.useMemo(()=>{const C=u??f;if(typeof C=="object"){const{closeIcon:B}=C;return J(C,["closeIcon"])}return{}},[u,f]);return ne(c.createElement(fe,{visible:!Y,motionName:`${y}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:C=>({maxHeight:C.offsetHeight}),onLeaveEnd:N},({className:C,style:B},W)=>c.createElement("div",Object.assign({id:T,ref:xe(r,W),"data-show":!Y,className:L(ie,C),style:Object.assign(Object.assign(Object.assign({},te),m),B),onMouseEnter:h,onMouseLeave:I,onClick:S,role:"alert"},ce),G?c.createElement(He,{description:t,icon:o.icon,prefixCls:y,type:_}):null,c.createElement("div",{className:`${y}-content`},i?c.createElement("div",{className:`${y}-message`},i):null,t?c.createElement("div",{className:`${y}-description`},t):null),w?c.createElement("div",{className:`${y}-action`},w):null,c.createElement(qe,{isClosable:ae,prefixCls:y,closeIcon:le,handleClose:re,ariaProps:de}))))});let ke=function(o){function s(){var t;return be(this,s),t=Be(this,s,arguments),t.state={error:void 0,info:{componentStack:""}},t}return he(s,o),ye(s,[{key:"componentDidCatch",value:function(a,i){this.setState({error:a,info:i})}},{key:"render",value:function(){const{message:a,description:i,id:l,children:d}=this.props,{error:g,info:m}=this.state,h=(m==null?void 0:m.componentStack)||null,I=typeof a>"u"?(g||"").toString():a,S=typeof i>"u"?h:i;return g?c.createElement(V,{id:l,type:"error",message:I,description:c.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},S)}):d}}])}(c.Component);const ee=V;ee.ErrorBoundary=ke;const{Option:Le}=Z,{TextArea:k}=j,lt=({onCancel:o,onSave:s,initialValues:t})=>{const[a]=x.useForm(),[i,l]=c.useState([{id:1,description:"",hsnSac:"",quantity:1,rate:0}]),[d,g]=c.useState("pending"),[m,h]=c.useState(null),[I,S]=c.useState([]),[N,v]=c.useState(!1);c.useEffect(()=>{const r=H.loading("Loading business options...");v(!0),ve.get("/api/invoices/leads/active").then(n=>{S(n.data),H.success("Business options loaded",{id:r})}).catch(()=>{H.error("Failed to load businesses",{id:r})}).finally(()=>v(!1))},[]),c.useEffect(()=>{t&&(a.setFieldsValue({...t,date:t.date?q(t.date):null,dueDate:t.dueDate?q(t.dueDate):null,paymentStatus:t.paymentStatus||"pending"}),l(t.items||[]),g(t.paymentStatus||"pending"),h(t.dueDate?q(t.dueDate):null))},[t]);const u=r=>{var b;const n={...r,date:(b=r.date)==null?void 0:b.format("YYYY-MM-DD"),dueDate:m==null?void 0:m.format("YYYY-MM-DD"),paymentStatus:d,items:i};s(n)},E=()=>l([...i,{id:Date.now(),description:"",hsnSac:"",quantity:1,rate:0}]),$=r=>i.length>1&&l(i.filter(n=>n.id!==r)),w=(r,n,b)=>l(i.map(f=>f.id===r?{...f,[n]:b}:f)),T=()=>i.reduce((r,n)=>r+n.quantity*n.rate,0),M=()=>T()*.18,Y=()=>T()+M(),z=()=>{var P;const r=a.getFieldsValue(),n=new Se;n.setFontSize(20),n.text("TAX INVOICE",14,20),n.setFontSize(12),n.text(`Business: ${r.businessName||""}`,14,35),n.text(`Type: ${r.businessType||""}`,14,42),n.text(`Address: ${r.businessInfo||""}`,14,50),n.text(`GSTIN: ${r.gstin||""}`,14,58),n.text(`Invoice No: ${(t==null?void 0:t.invoiceNumber)||"Generated on save"}`,120,35),n.text(`Date: ${((P=r.date)==null?void 0:P.format("DD/MM/YYYY"))||""}`,120,43),n.text(`Due Date: ${(m==null?void 0:m.format("DD/MM/YYYY"))||""}`,120,51),n.text(`Status: ${d}`,120,59),n.text(`Bill To: ${r.customerName||""}`,14,75),n.text(`Address: ${r.customerAddress||""}`,14,83);const b=i.map(D=>[D.description||"",D.hsnSac||"",D.quantity,`₹${D.rate.toFixed(2)}`,`₹${(D.quantity*D.rate).toFixed(2)}`]);n.autoTable({head:[["Description","HSN/SAC","Qty","Rate (₹)","Amount (₹)"]],body:b,startY:100,theme:"grid"});const f=n.lastAutoTable.finalY+10;n.text(`Sub Total: ₹${T().toFixed(2)}`,120,f),n.text(`GST (18%): ₹${M().toFixed(2)}`,120,f+10),n.setFontSize(14),n.text(`Total: ₹${Y().toFixed(2)}`,120,f+20),n.text(`Payment Status: ${d}`,14,f+30),n.save(`invoice-${(t==null?void 0:t.invoiceNumber)||"draft"}.pdf`)};return e.jsx($e,{title:t?"Edit Invoice":"Create New Invoice",children:e.jsxs(x,{form:a,layout:"vertical",onFinish:u,children:[e.jsxs(O,{gutter:16,children:[e.jsxs(p,{span:12,children:[e.jsx(x.Item,{label:"Business Name",name:"businessName",rules:[{required:!0}],children:e.jsx(Z,{placeholder:"Select business",onChange:r=>{const n=I.find(b=>b.businessName===r);if(n){const b=[n.addressLine1,n.addressLine2,n.addressLine3,n.city,n.state,n.pincode,n.country].filter(Boolean).join(", ");a.setFieldsValue({businessType:n.type||"",businessInfo:b,gstin:n.gstNumber||"",businessId:n._id})}},children:I.map(r=>e.jsx(Le,{value:r.businessName,children:r.businessName},r._id))})}),e.jsx(x.Item,{name:"businessId",hidden:!0,children:e.jsx(j,{})})]}),e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Business Type",name:"businessType",children:e.jsx(j,{readOnly:!0})})})]}),e.jsxs(O,{gutter:16,children:[(t==null?void 0:t.invoiceNumber)&&e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Invoice Number",children:e.jsx(j,{value:t.invoiceNumber,readOnly:!0})})}),e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Business Info",name:"businessInfo",children:e.jsx(k,{rows:2})})})]}),e.jsxs(O,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Date",name:"date",rules:[{required:!0}],children:e.jsx(X,{style:{width:"100%"},format:"DD/MM/YYYY"})})}),e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Due Date",name:"dueDate",children:e.jsx(X,{style:{width:"100%"},format:"DD/MM/YYYY",value:m,onChange:h})})})]}),e.jsxs(O,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"GSTIN",name:"gstin",children:e.jsx(j,{})})}),e.jsx(p,{span:12,children:e.jsx(x.Item,{label:"Customer Name",name:"customerName",rules:[{required:!0}],children:e.jsx(j,{})})})]}),e.jsx(x.Item,{label:"Customer Address",name:"customerAddress",rules:[{required:!0}],children:e.jsx(k,{rows:2})}),e.jsx(x.Item,{label:"Payment Status",name:"paymentStatus",children:e.jsxs(F.Group,{value:d,onChange:r=>g(r.target.value),children:[e.jsx(F.Button,{value:"pending",children:"Pending"}),e.jsx(F.Button,{value:"paid",children:"Paid"}),e.jsx(F.Button,{value:"partial",children:"Partial"})]})}),d==="partial"&&e.jsx(ee,{message:"Partial payment",type:"info",style:{marginBottom:16}}),e.jsx(Q,{children:"Invoice Items"}),i.map(r=>e.jsxs(O,{gutter:16,style:{marginBottom:12},children:[e.jsx(p,{span:8,children:e.jsx(j,{value:r.description,onChange:n=>w(r.id,"description",n.target.value),placeholder:"Description"})}),e.jsx(p,{span:4,children:e.jsx(j,{value:r.hsnSac,onChange:n=>w(r.id,"hsnSac",n.target.value),placeholder:"HSN/SAC"})}),e.jsx(p,{span:3,children:e.jsx(U,{value:r.quantity,min:1,onChange:n=>w(r.id,"quantity",n),style:{width:"100%"}})}),e.jsx(p,{span:3,children:e.jsx(U,{value:r.rate,min:0,onChange:n=>w(r.id,"rate",n),style:{width:"100%"}})}),e.jsx(p,{span:4,children:e.jsx(j,{value:`₹ ${(r.quantity*r.rate).toFixed(2)}`,readOnly:!0})}),e.jsx(p,{span:2,children:e.jsx(R,{icon:e.jsx(Oe,{}),danger:!0,onClick:()=>$(r.id),disabled:i.length===1})})]},r.id)),e.jsx(R,{type:"dashed",onClick:E,block:!0,style:{marginBottom:24},children:"+ Add Item"}),e.jsx(Q,{children:"Summary (Estimation)"}),e.jsxs(O,{gutter:16,children:[e.jsx(p,{span:8,children:e.jsx(j,{readOnly:!0,value:`₹ ${T().toFixed(2)}`,addonBefore:"Sub Total"})}),e.jsx(p,{span:8,children:e.jsx(j,{readOnly:!0,value:`₹ ${M().toFixed(2)}`,addonBefore:"GST (18%)"})}),e.jsx(p,{span:8,children:e.jsx(j,{readOnly:!0,value:`₹ ${Y().toFixed(2)}`,addonBefore:"Total",style:{fontWeight:"bold"}})})]}),e.jsx(x.Item,{name:"noteText",label:"Note",children:e.jsx(k,{rows:2,placeholder:"Add a note"})}),e.jsx(x.Item,{style:{marginTop:24},children:e.jsxs(je,{children:[e.jsx(R,{type:"primary",htmlType:"submit",icon:e.jsx(Me,{}),size:"large",children:t?"Update Invoice":"Save Invoice"}),e.jsx(R,{onClick:o,size:"large",children:"Cancel"}),e.jsx(R,{onClick:z,icon:e.jsx(Ie,{}),size:"large",children:"Generate PDF"})]})})]})})};export{lt as default};
