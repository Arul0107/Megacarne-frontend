import{r as U,an as Z,x as o,B as de,S as ze,K as We,V as ee,H as ke,T as He,ao as Be,ap as J}from"./index-CDHHEH9R.js";import{i as fe}from"./axios-CSlAuMiO.js";import{h as pe}from"./moment-C5S46NFB.js";import{D as Ye}from"./index-Dg-FNmH8.js";import{T as Pe}from"./index-Govk3_r-.js";import{D as qe,d as Ve}from"./index-4mnRxljj.js";import{I as Ee,R as _e}from"./index-moz96MFa.js";import{D as ye}from"./index-gOyG0OeV.js";import{L as je}from"./index-DWClh8PC.js";import{R as Re}from"./MessageOutlined-2SzkZOCK.js";import{E as Ge,R as Qe}from"./html2canvas.esm-D4gOIGy2.js";import{c as Xe}from"./TextArea-DuGAdjqD.js";import{F as oe}from"./Table-b-pe5h1z.js";import{M as Ke}from"./index-CVA8aRI9.js";import{D as P}from"./index-BeKDXEMR.js";import{T as le}from"./index-BxYB1PTR.js";import{R as ve}from"./PrinterOutlined-DGpMWW90.js";import{R as Ze}from"./ScheduleOutlined-DNTq9uKo.js";import{R as Je}from"./EditOutlined-xqHe53iW.js";import{P as et}from"./index-BQzleOIU.js";import{R as tt}from"./DeleteOutlined-S1VgwgK-.js";import"./context-cWxd9jnK.js";import"./useClosable-GYGSyFE0.js";import"./styleChecker-BPp1vV_G.js";import"./index-_DW4MO8t.js";import"./dayjs.min-F-oh7tHl.js";import"./Pagination-Dihjq4x4.js";import"./addEventListener-uZJL53jX.js";import"./index-CmB5d6LT.js";import"./InfoCircleFilled-CVv9ml8T.js";import"./ActionButton-FXhSaRtp.js";import"./index-Dl72V75l.js";const{TextArea:nt}=Ee,{Text:re}=Pe,ot=({visible:r,onClose:I,quotation:w,refreshQuotations:L})=>{const[$,M]=U.useState(""),[z,v]=U.useState(null),[e,c]=U.useState(!1),[S,t]=U.useState([]),[n,s]=U.useState(null),[ie,G]=U.useState([]),[D,u]=U.useState(!1),C=()=>{try{const d=JSON.parse(localStorage.getItem("user"));return(d==null?void 0:d.email)||"Unknown"}catch{return"Unknown"}};U.useEffect(()=>{r&&(w!=null&&w._id)?(ne(),te()):(t([]),s(null),M(""),v(null),G([]))},[r,w]);const te=async()=>{u(!0);try{const d=await fe.get("/api/users");Array.isArray(d.data)?G(d.data):(console.warn("API for users did not return an array:",d.data),G([]))}catch(d){console.error("Failed to fetch users:",d),Z.error("Could not load user details for display."),G([])}finally{u(!1)}},Y=d=>{if(!d)return"Unknown User";if(typeof d=="object"&&d!==null)return d.name||d.email||"Unknown User";const T=ie.find(E=>E._id===d||E.id===d);return T?T.name||T.email||`User ID: ${d}`:`Unknown User (ID: ${d})`},ne=async()=>{if(w!=null&&w._id){c(!0);try{const d=await fe.get(`/api/quotations/${w._id}/followups`);t(d.data.sort((T,E)=>pe(E.createdAt).diff(pe(T.createdAt))))}catch(d){console.error("Error fetching follow-ups:",d),Z.error("Failed to fetch follow-ups.")}finally{c(!1)}}},Q=async()=>{if(!z||!$.trim()){Z.error("Please select a date and enter a note for the follow-up.");return}c(!0);try{let d;const T=JSON.parse(localStorage.getItem("user")),E=(T==null?void 0:T._id)||(T==null?void 0:T.id);if(!E){Z.error("User information not found. Please log in."),c(!1);return}const a={date:pe(z).toISOString(),note:$.trim(),addedBy:E};n===null?d=fe.post(`/api/quotations/${w._id}/followups`,a):d=fe.put(`/api/quotations/${w._id}/followups/${n._id}`,a),d.then(()=>{Z.success(n===null?"Follow-up added successfully!":"Follow-up updated successfully!"),M(""),v(null),s(null),ne(),typeof L=="function"&&L()}).catch(i=>{var m,f;console.error("Error saving follow-up:",i),Z.error(`Error saving follow-up: ${((f=(m=i.response)==null?void 0:m.data)==null?void 0:f.message)||i.message}`)}).finally(()=>{c(!1)})}catch(d){console.error("Error preparing follow-up data:",d),Z.error("An unexpected error occurred."),c(!1)}},X=d=>o.jsx(je.Item,{children:o.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[o.jsx(We,{style:{marginRight:"5px",color:"#888"}}),o.jsx(re,{strong:!0,style:{marginRight:"10px",color:"#333"},children:Y(d.addedBy)}),o.jsx(Ve,{style:{marginRight:"5px",color:"#888"}}),o.jsx(re,{type:"secondary",style:{fontSize:"0.8em"},children:pe(d.createdAt).format("DD/MM/YYYY, h:mm:ss A")})]}),o.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[o.jsx(Re,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),o.jsx(re,{style:{flexGrow:1},children:d.note})]})]})});return o.jsxs(Ye,{title:`Follow-ups for Quotation: ${(w==null?void 0:w.quotationNumber)||"N/A"}`,open:r,onClose:()=>{s(null),M(""),v(null),I()},width:720,children:[o.jsxs("div",{style:{marginBottom:20},children:[o.jsxs(re,{type:"secondary",style:{marginBottom:8,display:"block",fontSize:"0.9em"},children:["Adding follow-up as: ",o.jsx(re,{strong:!0,children:C()})]}),o.jsx(qe,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:z,onChange:d=>v(d),placeholder:"Select follow-up date"}),o.jsx(nt,{rows:4,placeholder:"Enter follow-up note",value:$,onChange:d=>M(d.target.value)}),o.jsx(de,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#ef7a1b",color:"white"},block:!0,onClick:Q,loading:e,children:n===null?"Add Follow-up":"Update Follow-up"})]}),o.jsxs(ye,{children:["All Follow-ups (",S.length,")"]}),e||D?o.jsx("div",{style:{textAlign:"center",padding:"20px"},children:o.jsx(ze,{size:"large",tip:"Loading Follow-ups..."})}):o.jsx(je,{dataSource:S,renderItem:X,locale:{emptyText:"No follow-ups found for this quotation."},style:{marginTop:16}})]})},it="/assets/megacraneq-CnNkYVbt.png",ce=r=>`₹${(parseFloat(r)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,st=r=>{if(typeof r!="number"||isNaN(r))return"N/A";let I=Math.floor(r),w=Math.round((r-I)*100);const L=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],$=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],M=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],z=["","Thousand","Lakh","Crore"],v=n=>n<10?L[n]:n>=10&&n<20?$[n-10]:M[Math.floor(n/10)]+(n%10!==0?" "+L[n%10]:"");let e=[],c=0;if(I===0)e.push("Zero");else{let n=I%1e3;for(n>0&&(n<100?e.push(v(n)):e.push(L[Math.floor(n/100)]+" Hundred"+(n%100!==0?" "+v(n%100):""))),I=Math.floor(I/1e3);I>0;){let s=I%100;s>0?e.push(v(s)+" "+z[++c]):c++,I=Math.floor(I/100)}}const S=e.reverse().filter(Boolean).join(" ").trim();let t=S?S+" Rupees":"Zero Rupees";return w>0&&(t+=` and ${v(w)} Paisa`),t+=" Only",t.replace(/\s+/g," ")},De=async r=>{var w,L,$,M,z,v;const I=ee.loading("Generating PDF...",{position:"top-center"});try{const e=new Ge({orientation:"portrait",unit:"mm",format:"a4"}),c=e.internal.pageSize.getWidth(),S=e.internal.pageSize.getHeight(),t=15;let n=t;const s=5,ie=3.5,G=45,D=15,u=2,C=async()=>{const g=new Image;g.src=it,await new Promise(K=>g.onload=K);const F=20,k=g.height*F/g.width,O=t,ae=t;e.addImage(g,"PNG",O,ae,F,k),e.setFontSize(14),e.setTextColor("#D35400"),e.setFont("helvetica","bold"),e.text("MEGA CRANES INDIA PRIVATE LIMITED",c/2,t+5,{align:"center"}),e.setFontSize(8),e.setTextColor("#D35400"),e.setFont("helvetica","normal"),e.text("(An ISO 9001 : 2015 Certified company)",c/2,t+9,{align:"center"}),e.setFontSize(8),e.setTextColor("#333"),e.text("S.F. No. 2/8, 2/9, 2/11, Thelungupalayam Road, Ellapalayam (P.O), Annur, Coimbatore - 641 697.",c/2,t+15,{align:"center"}),e.text("Mob : 99949 63033, 99949 93032.",c/2,t+18,{align:"center"}),e.text("E-mail : info@megacranesindia.com, marketing@megacranesindia.com",c/2,t+21,{align:"center"}),e.text("Website : www.megacranesindia.com",c/2,t+24,{align:"center"}),e.text("GST No : 33AACCM6869G1Z8      PAN No : AACCM6869G      Incorporation No : U29150TZ2009PTC015678",c/2,t+27,{align:"center"}),e.setDrawColor("#d35400"),e.setLineWidth(.5),e.line(t,t+32,c-t,t+32),n=t+40},te=(g,F)=>{e.setFontSize(8),e.setTextColor("#999"),e.text(`Page ${g}/${F}`,c/2,S-10,{align:"center"})},Y=((w=r.items)==null?void 0:w.reduce((g,F)=>g+parseFloat(F.quantity||0)*parseFloat(F.rate||0),0))||0,Q=Y*.18,X=Y+Q,d=r.businessName||"M/s. LMW Limited, Foundry Division UNIT - 31 (Unit 2), Arasur, Coimbatore – 641 407",T=((L=r.businessId)==null?void 0:L.contactName)||r.contactName||"N/A",E=r.mobileNumber||(($=r.businessId)==null?void 0:$.mobileNumber)||((M=r.businessId)==null?void 0:M.phone)||"N/A",a=((z=r.businessId)==null?void 0:z.email)||r.email||"N/A";let i=r.subject;if(!i&&r.items&&r.items.length>0){const g=r.items.map(F=>F.productName).filter(Boolean);g.length>0?(i=`Offer for ${g.slice(0,2).join(" & ")}`,g.length>2&&(i+="...")):i="Offer for your requirement"}else i||(i="Offer for your requirement");const m=r.reference||`Your telecom enquiry dated ${new Date().toLocaleDateString("en-IN")}`,f=r.date?new Date(r.date).toLocaleDateString("en-IN"):new Date().toLocaleDateString("en-IN"),q=r.quotationNumber||"MCIPL/OFR/0/NXL",me=r.quotationNotes||"If Installation or any other Service is required, additional charges of Rs.4,500/- will be Applicable extra on PER MAN DAY (i.e, Per Engineer Per Day) basis + GST 18% Extra. If required, you have to release a separate Work Order",Le=r.customerScope||`Transportation from our works to your site
Unloading the materials @Site, Storage, Security, Inhouse Transportation
Required Cables, SFU, Ladders, Scaffoldings, Platforms, Cranes, Chain Block other requirements for Installation.
Installation with Required Base & Cables, Materials & Modifications
Additional Materials, Spares, Modifications & Services (if required)`,Ie=Array.from(new Set((v=r.items)==null?void 0:v.map(g=>g.hsnSac).filter(g=>g&&g.trim()!==""))).join(", ");let se=r.hsnCodes;!se&&Ie?se=Ie:se||(se="Spares - 84311090, Service - 998719");const Te=[{label:"PRICES",value:r.pricesTerms||"EX WORKS COIMBATORE with open packing basis."},{label:"TAXES",value:r.warranty||"12 months from the date of dispatch or 1000 running hours whichever is earlier."},{label:"PAYMENT TERMS",value:r.ourPaymentTerms||"100% payment + 100% GST before dispatch from our works"},{label:"DELIVERY",value:r.delivery||"4 - 6 weeks against receipt of your firm PO"},{label:"PACKING & FORWARDING CHARGES",value:r.packingForwardingCharges||"NA"},{label:"TRANSPORTATION CHARGES",value:r.transportationCharges||"Customer’s scope"},{label:"TRANSPORTER NAME",value:r.transporterName||"Customer’s Vehicle"},{label:"MODE & PLACE OF DELIVERY",value:r.modePlaceDelivery||"EX WORKS"},{label:"VALIDITY",value:r.offerValidity||"30 days from the date of this offer."},{label:"HSN CODES",value:se}];await C(),e.setFontSize(10),e.setTextColor("#000"),e.setFont("helvetica","normal"),e.text(q,t,n),n+=s*2,e.text("To,",t,n),n+=s,e.setFont("helvetica","bold"),e.text(`M/s ${d}`,t,n),e.setFont("helvetica","normal"),n+=s,e.text(`KIND ATTN: ${T}`,t,n),n+=s,e.text(`Mobile: ${E}`,t,n),n+=s,e.text(`E-mail: ${a}`,t,n),n+=s*2,e.setFont("helvetica","bold"),e.text(`SUB: ${i}`,t,n),e.setFont("helvetica","normal"),n+=s,e.text(`REF: ${m}`,t,n),e.text(`DATE: ${f}`,c-t,t+40,{align:"right"}),n+=s*2,e.setFont("helvetica","bold"),e.text("Dear Customer,",t,n),n+=s*2,e.setFont("helvetica","normal"),e.text("We thank you for enquiry, we are pleased to submit our Techno Commercial Offer, as under.",t,n,{maxWidth:c-2*t}),n+=s*2,e.text("We, “Mega Cranes” is a Promising & Reliable Original Equipment Manufacturer of Overhead Cranes and Electric Wire Rope Hoist in South India, situated at Coimbatore more than a decade.",t,n,{maxWidth:c-2*t}),n+=s*2,e.text("We are also an Authorized Crane Partner of “KITO” Japan for Electric Chain Hoist, Manual Hoist, Rope Hoist. KITO is the Worlds No.1 Chain Hoist manufacturer.",t,n,{maxWidth:c-2*t}),n+=s*4,e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Annexure I - Price & Scope Details",c/2,n,{align:"center"}),n+=s*2,e.text("Annexure II - Terms & Conditions",c/2,n,{align:"center"}),e.setFontSize(10),n+=s*4,e.setFont("helvetica","normal"),e.text("We hope you will find our offer most competitive, if you have clarifications, please feel free to contact us.",t,n,{maxWidth:c-2*t}),n+=s*2,e.text("Looking forward for your valued order at the earliest.",t,n),n+=s*2,e.text("Yours Faithfully",t,n),n+=s,e.setFont("helvetica","bold"),e.text("For MEGA CRANES INDIA PVT LTD.,",t,n),n+=s*3,e.text("Sivaraman.P.S",t,n),n+=s,e.setFont("helvetica","normal"),e.text("Head – Business Development",t,n),n+=s,e.text("+91 9944039125",t,n);let W=e.internal.getNumberOfPages();e.addPage(),n=t,await C(),e.setFontSize(14),e.setFont("helvetica","bold"),n+=s,e.text("ANNEXURE - I (PRICE & SCOPE)",c/2,n,{align:"center"}),n+=s*2,e.setFontSize(9),e.setFont("helvetica","bold");const h=t;let l=n;const p=(c-2*t)*.55,x=(c-2*t)*.15,y=(c-2*t)*.1,H=(c-2*t)*.2,b=7;e.setFillColor("#f2f2f2"),e.rect(h,l,c-2*t,b,"F"),e.setDrawColor("#000"),e.setLineWidth(.2),e.text("DESCRIPTION",h+u,l+b/2,{align:"left",baseline:"middle"}),e.text("UNIT PRICE",h+p+x-u,l+b/2,{align:"right",baseline:"middle"}),e.text("QTY",h+p+x+y/2,l+b/2,{align:"center",baseline:"middle"}),e.text("TOTAL PRICE",h+p+x+y+H-u,l+b/2,{align:"right",baseline:"middle"}),e.rect(h,l,p,b),e.rect(h+p,l,x,b),e.rect(h+p+x,l,y,b),e.rect(h+p+x+y,l,H,b),l+=b,e.setFontSize(8),e.setFont("helvetica","normal");for(const g of r.items||[]){const F=g.description||g.productName||"N/A",k=parseFloat(g.rate||0),O=parseFloat(g.quantity||0),ae=k*O,K=e.splitTextToSize(F,p-2*u),Ue=K.length*s,_=Math.max(b,Ue+2*u);l+_+u>S-D-t&&(W=e.internal.getNumberOfPages(),te(W,"N/A"),e.addPage(),n=t,await C(),e.setFontSize(14),e.setFont("helvetica","bold"),n+=s,e.text("ANNEXURE - I (PRICE & SCOPE) - Continued",c/2,n,{align:"center"}),n+=s*2,l=n,e.setFontSize(9),e.setFont("helvetica","bold"),e.setFillColor("#f2f2f2"),e.rect(h,l,c-2*t,b,"F"),e.setDrawColor("#000"),e.setLineWidth(.2),e.text("DESCRIPTION",h+u,l+b/2+1,{align:"left",baseline:"middle"}),e.text("UNIT PRICE",h+p+u,l+b/2+1,{align:"right",baseline:"middle"}),e.text("QTY",h+p+x+y/2,l+b/2+1,{align:"center",baseline:"middle"}),e.text("TOTAL PRICE",h+p+x+y+H-u,l+b/2+1,{align:"right",baseline:"middle"}),e.rect(h,l,p,b),e.rect(h+p,l,x,b),e.rect(h+p+x,l,y,b),e.rect(h+p+x+y,l,H,b),l+=b,e.setFontSize(8),e.setFont("helvetica","normal")),e.rect(h,l,p,_),e.rect(h+p,l,x,_),e.rect(h+p+x,l,y,_),e.rect(h+p+x+y,l,H,_);const $e=(_-K.length*s)/2+u+1,Ne=_/2+1;e.text(K,h+u,l+$e),e.text(ce(k),h+p+x-u,l+Ne,{align:"right",baseline:"middle"}),e.text(String(O),h+p+x+y/2,l+Ne,{align:"center",baseline:"middle"}),e.text(ce(ae),h+p+x+y+H-u,l+Ne,{align:"right",baseline:"middle"}),l+=_}const A=7;e.setFontSize(9),e.setFont("helvetica","bold"),l+A>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2,l=n),e.rect(h,l,c-2*t,A),e.text("SUB TOTAL",h+p+x+y-u,l+A/2+1,{align:"right",baseline:"middle"}),e.text(ce(Y),h+p+x+y+H-u,l+A/2+1,{align:"right",baseline:"middle"}),l+=A,l+A>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2,l=n),e.setFont("helvetica","normal"),e.rect(h,l,c-2*t,A),e.text("TAXES - GST 18%",h+p+x+y-u,l+A/2+1,{align:"right",baseline:"middle"}),e.text(ce(Q),h+p+x+y+H-u,l+A/2+1,{align:"right",baseline:"middle"}),l+=A,l+A>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2,l=n),e.setFont("helvetica","bold"),e.rect(h,l,c-2*t,A),e.text("GRAND TOTAL",h+p+x+y-u,l+A/2+1,{align:"right",baseline:"middle"}),e.text(ce(X),h+p+x+y+H-u,l+A/2+1,{align:"right",baseline:"middle"}),n=l+A+10,e.setFontSize(9),e.setFont("helvetica","normal");const Me=st(X),xe=e.splitTextToSize(`Amount in words: ${Me}`,c-2*t-20);n+=s,n+xe.length*s>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2),e.text("Amount in words:",t,n),n+=s,e.text(xe,t+10,n),n+=xe.length*s+5;const N=5,B=t,V=c-2*t,be=e.splitTextToSize("Note:",V-2*N),we=e.splitTextToSize(me,V-2*N),Se=e.splitTextToSize("CUSTOMER'S SCOPE:",V-2*N),Fe=Le.split(`
`).filter(g=>g.trim()!=="");let ue=be.length*s+we.length*s+Se.length*s+Fe.length*s*1.2+N*4+20;n+ue>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2);const he=n;e.rect(B,he,V,ue);let j=he+N;e.setFont("helvetica","bold"),e.text(be,B+N,j),j+=be.length*s,e.setDrawColor("#000"),e.setLineWidth(.1),e.line(B+N,j,B+V-N,j),j+=N,e.setFont("helvetica","normal"),e.text(we,B+N,j,{maxWidth:V-2*N}),j+=we.length*s+N*2,e.setFont("helvetica","bold"),e.text(Se,B+N,j),j+=Se.length*s,e.setDrawColor("#000"),e.setLineWidth(.1),e.line(B+N,j,B+V-N,j),j+=N,e.setFont("helvetica","normal");for(const g of Fe){const F=e.splitTextToSize(`• ${g.trim()}`,V-2*N-5);for(const k of F)j+s*1.2>he+ue-N,e.text(k,B+N,j),j+=s*1.2}n=he+ue+10,e.setFontSize(14),e.setFont("helvetica","bold"),n+s*4+Te.length*b>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2),e.text("ANNEXURE - II - TERMS & CONDITIONS",c/2,n,{align:"center"}),n+=s*2,e.setFontSize(9),e.setFont("helvetica","normal");const ge=(c-2*t)*.35,Ce=(c-2*t)*.65,Oe=7;for(const g of Te){const F=e.splitTextToSize(`${g.label}:`,ge-2*u),k=e.splitTextToSize(g.value||"N/A",Ce-2*u),O=Math.max(Oe,F.length*s+2*u,k.length*s+2*u);n+O>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2,e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ANNEXURE - II - TERMS & CONDITIONS - Continued",c/2,n,{align:"center"}),n+=s*2,e.setFontSize(9),e.setFont("helvetica","normal")),e.setDrawColor("#000"),e.setLineWidth(.2),e.rect(t,n,ge,O),e.rect(t+ge,n,Ce,O);const ae=(O-F.length*s)/2+u+1,K=(O-k.length*s)/2+u+1;e.setFont("helvetica","bold"),e.text(F,t+u,n+ae),e.setFont("helvetica","normal"),e.text(k,t+ge+u,n+K),n+=O}n+=s*2,e.setFont("helvetica","bold"),n+s*5>S-D-t&&(W=e.internal.getNumberOfPages(),e.addPage(),n=t,await C(),n+=s*2),e.text("For MEGA CRANES INDIA PVT LTD.,",t,n),n+=s*3,e.text("Sivaraman.P.S",t,n),n+=s,e.setFont("helvetica","normal"),e.text("Head – Business Development",t,n),n+=s,e.text("+91 9944039125",t,n);const Ae=e.internal.getNumberOfPages();for(let g=1;g<=Ae;g++)e.setPage(g),te(g,Ae);e.save(`${r.quotationNumber||"quotation"}_${new Date().toISOString().slice(0,10)}.pdf`),ee.success("PDF downloaded successfully!",{id:I})}catch(e){console.error("Failed to generate PDF:",e),ee.error("Failed to generate PDF. Please try again.",{id:I})}finally{}},{Text:R}=Pe,$t=({quotations:r,onAddNew:I,onEdit:w,onDelete:L,onSearch:$,onViewNotes:M,loading:z,refreshQuotations:v,pagination:e})=>{var Y,ne,Q,X,d,T,E;const[c,S]=U.useState(!1),[t,n]=U.useState(null),[s,ie]=U.useState(!1),G=a=>{n(a),S(!0),ee.success("Quotation details loaded.",{duration:15500,position:"top-right"})},D=a=>{n(a),ie(!0)},u=a=>`₹${(parseFloat(a)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,C=()=>[{title:"S.No",width:60,align:"center",render:(a,i,m)=>m+1},{title:"Product Name",dataIndex:"productName",ellipsis:!0,render:(a,i)=>(console.log("Item in QuotationList:",i),a||i.name||"N/A")},{title:"Description",dataIndex:"description",ellipsis:!0,render:(a,i)=>{var m;if(!a&&((m=i.specifications)==null?void 0:m.length)>0){const f=i.specifications.find(q=>q.name==="SPECIFICATION");return f?f.value:"N/A"}return a||"N/A"}},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center",render:a=>a||"N/A"},{title:"Qty",dataIndex:"quantity",width:80,align:"center",render:a=>parseFloat(a)||0},{title:"Unit Price (₹)",width:140,align:"right",render:(a,i)=>u(i.rate||0)},{title:"Total (₹)",width:140,align:"right",render:(a,i)=>o.jsx(R,{strong:!0,style:{color:"#52c41a"},children:u((i.quantity||0)*(i.rate||0))})}],te=[{title:"Quotation #",dataIndex:"quotationNumber",render:a=>o.jsx(le,{color:"blue",children:a||"N/A"}),sorter:(a,i)=>(a.quotationNumber||"").localeCompare(i.quotationNumber||"")},{title:"Business",dataIndex:"businessName",render:(a,i)=>{var m;return((m=i.businessId)==null?void 0:m.businessName)||"N/A"},sorter:(a,i)=>{var m,f;return(((m=a.businessId)==null?void 0:m.businessName)||"").localeCompare(((f=i.businessId)==null?void 0:f.businessName)||"")}},{title:"Customer",dataIndex:"customerName",render:(a,i)=>{var m,f,q;return o.jsxs("div",{children:[o.jsx("div",{children:((m=i.businessId)==null?void 0:m.contactName)||a||"N/A"}),(((f=i.businessId)==null?void 0:f.email)||i.customerEmail)&&o.jsx("div",{style:{fontSize:12,color:"#666"},children:((q=i.businessId)==null?void 0:q.email)||i.customerEmail})]})},sorter:(a,i)=>{var m,f;return(((m=a.businessId)==null?void 0:m.contactName)||a.customerName||"").localeCompare(((f=i.businessId)==null?void 0:f.contactName)||i.customerName||"")}},{title:"Items Count",render:(a,i)=>{var m,f;return o.jsxs(le,{color:"geekblue",children:[((m=i.items)==null?void 0:m.length)||0," item",(((f=i.items)==null?void 0:f.length)||0)!==1?"s":""]})}},{title:"Latest Note",dataIndex:"notes",render:a=>{if(a&&a.length>0){const i=a[a.length-1],m=i.text.length>30?`${i.text.substring(0,30)}...`:i.text;return o.jsx(He,{title:i.text,children:o.jsx(R,{type:"secondary",children:m})})}return o.jsx(R,{type:"secondary",italic:!0,children:"No notes"})}},{title:"Total (₹)",dataIndex:"total",render:(a,i)=>{var f;const m=parseFloat(a)||((f=i.items)==null?void 0:f.reduce((q,me)=>q+(me.quantity||0)*(me.rate||0),0))||0;return o.jsx(R,{strong:!0,style:{color:"#52c41a"},children:u(m)})},sorter:(a,i)=>{const m=parseFloat(a.total)||0,f=parseFloat(i.total)||0;return m-f}},{title:"Date",dataIndex:"date",render:a=>{if(!a)return"N/A";try{return new Date(a).toLocaleDateString("en-IN")}catch{return a}},sorter:(a,i)=>{const m=new Date(a.date).getTime()||0,f=new Date(i.date).getTime()||0;return m-f}},{title:"Actions",width:80,render:(a,i)=>o.jsx(Be,{overlay:o.jsxs(J,{children:[o.jsx(J.Item,{icon:o.jsx(_e,{}),onClick:()=>G(i),children:"View Details"},"view"),o.jsx(J.Item,{icon:o.jsx(ve,{}),onClick:()=>De(i),children:"Download PDF"},"download"),o.jsx(J.Item,{icon:o.jsx(Re,{}),onClick:()=>{M(i),ee.success("Opening notes dialog...",{duration:1500})},children:"View/Add Notes"},"notes"),o.jsx(J.Item,{icon:o.jsx(Ze,{}),onClick:()=>D(i),children:"Add/View Follow-ups"},"followups"),o.jsx(J.Item,{icon:o.jsx(Je,{}),onClick:()=>{w(i),ee.success("Initiating quotation edit...",{duration:1500})},children:"Edit Quotation"},"edit"),o.jsx(J.Item,{children:o.jsxs(et,{title:"Are you sure you want to delete this account?",onConfirm:()=>L(i._id),okText:"Yes",cancelText:"No",children:[o.jsx(tt,{}),"Delete Quotation"]})})]}),trigger:["click"],children:o.jsx(de,{icon:o.jsx(Qe,{})})})}];return o.jsxs(o.Fragment,{children:[o.jsxs(ke,{style:{marginBottom:16,justifyContent:"space-between",width:"100%"},children:[o.jsx(Ee.Search,{placeholder:"Search by quotation number, business, customer, or notes...",onChange:a=>{$(a.target.value)},style:{width:150},prefix:o.jsx(Xe,{}),allowClear:!0}),o.jsx(de,{type:"primary",onClick:()=>{I(),ee.success("Prepare to create a new quotation.",{duration:1500})},style:{width:100,marginBottom:16,backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:"+  Quotation"})]}),o.jsx(oe,{columns:te,dataSource:r,rowKey:"_id",loading:z,pagination:e,scroll:{x:1200}}),o.jsx(Ke,{title:o.jsxs("div",{children:[o.jsx(R,{strong:!0,children:"Quotation Details"}),t&&o.jsx(le,{color:"blue",style:{marginLeft:8},children:t.quotationNumber})]}),open:c,onCancel:()=>S(!1),footer:[o.jsx(de,{icon:o.jsx(ve,{}),onClick:()=>De(t),children:"Download PDF"},"download"),o.jsx(de,{onClick:()=>S(!1),children:"Close"},"close")],width:1e3,children:t&&o.jsxs("div",{id:`quotation-modal-preview-${t._id}`,children:[o.jsxs(P,{column:2,bordered:!0,size:"small",children:[o.jsx(P.Item,{label:"Quotation Number",children:o.jsx(le,{color:"blue",children:t.quotationNumber||"N/A"})}),o.jsx(P.Item,{label:"Date",children:t.date?new Date(t.date).toLocaleDateString("en-IN"):"N/A"}),o.jsx(P.Item,{label:"Status",children:o.jsx(le,{color:t.status==="Approved"?"green":t.status==="Pending"?"orange":t.status==="Rejected"?"red":"blue",className:"rounded-full px-3 py-1 text-sm font-medium",children:t.status||"N/A"})}),o.jsx(P.Item,{label:"Business Name",children:t.businessName||"N/A"}),o.jsx(P.Item,{label:"Contact Person",children:((Y=t.businessId)==null?void 0:Y.contactName)||t.customerName||"N/A"}),o.jsx(P.Item,{label:"Customer Email",children:((ne=t.businessId)==null?void 0:ne.email)||t.customerEmail||"N/A"}),o.jsx(P.Item,{label:"Mobile Number",children:t.mobileNumber||((Q=t.businessId)==null?void 0:Q.mobileNumber)||((X=t.businessId)==null?void 0:X.phone)||"N/A"}),o.jsx(P.Item,{label:"GSTIN",children:o.jsx(R,{code:!0,children:t.gstin||"N/A"})}),o.jsx(P.Item,{label:"Business Info",span:2,children:o.jsx(R,{style:{whiteSpace:"pre-wrap"},children:t.businessInfo||"N/A"})}),o.jsx(P.Item,{label:"Total Amount",span:2,children:o.jsx(R,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:u(t.total||((d=t.items)==null?void 0:d.reduce((a,i)=>a+(i.quantity||0)*(i.rate||0),0))||0)})})]}),((T=t.items)==null?void 0:T.length)>0&&o.jsxs(o.Fragment,{children:[o.jsxs(ye,{orientation:"left",children:["Items (",t.items.length,")"]}),o.jsx(oe,{dataSource:t.items,columns:C(),pagination:!1,size:"small",rowKey:(a,i)=>`${t._id}-item-${i}`,bordered:!0,expandable:{expandedRowRender:a=>{var i;return o.jsx("div",{style:{margin:0,padding:0},children:((i=a.specifications)==null?void 0:i.length)>0&&o.jsx(P,{column:1,size:"small",children:a.specifications.filter(m=>m.name!=="SPECIFICATION").map((m,f)=>o.jsx(P.Item,{label:m.name,children:m.value},f))})})},rowExpandable:a=>{var i;return((i=a.specifications)==null?void 0:i.length)>0}},summary:a=>{const i=a.reduce((m,f)=>m+(f.quantity||0)*(f.rate||0),0);return o.jsx(oe.Summary,{fixed:!0,children:o.jsxs(oe.Summary.Row,{children:[o.jsxs(oe.Summary.Cell,{index:0,colSpan:6,children:[" ",o.jsx(R,{strong:!0,children:"Grand Total:"})]}),o.jsxs(oe.Summary.Cell,{index:6,children:[" ",o.jsx(R,{strong:!0,style:{color:"#52c41a"},children:u(i)})]})]})})}})]}),((E=t.notes)==null?void 0:E.length)>0&&o.jsxs(o.Fragment,{children:[o.jsxs(ye,{orientation:"left",children:["Notes (",t.notes.length,")"]}),t.notes.map((a,i)=>o.jsxs("div",{style:{marginBottom:12,padding:8,background:"#f5f5f5",borderRadius:4},children:[o.jsxs(R,{italic:!0,children:['"',a.text,'"']}),o.jsx("br",{}),o.jsxs(R,{type:"secondary",style:{fontSize:"0.8em"},children:["— ",a.author," on"," ",a.timestamp||new Date(t.createdAt).toLocaleDateString("en-IN")]})]},i))]})]})}),t&&o.jsx(ot,{visible:s,onClose:()=>ie(!1),quotation:t,refreshQuotations:v})]})};export{$t as default};
