import{r as j,I as Q,u as X,R as z,n as e,B as P,P as x}from"./index-Cqbpo4Tu.js";import{F as s}from"./index-CyRYXxfE.js";import{D as $}from"./index-BAZIrpXB.js";import{R as D,C as h}from"./index-CpX-krNH.js";import{I as a,i as T}from"./axios-BQcx7bQ3.js";import{T as Z}from"./index-X5u0s5TF.js";import{S as C}from"./index-Bg3F5gRI.js";import{D as J}from"./index-D-FGh7vi.js";import{R as V,T as K}from"./index-CWCP-2YO.js";import{T as M}from"./index-FfGBM9-D.js";import{h as F}from"./moment-C5S46NFB.js";import{D as ee}from"./index-zxiQ_mm-.js";import{L as A}from"./index-B6WVjc8L.js";import{M as te}from"./index-CKMbULed.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},re=function(y,r){return j.createElement(Q,X({},y,{ref:r,icon:se}))},Ne=j.forwardRef(re);const{TextArea:le}=a,{Option:i}=C,Ie=({visible:f,onClose:y,onSave:r,initialValues:l})=>{var v;const[d]=s.useForm(),[g,w]=z.useState(!1),u=s.useWatch("sourceType",d);z.useEffect(()=>{d.resetFields(),l?d.setFieldsValue(l):d.setFieldsValue({sourceType:"Direct",status:"Active"})},[l,d]);const I=()=>{d.validateFields().then(n=>{w(!0);const N=new Date().toLocaleString(),o=n.noteInput?{text:n.noteInput,timestamp:N}:null,m=(l==null?void 0:l.notes)||[],p=o?[...m,o]:m,b={...n,notes:p};delete b.noteInput,b.sourceType!=="Facebook Referral"&&delete b.referralPersonName,r(b),x.success(`Account ${l?"updated":"created"} successfully!`),w(!1),y()}).catch(n=>{console.log("Validate Failed:",n),x.error("Please fill in all required fields.")})};return e.jsx($,{title:l?"Edit Business Account":"Create New Business Account",width:720,onClose:y,visible:f,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(P,{onClick:y,style:{marginRight:8},children:"Cancel"}),e.jsx(P,{onClick:I,type:"primary",loading:g,children:l?"Update Account":"Create Account"})]}),children:e.jsxs(s,{form:d,layout:"vertical",initialValues:l,children:[e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"contactName",label:"Contact Person Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsx(s.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(a,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(s.Item,{name:"landmark",label:"Landmark",children:e.jsx(a,{placeholder:"Landmark (Optional)"})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(Z,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(s.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(s.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(s.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(C,{placeholder:"Select Type",children:[e.jsx(i,{value:"Hot",children:"Hot"}),e.jsx(i,{value:"Warm",children:"Warm"}),e.jsx(i,{value:"Cold",children:"Cold"})]})}),e.jsx(s.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(C,{placeholder:"Select Status",children:[e.jsx(i,{value:"Active",children:"Active"}),e.jsx(i,{value:"Inactive",children:"Inactive"}),e.jsx(i,{value:"Waiting",children:"Waiting"}),e.jsx(i,{value:"Closed",children:"Closed"})]})}),e.jsx(s.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(C,{placeholder:"How did you hear about us?",children:[e.jsx(i,{value:"Direct",children:"Direct"}),e.jsx(i,{value:"Facebook Referral",children:"Facebook Referral"}),e.jsx(i,{value:"Google Ads",children:"Google Ads"}),e.jsx(i,{value:"Website",children:"Website"}),e.jsx(i,{value:"Cold Call",children:"Cold Call"}),e.jsx(i,{value:"Other",children:"Other"})]})}),u==="Facebook Referral"&&e.jsx(s.Item,{name:"referralPersonName",label:"Referral Person Name",rules:[{required:!0,message:"Please enter the referral person's name"}],children:e.jsx(a,{placeholder:"Name of the person who referred from Facebook"})}),e.jsx(s.Item,{name:"noteInput",label:"Add Note",children:e.jsx(le,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((v=l==null?void 0:l.notes)==null?void 0:v.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:l.notes.map((n,N)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[n.timestamp,":"]})," ",n.text]},N))})]})]})})},{TextArea:oe}=a,{Title:ae,Text:ne}=M,Fe=({visible:f,onClose:y,account:r,refreshAccounts:l})=>{const[d]=s.useForm(),[g,w]=j.useState(!1),[u,I]=j.useState([]);j.useEffect(()=>{f&&(r!=null&&r._id)&&I(r.notes||[])},[f,r]);const v=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},n=async()=>{try{const{note:o}=await d.validateFields();w(!0);const m={text:o,timestamp:new Date().toLocaleString(),author:v()},p=[...u,m];await T.put(`/api/accounts/${r._id}`,{...r,notes:p}),x.success("Note added successfully!"),I(p),d.resetFields(),l()}catch{x.error("Failed to add note.")}finally{w(!1)}},N=()=>!u||u.length===0?e.jsx(ne,{type:"secondary",children:"No notes to show"}):u.map((o,m)=>{const p=m>0?u[m-1]:null,b=new Date(o.timestamp).toDateString(),k=p?new Date(p.timestamp).toDateString():null,L=b!==k;return e.jsxs("div",{children:[L&&e.jsx("div",{className:"note-date-header",children:b}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[o.author," Â Â  ",o.timestamp]}),e.jsx("div",{className:"note-text",children:o.text})]})]},m)});return e.jsxs($,{title:e.jsxs(ae,{level:4,style:{margin:0},children:["Notes for ",r.businessName]}),open:f,onClose:y,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[N(),e.jsx(J,{}),e.jsxs(s,{form:d,layout:"vertical",children:[e.jsx(s.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(oe,{rows:3,placeholder:"Type your note here...",disabled:g})}),e.jsx(P,{type:"primary",icon:e.jsx(V,{}),onClick:n,loading:g,block:!0,children:"Add Note"})]})]})},{TextArea:de}=a,{TabPane:U}=K,Se=({visible:f,onClose:y,account:r,refreshAccounts:l})=>{const[d,g]=j.useState(""),[w,u]=j.useState(null),[I,v]=j.useState(!1),[n,N]=j.useState([]),[o,m]=j.useState(null);j.useEffect(()=>{f&&(r!=null&&r._id)&&p()},[f,r]);const p=async()=>{try{const t=await T.get(`/api/accounts/${r._id}/followups`);N(t.data||[])}catch{x.error("Failed to fetch follow-ups")}},b=()=>{if(!d||!w){x.error("Please fill in all fields");return}const t=JSON.parse(localStorage.getItem("user")),c=t==null?void 0:t._id;if(!c){x.error("User not found");return}v(!0);const S={date:w.format("YYYY-MM-DD"),note:d,addedBy:c};(o===null?T.post(`/api/accounts/${r._id}/followups`,S):T.put(`/api/accounts/${r._id}/followups/${o}`,S)).then(()=>{x.success(o===null?"Follow-up added":"Follow-up updated"),g(""),u(null),m(null),p(),l()}).catch(R=>{var H,G;x.error(((G=(H=R==null?void 0:R.response)==null?void 0:H.data)==null?void 0:G.message)||"Failed to save follow-up")}).finally(()=>v(!1))},k=t=>{const c=n[t];g(c.note),u(F(c.date)),m(t)},L=t=>{te.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up?",okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{T.delete(`/api/accounts/${r._id}/followups/${t}`).then(()=>{x.success("Follow-up deleted"),p(),l()}).catch(()=>x.error("Failed to delete follow-up"))}})},Y=F().format("YYYY-MM-DD"),B=[...n].sort((t,c)=>new Date(c.date)-new Date(t.date)),E=B.filter(t=>F(t.date).format("YYYY-MM-DD")===Y),_=B.filter(t=>F(t.date).isAfter(Y,"day")),W=B.filter(t=>F(t.date).isBefore(Y,"day")),q=(t,c)=>{var S,O;return e.jsx(A.Item,{actions:[e.jsx("a",{onClick:()=>k(c),children:"Edit"},"edit"),e.jsx("a",{onClick:()=>L(c),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(M.Text,{strong:!0,children:F(t.date).format("DD-MM-YYYY")}),e.jsx("br",{}),t.note,e.jsx("br",{}),e.jsxs(M.Text,{type:"secondary",children:["By ",((S=t.addedBy)==null?void 0:S.name)||((O=t.addedBy)==null?void 0:O.email)||"Unknown"]})]})})};return e.jsxs($,{title:`Follow-ups: ${r==null?void 0:r.businessName}`,open:f,onClose:()=>{m(null),g(""),u(null),y()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(ee,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:w,onChange:t=>u(t)}),e.jsx(de,{rows:4,placeholder:"Enter follow-up note",value:d,onChange:t=>g(t.target.value)}),e.jsx(P,{type:"primary",block:!0,onClick:b,loading:I,style:{marginTop:10},children:o===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(J,{}),e.jsxs(K,{defaultActiveKey:"today",children:[e.jsx(U,{tab:`Today's Follow-ups (${E.length})`,children:e.jsx(A,{dataSource:E,renderItem:(t,c)=>q(t,n.indexOf(t)),locale:{emptyText:"No follow-ups for today"}})},"today"),e.jsx(U,{tab:`Upcoming Follow-ups (${_.length})`,children:e.jsx(A,{dataSource:_,renderItem:(t,c)=>q(t,n.indexOf(t)),locale:{emptyText:"No upcoming follow-ups"}})},"upcoming"),e.jsx(U,{tab:`Past Follow-ups (${W.length})`,children:e.jsx(A,{dataSource:W,renderItem:(t,c)=>q(t,n.indexOf(t)),locale:{emptyText:"No past follow-ups"}})},"past")]})]})};export{Ie as B,Se as F,Fe as N,Ne as R};
