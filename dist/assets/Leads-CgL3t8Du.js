import{r as n,I as O,t as G,s as r,p as t,q as Ce,B as g,D as ve,M as p}from"./index-Bei6p0LZ.js";import{i as v,I as M}from"./axios-YMP7eKdN.js";import{E as W,R as we}from"./jspdf.es.min-BKN8IyFz.js";import z from"./html2canvas.esm-CBrSDip1.js";import{u as I,a as ye}from"./xlsx-x9ZxUr7s.js";import{B as be,N as je,F as Ae,R as Fe}from"./FollowUpDrawer-7buoAjGA.js";import{C as Se}from"./index-D35NAn0s.js";import{a as B}from"./index-CxwO9Rc_.js";import{R as De,T as U}from"./index-52h4BVIb.js";import{F as Le,R as Ne}from"./Table-D7To-GTS.js";import{E as ke}from"./index-NfKGJaQN.js";import{M as H}from"./index-Li4Z4oqI.js";import{T as Ie,a as Te}from"./index-CQPpjbGx.js";import{R as Pe}from"./moment-C3PZI8nc.js";import{R as Re}from"./MessageOutlined-Cr4LarFb.js";import{R as Ee}from"./DeleteOutlined-BWQ6bMPl.js";import"./index-CSlP1qA3.js";import"./index-C0x4dXUg.js";import"./context-COkb6phW.js";import"./index-B3YJcg2V.js";import"./index-DzB8EFJ-.js";import"./index-DQN8ynfO.js";import"./index-BibDJDcy.js";import"./index-PawOeO7A.js";var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},Ve=function(u,h){return n.createElement(O,G({},u,{ref:h,icon:$e}))},_e=n.forwardRef(Ve),Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},We=function(u,h){return n.createElement(O,G({},u,{ref:h,icon:Me}))},ze=n.forwardRef(We);const{Title:Be}=Ie,{TabPane:b}=U,w="/api/accounts",pt=()=>{const[j,u]=n.useState(!1),[h,T]=n.useState(null),[A,Y]=n.useState(""),[x,K]=n.useState("active"),[q,F]=n.useState(!1),[P,S]=n.useState(null),[D,L]=n.useState(null),[J,C]=n.useState([]),[Q,R]=n.useState(!1),[X,E]=n.useState(!1),[N,$]=n.useState(null),[Z,ee]=n.useState(0),[te,se]=n.useState(0),[oe,ae]=n.useState(0),[ne,re]=n.useState(0),V=n.useRef(null);n.useEffect(()=>{f()},[x]);const f=async()=>{try{const e=(await v.get(`${w}`)).data,a=e.filter(i=>i.status==="Active"&&!i.isCustomer),o=e.filter(i=>i.isCustomer),c=e.filter(i=>i.status==="Waiting"&&!i.isCustomer),l=e.filter(i=>i.status==="Closed");ee(a.length),se(o.length),ae(c.length),re(l.length),C(x==="active"?a:x==="customers"?o:x==="waiting"?c:x==="closed"?l:e)}catch(s){r.error("Failed to fetch accounts."),console.error("Fetch accounts error:",s)}},ie=async s=>{var e;try{h?(await v.put(`${w}/${h._id}`,s),r.success("Account updated successfully!")):(await v.post(w,s),r.success("Account created successfully!")),u(!1),f()}catch(a){r.error("Failed to save account."),console.error("Save account error:",((e=a.response)==null?void 0:e.data)||a.message)}},ce=s=>{T(s),u(!0)},le=async s=>{var e;try{await v.delete(`${w}/${s}`),r.success("Account deleted successfully (soft delete)!"),f()}catch(a){r.error("Failed to delete account."),console.error("Delete account error:",((e=a.response)==null?void 0:e.data)||a.message)}},de=s=>{$(s),R(!0)},ue=s=>{$(s),E(!0)},_=(s,e)=>{S(e),L(s),F(!0)},me=async()=>{var s;try{const e={...P,isCustomer:D};await v.put(`${w}/${P._id}`,e),r.success(`Account status changed to ${D?"Customer":"Lead"}!`),f()}catch(e){r.error("Failed to update account status."),console.error("Status update error:",((s=e.response)==null?void 0:s.data)||e.message)}finally{F(!1),S(null),L(null)}},pe=()=>{F(!1),S(null),L(null)},he=async()=>{const s=V.current;if(!s){r.error("Table content not found for PDF export.");return}r.loading("Generating PDF...",{id:"pdf-toast"});try{const e=await z(s,{scale:2}),a=e.toDataURL("image/png"),o=new W("p","mm","a4"),c=210,l=297,i=e.height*c/e.width;let d=i,m=0;for(o.addImage(a,"PNG",0,m,c,i),d-=l;d>=0;)m=d-i,o.addPage(),o.addImage(a,"PNG",0,m,c,i),d-=l;o.save("Leads_Customers_Data.pdf"),r.success("PDF generated!",{id:"pdf-toast"})}catch(e){console.error("Error generating PDF:",e),r.error("Failed to generate PDF.",{id:"pdf-toast"})}},fe=()=>{if(y.length===0){r.error("No data to export to Excel.");return}const s=y.map((o,c)=>({"S.No":c+1,"Business Name":o.businessName,"Contact Name":o.contactName,Email:o.email,"Mobile Number":o.mobileNumber,"Lead Type":o.type,Status:o.status,"Source Type":o.sourceType,"GST Number":o.gstNumber,"Phone Number":o.phoneNumber,"Address Line 1":o.addressLine1,"Address Line 2":o.addressLine2,"Address Line 3":o.addressLine3,Landmark:o.landmark,City:o.city,Pincode:o.pincode,State:o.state,Country:o.country,Website:o.website,"Is Customer":o.isCustomer?"Yes":"No","Created At":new Date(o.createdAt).toLocaleString()})),e=I.json_to_sheet(s),a=I.book_new();I.book_append_sheet(a,e,"Leads & Customers"),ye(a,"Leads_Customers_Data.xlsx"),r.success("Data exported to Excel!")},ge=[{title:"S.No",key:"sno",render:(s,e,a)=>a+1,width:60},{title:"Business Name",dataIndex:"businessName",key:"businessName",filterDropdown:({setSelectedKeys:s,selectedKeys:e,confirm:a,clearFilters:o})=>t.jsxs("div",{style:{padding:8},children:[t.jsx(M,{placeholder:"Search Business Name",value:e[0],onChange:c=>s(c.target.value?[c.target.value]:[]),onPressEnter:()=>a(),style:{marginBottom:8,display:"block"}}),t.jsx(g,{type:"primary",onClick:()=>a(),icon:t.jsx(B,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t.jsx(g,{onClick:()=>o(),size:"small",style:{width:90},children:"Reset"})]}),onFilter:(s,e)=>e.businessName.toLowerCase().includes(s.toLowerCase()),responsive:["xs","sm","md","lg"]},{title:"Contact Name",dataIndex:"contactName",key:"contactName",responsive:["md","lg"]},{title:"Email",dataIndex:"email",key:"email",responsive:["lg"]},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber",responsive:["md","lg"]},{title:"Lead Type",dataIndex:"type",key:"type",filters:[{text:"Hot",value:"Hot"},{text:"Warm",value:"Warm"},{text:"Cold",value:"Cold"}],onFilter:(s,e)=>e.type.indexOf(s)===0,responsive:["md","lg"]},{title:"Status",dataIndex:"status",key:"status",render:s=>{let e;switch(s){case"Active":e="green";break;case"Inactive":e="red";break;case"Waiting":e="orange";break;case"Closed":e="purple";break;default:e="blue"}return t.jsx(Te,{color:e,children:s})},filters:[{text:"Active",value:"Active"},{text:"Inactive",value:"Inactive"},{text:"Waiting",value:"Waiting"},{text:"Closed",value:"Closed"}],onFilter:(s,e)=>e.status.indexOf(s)===0,responsive:["sm","md","lg"]},{title:"Source Type",dataIndex:"sourceType",key:"sourceType",filters:[{text:"Direct",value:"Direct"},{text:"Facebook Referral",value:"Facebook Referral "},{text:"Google Ads",value:"Google Ads"},{text:"Website",value:"Website"},{text:"Cold Call",value:"Cold Call"},{text:"Other",value:"Other"}],onFilter:(s,e)=>{var a;return((a=e.sourceType)==null?void 0:a.indexOf(s))===0},responsive:["lg"]},{title:"Action",key:"action",width:80,render:(s,e)=>t.jsx(ve,{overlay:t.jsxs(p,{children:[t.jsx(p.Item,{icon:t.jsx(Ne,{}),onClick:()=>ce(e),children:"Edit Account"},"edit"),t.jsx(p.Item,{icon:t.jsx(Re,{}),onClick:()=>de(e),children:"View/Add Notes"},"notes"),t.jsx(p.Item,{icon:t.jsx(Fe,{}),onClick:()=>ue(e),children:"View/Add Follow-ups"},"followup"),t.jsx(p.Item,{icon:t.jsx(we,{}),onClick:()=>xe(e),children:"Generate PDF (Single)"},"generate-pdf-single"),e.isCustomer?t.jsx(p.Item,{onClick:()=>_(!1,e),children:"Change to Lead"},"change-to-lead"):t.jsx(p.Item,{onClick:()=>_(!0,e),children:"Change to Customer"},"change-to-customer"),t.jsx(p.Item,{icon:t.jsx(Ee,{}),danger:!0,onClick:()=>{H.confirm({title:"Delete Account",content:"Are you sure you want to delete this account? This action cannot be undone (soft delete).",okText:"Yes, Delete",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>le(e._id)})},children:"Delete Account"},"delete")]}),trigger:["click"],children:t.jsx(g,{icon:t.jsx(Pe,{})})})}],xe=async s=>{const e=document.getElementById(`lead-${s._id}`);if(!e){r.error("PDF content not found for this account.");return}r.loading("Generating PDF...",{id:"pdf-toast"});try{const a=await z(e,{scale:2}),o=a.toDataURL("image/png"),c=new W("p","mm","a4"),l=210,i=297,d=a.height*l/a.width;let m=d,k=0;for(c.addImage(o,"PNG",0,k,l,d),m-=i;m>=0;)k=m-d,c.addPage(),c.addImage(o,"PNG",0,k,l,d),m-=i;c.save(`${s.businessName}-details.pdf`),r.success("PDF generated!",{id:"pdf-toast"})}catch(a){console.error("Error generating PDF:",a),r.error("Failed to generate PDF.",{id:"pdf-toast"})}},y=J.filter(s=>s.businessName.toLowerCase().includes(A.toLowerCase())||s.contactName.toLowerCase().includes(A.toLowerCase()));return t.jsxs(Se,{title:t.jsx(Be,{level:2,children:"Manage Leads & Customers"}),children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[t.jsx(M,{placeholder:"Search by business or contact name",prefix:t.jsx(B,{}),style:{width:"100%",maxWidth:300},value:A,onChange:s=>Y(s.target.value)}),t.jsxs(Ce,{children:[" ",t.jsx(g,{type:"primary",icon:t.jsx(De,{}),onClick:()=>{T(null),u(!0)},children:"Add New Account"}),t.jsx(g,{icon:t.jsx(ze,{}),onClick:he,children:"Export to PDF"}),t.jsx(g,{icon:t.jsx(_e,{}),onClick:fe,children:"Export to Excel"})]})]}),t.jsxs(U,{defaultActiveKey:"active",onChange:K,children:[t.jsx(b,{tab:`Active Leads (${Z})`},"active"),t.jsx(b,{tab:`Customers (${te})`},"customers"),t.jsx(b,{tab:`Waiting Leads (${oe})`},"waiting"),t.jsx(b,{tab:`Closed Accounts (${ne})`},"closed")]}),t.jsx("div",{ref:V,children:y.length>0?t.jsx(Le,{columns:ge,dataSource:y,rowKey:"_id",scroll:{x:"max-content"}}):t.jsx(ke,{description:"No accounts found."})}),t.jsx(be,{visible:j,onClose:()=>u(!1),onSave:ie,initialValues:h}),N&&t.jsxs(t.Fragment,{children:[t.jsx(je,{visible:Q,onClose:()=>R(!1),account:N,refreshAccounts:f}),t.jsx(Ae,{visible:X,onClose:()=>E(!1),account:N,refreshAccounts:f})]}),t.jsx(H,{title:"Change Account Status",open:q,onOk:me,onCancel:pe,okText:"Yes",cancelText:"No",children:t.jsxs("p",{children:["Are you sure you want to change this account's status to ",D?"Customer":"Lead","?"]})})]})};export{pt as default};
