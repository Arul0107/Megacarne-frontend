import{r as a,x as he,n as e,ak as o,am as xe,B as ge,an as r}from"./index-BxUAznnX.js";import{i as p}from"./axios-YBtE4rUB.js";import{B as je,F as Ce,N as we,R as ve}from"./FollowUpDrawer-D13mBaq3.js";import{R as ye,h as Se,E as Ie}from"./html2canvas.esm-BGjCEV5z.js";import{C as be}from"./index-CxlRiecW.js";import{T as Ne}from"./index-aw9NpNYx.js";import{I as Te,b as Ae}from"./index-PwdRyfCR.js";import{c as De}from"./TextArea-B6Xpuu3I.js";import{T as W}from"./index-kMGBPy9G.js";import{F as B}from"./Table-Di3FjhfK.js";import{M as E}from"./index-CzaeX_mx.js";import{T as h}from"./index-26GsdBxa.js";import{R as Fe}from"./EditOutlined-BKTsHuld.js";import{R as _e}from"./MessageOutlined-bCpa50s0.js";import{R as $e}from"./PrinterOutlined-DHZMuMrq.js";import{R as Re}from"./DeleteOutlined-DMMmF65q.js";import"./index-BjwwNMEl.js";import"./index-CnAMJFg8.js";import"./context-CiUtpgNi.js";import"./useClosable-DjfzdunO.js";import"./index-BvbQCTxL.js";import"./index-BpNbUA2a.js";import"./index-BIwb_-H0.js";import"./moment-C5S46NFB.js";import"./index-y-AEraVK.js";import"./index-DXs-2Fr8.js";import"./addEventListener-C4ZJtlGU.js";import"./index-BD-5R8gr.js";import"./InfoCircleFilled-DLq4bgfK.js";import"./ActionButton-CSwqXRR_.js";import"./index-DG0ODdWn.js";const{Title:ke}=Ne,{TabPane:M}=W,pt=()=>{const[b,G]=a.useState(""),[H,O]=a.useState("active"),[K,q]=a.useState([]),[x,l]=a.useState(!1),[z,Y]=a.useState([]),[J,N]=a.useState(!1),[Q,w]=a.useState(!1),[i,T]=a.useState(null),[X,v]=a.useState(!1),[f,Z]=a.useState(null),[A,ee]=a.useState(null),[te,y]=a.useState(!1),[d,D]=a.useState(null),[se,F]=a.useState(!1),[ae,_]=a.useState(!1),[g,$]=a.useState(null),ne=he(),m=()=>{l(!0),p.get("/api/accounts/customers").then(t=>{q(Array.isArray(t.data)?t.data:[])}).catch(()=>{o.error("Failed to load customers")}).finally(()=>l(!1))},oe=()=>{N(!0),p.get("/api/accounts/users/all").then(t=>{Y(t.data)}).catch(()=>{o.error("Failed to load user list")}).finally(()=>N(!1))};a.useEffect(()=>{m(),oe()},[]);const ie=t=>{T(t),w(!0)},re=t=>{l(!0),(i!=null&&i._id?p.put(`/api/accounts/${i._id}`,t):p.post("/api/accounts",t)).then(()=>{o.success(`Customer ${i!=null&&i._id?"updated":"created"} successfully`),m()}).catch(()=>{o.error(`Failed to ${i!=null&&i._id?"update":"create"} customer`)}).finally(()=>{w(!1),T(null),l(!1)})},R=(t,s)=>{Z(s),ee(t?"Active":"Inactive"),v(!0)},le=()=>{l(!0);const t={...f,status:A};p.put(`/api/accounts/${f._id}`,t).then(()=>{o.success("Status updated"),m()}).catch(()=>{o.error("Failed to update status")}).finally(()=>{v(!1),l(!1)})},ce=t=>{D(t),y(!0)},de=()=>{d!=null&&d._id&&(l(!0),p.delete(`/api/accounts/${d._id}`).then(()=>{o.success("Customer deleted successfully"),m()}).catch(()=>{o.error("Failed to delete customer")}).finally(()=>{y(!1),D(null),l(!1)}))},ue=t=>{$(t),F(!0)},me=t=>{$(t),_(!0)},pe=t=>{ne(`/customers/${t._id}`)},fe=async t=>{const s=document.getElementById(`customer-pdf-content-${t._id}`);if(!s){o.error("PDF content not found.");return}o.loading("Generating PDF...",{id:"pdf-toast"});try{const n=await Se(s,{scale:2}),c=n.toDataURL("image/png"),u=new Ie("p","mm","a4"),S=210,L=297,j=n.height*S/n.width;let C=j,I=0;for(u.addImage(c,"PNG",0,I,S,j),C-=L;C>=0;)I=C-j,u.addPage(),u.addImage(c,"PNG",0,I,S,j),C-=L;u.save(`${t.businessName}-details.pdf`),o.success("PDF generated!",{id:"pdf-toast"})}catch{o.error("Failed to generate PDF.",{id:"pdf-toast"})}},k=K.filter(t=>{var n,c,u;const s=b.toLowerCase();return((n=t.businessName)==null?void 0:n.toLowerCase().includes(s))||((c=t.contactName)==null?void 0:c.toLowerCase().includes(s))||((u=t.email)==null?void 0:u.toLowerCase().includes(s))}),V=k.filter(t=>t.status==="Active"),P=k.filter(t=>t.status==="Inactive"),U=[{title:"Sno.",render:(t,s,n)=>n+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(h,{color:"red",children:"Hot"});case"Warm":return e.jsx(h,{color:"orange",children:"Warm"});case"Cold":return e.jsx(h,{color:"blue",children:"Cold"});default:return e.jsx(h,{children:"Unknown"})}}},{title:"Assigned To",render:(t,s)=>s.assignedTo?e.jsxs("span",{children:[s.assignedTo.name," (",s.assignedTo.role,")"]}):e.jsx("em",{children:"Unassigned"})},{title:"Latest Note",render:(t,s)=>{var c;const n=(c=s.notes)==null?void 0:c[s.notes.length-1];return n?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:n.timestamp}),e.jsx("br",{}),n.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsx(h,{color:s.status==="Active"?"green":"red",children:s.status})},{title:"Actions",render:(t,s)=>e.jsx(xe,{overlay:e.jsxs(r,{children:[e.jsx(r.Item,{icon:e.jsx(Fe,{}),onClick:()=>ie(s),children:"Edit Customer"},"edit"),e.jsx(r.Item,{icon:e.jsx(_e,{}),onClick:()=>ue(s),children:"View/Add Notes"},"notes"),e.jsx(r.Item,{icon:e.jsx(ve,{}),onClick:()=>me(s),children:"View/Add Follow-ups"},"followups"),e.jsx(r.Item,{icon:e.jsx(Ae,{}),onClick:()=>pe(s),children:"View Profile"},"view-profile"),e.jsx(r.Item,{icon:e.jsx($e,{}),onClick:()=>fe(s),children:"Generate PDF"},"generate-pdf"),s.status==="Active"?e.jsx(r.Item,{onClick:()=>R(!1,s),children:"Change to Inactive"},"inactive"):e.jsx(r.Item,{onClick:()=>R(!0,s),children:"Change to Active"},"active"),e.jsx(r.Item,{icon:e.jsx(Re,{}),danger:!0,onClick:()=>ce(s),children:"Delete Customer"},"delete")]}),children:e.jsx(ge,{icon:e.jsx(ye,{})})})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(be,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,flexWrap:"wrap"},children:[e.jsx(ke,{level:4,children:"Customers"}),e.jsx(Te,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(De,{}),value:b,onChange:t=>G(t.target.value),style:{width:"100%",maxWidth:400}})]}),e.jsxs(W,{activeKey:H,onChange:O,children:[e.jsx(M,{tab:`Active (${V.length})`,children:e.jsx(B,{columns:U,dataSource:V,rowKey:"_id",pagination:{pageSize:10},loading:x,scroll:{x:"max-content"}})},"active"),e.jsx(M,{tab:`Inactive (${P.length})`,children:e.jsx(B,{columns:U,dataSource:P,rowKey:"_id",pagination:{pageSize:10},loading:x,scroll:{x:"max-content"}})},"inactive")]})]}),e.jsx(je,{visible:Q,onClose:()=>w(!1),onSave:re,initialValues:i,allUsers:z,loadingUsers:J}),e.jsx(E,{title:"Confirm Status Change",open:X,onOk:le,onCancel:()=>v(!1),okText:"Yes",cancelText:"No",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:f==null?void 0:f.businessName})," to ",e.jsx("strong",{children:A}),"?"]})}),e.jsx(E,{title:"Confirm Delete",open:te,onOk:de,onCancel:()=>y(!1),okText:"Delete",okButtonProps:{danger:!0},cancelText:"Cancel",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:d==null?void 0:d.businessName}),"?"]})}),g&&e.jsx(Ce,{visible:ae,onClose:()=>_(!1),account:g,refreshAccounts:m}),g&&e.jsx(we,{visible:se,onClose:()=>F(!1),account:g,refreshAccounts:m})]})};export{pt as default};
