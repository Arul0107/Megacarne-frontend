import{r as w,n as e,o as b,V as s,B as r,T as c}from"./index-DD76fs-h.js";import{R as B,E as _}from"./jspdf.es.min-Csoo9Yjq.js";import E from"./html2canvas.esm-CBrSDip1.js";import{I as z,R as I}from"./index-Bz8HKjRU.js";import{a as L}from"./TextArea-CMtgeMII.js";import{F as y,R as M}from"./Table-Bd4A0fxf.js";import{M as G}from"./index-keQBqU8z.js";import{D as a}from"./index-C70Jm7S8.js";import{T as N}from"./index-C7mdu0c-.js";import{T as U}from"./index-BjXlmfRw.js";import{D as K}from"./index-BelEbI9C.js";import{R as O}from"./MessageOutlined-Wt4EX-mr.js";import{P as W}from"./index-DfZabzEr.js";import{R as H}from"./DeleteOutlined-QhKYsw_D.js";import"./index-Cyejg2uk.js";import"./index-ZtJ4PVaR.js";import"./useClosable-DEE2SN-J.js";import"./InfoCircleFilled-AVuMim3v.js";import"./context-CGg-q3Eq.js";const{Text:l}=U,pe=({quotations:D,onAddNew:C,onEdit:S,onDelete:R,onSearch:F,onViewNotes:T})=>{var j;const[q,u]=w.useState(!1),[i,v]=w.useState(null),k=t=>{v(t),u(!0),s("Viewing quotation details")},p=async(t,o="download")=>{try{const d=s.loading("Generating PDF..."),f=document.getElementById(`quotation-${t._id}`);if(!f){s.error("Quotation content not found",{id:d});return}const n=f.cloneNode(!0);n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="210mm",n.style.background="white",n.style.zIndex="-1",n.style.display="block",document.body.appendChild(n),await new Promise(h=>setTimeout(h,200));const x=await E(n,{scale:2,useCORS:!0}),$=x.toDataURL("image/png"),m=new _("p","mm","a4"),g=m.internal.pageSize.getWidth(),A=x.height*g/x.width;if(m.addImage($,"PNG",0,0,g,A),o==="download")m.save(`${t.quotationNumber||"quotation"}.pdf`),s.success("PDF downloaded successfully",{id:d});else{const h=m.output("blob"),Q=URL.createObjectURL(h);window.open(Q,"_blank"),s.success("PDF preview opened",{id:d})}document.body.removeChild(n)}catch(d){console.error(d),s.error("Failed to generate PDF")}},P=t=>{R(t)},V=[{title:"Quotation #",dataIndex:"quotationNumber",render:t=>e.jsx(N,{color:"blue",children:t})},{title:"Business",dataIndex:"businessName"},{title:"Customer",dataIndex:"customerName"},{title:"Latest Note",dataIndex:"notes",render:t=>{if(t&&t.length>0){const o=t[t.length-1],d=o.text.length>30?`${o.text.substring(0,30)}...`:o.text;return e.jsx(c,{title:o.text,children:e.jsx(l,{type:"secondary",children:d})})}return e.jsx(l,{type:"secondary",italic:!0,children:"No notes"})}},{title:"Total (₹)",dataIndex:"total",render:t=>e.jsxs(l,{strong:!0,style:{color:"#52c41a"},children:["₹",t.toFixed(2)]})},{title:"Date",dataIndex:"date"},{title:"Actions",render:(t,o)=>e.jsxs(b,{children:[e.jsx(c,{title:"View Invoice",children:e.jsx(r,{icon:e.jsx(I,{}),onClick:()=>k(o)})}),e.jsx(c,{title:"Download PDF",children:e.jsx(r,{icon:e.jsx(B,{}),onClick:()=>p(o,"download")})}),e.jsx(c,{title:"Notes",children:e.jsx(r,{icon:e.jsx(O,{}),onClick:()=>{T(o),s("Viewing notes")}})}),e.jsx(c,{title:"Edit",children:e.jsx(r,{icon:e.jsx(M,{}),onClick:()=>{S(o),s("Editing quotation")}})}),e.jsx(W,{title:"Delete this quotation?",onConfirm:()=>P(o._id),okText:"Yes",cancelText:"No",children:e.jsx(c,{title:"Delete",children:e.jsx(r,{icon:e.jsx(H,{}),danger:!0})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs(b,{style:{marginBottom:16,justifyContent:"space-between",width:"100%"},children:[e.jsx(z.Search,{placeholder:"Search...",onChange:t=>{F(t.target.value),s("Searching...")},style:{width:300},prefix:e.jsx(L,{})}),e.jsx(r,{type:"primary",onClick:()=>{C(),s("Creating new quotation")},children:"+ New Quotation"})]}),e.jsx(y,{columns:V,dataSource:D,rowKey:"_id"}),e.jsx(G,{title:"Quotation Details",open:q,onCancel:()=>u(!1),footer:[e.jsx(r,{icon:e.jsx(I,{}),onClick:()=>p(i,"view"),children:"View PDF"},"view"),e.jsx(r,{onClick:()=>u(!1),children:"Close"},"close")],width:900,children:i&&e.jsxs("div",{id:`quotation-${i._id}`,children:[e.jsxs(a,{column:2,bordered:!0,size:"small",children:[e.jsx(a.Item,{label:"Quotation Number",children:e.jsx(N,{color:"blue",children:i.quotationNumber})}),e.jsx(a.Item,{label:"Date",children:i.date}),e.jsx(a.Item,{label:"Business Name",children:i.businessName}),e.jsx(a.Item,{label:"Customer Name",children:i.customerName}),e.jsx(a.Item,{label:"GSTIN",span:2,children:e.jsx(l,{code:!0,children:i.gstin||"N/A"})}),e.jsx(a.Item,{label:"Business Info",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:i.businessInfo||"N/A"})}),e.jsx(a.Item,{label:"Customer Address",span:2,children:e.jsx(l,{style:{whiteSpace:"pre-wrap"},children:i.customerAddress||"N/A"})}),e.jsx(a.Item,{label:"Total Amount",span:2,children:e.jsxs(l,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:["₹",(i.total||0).toFixed(2)]})})]}),((j=i.items)==null?void 0:j.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{orientation:"left",children:"Items"}),e.jsx(y,{dataSource:i.items,columns:[{title:"Description",dataIndex:"description",ellipsis:!0},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center"},{title:"Qty",dataIndex:"quantity",width:80,align:"center"},{title:"Rate (₹)",dataIndex:"rate",width:120,align:"right",render:t=>`₹${(t||0).toFixed(2)}`},{title:"Amount (₹)",width:120,align:"right",render:(t,o)=>e.jsxs(l,{strong:!0,children:["₹",(o.quantity*o.rate).toFixed(2)]})}],pagination:!1,size:"small",rowKey:(t,o)=>o,bordered:!0})]})]})})]})};export{pe as default};
