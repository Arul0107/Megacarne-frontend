import{r as a,p as e,s as r,B as I}from"./index-B-Scc70w.js";import{i as u}from"./axios-0yhrvgHk.js";import{B as Y,N as z,S as G}from"./NotesDrawer-BxyO_Kdq.js";import{C as J,T as B}from"./index-CTyommp3.js";import{T as Q}from"./index-BjEnf3tY.js";import{I as X}from"./index-D2P39C2r.js";import{R as Z}from"./TextArea-3xmhtIFj.js";import{F as A,R as ee}from"./Table-CHxYOe8R.js";import{E as _}from"./index-T1SRL-JP.js";import{M as te}from"./index-CM8SpixO.js";import{R as se}from"./MessageOutlined-uboxO2Fa.js";import{T as m}from"./index-D0LGfCL0.js";import"./index-xsH4HHeE.js";import"./index-CJSKmZ54.js";import"./row-jLefKywz.js";import"./index-DtaySsWa.js";import"./context-C96cH_n_.js";import"./useClosable-BGWy54pf.js";import"./index-1O6uZkHD.js";import"./index-BxykBC4t.js";import"./PlusOutlined-Br6dYwaI.js";import"./index-DcXCIAAn.js";const{Title:ae}=Q,{TabPane:k}=B,Ie=()=>{const[f,E]=a.useState(""),[F,L]=a.useState("active"),[$,j]=a.useState([]),[p,i]=a.useState(!1),[R,h]=a.useState(!1),[o,y]=a.useState(null),[V,x]=a.useState(!1),[c,D]=a.useState(null),[g,M]=a.useState(null),[K,v]=a.useState(!1),[C,q]=a.useState(null),d=()=>{i(!0),u.get("/api/accounts/customers").then(t=>{const s=Array.isArray(t.data)?t.data:[];j(s),r.success("Customers loaded")}).catch(()=>{r.error("Failed to load customers"),j([])}).finally(()=>i(!1))};a.useEffect(()=>{d()},[]);const H=t=>{y(t),h(!0)},O=t=>{i(!0),(o!=null&&o._id?u.put(`/api/accounts/${o._id}`,t):u.post("/api/accounts",t)).then(()=>{r.success(`Customer ${o!=null&&o._id?"updated":"created"} successfully`),d()}).catch(()=>{r.error(`Failed to ${o!=null&&o._id?"update":"create"} customer`)}).finally(()=>{h(!1),y(null),i(!1)})},W=t=>{q(t),v(!0)},P=(t,s)=>{D(s),M(t?"Active":"Inactive"),x(!0)},U=()=>{i(!0);const t={...c,status:g};u.put(`/api/accounts/${c._id}`,t).then(()=>{r.success("Status updated"),d()}).catch(()=>{r.error("Failed to update status")}).finally(()=>{x(!1),i(!1)})},S=$.filter(t=>{var n,l,N;const s=f.toLowerCase();return((n=t.businessName)==null?void 0:n.toLowerCase().includes(s))||((l=t.contactName)==null?void 0:l.toLowerCase().includes(s))||((N=t.email)==null?void 0:N.toLowerCase().includes(s))}),b=S.filter(t=>t.status==="Active"),w=S.filter(t=>t.status==="Inactive"),T=[{title:"Sno.",render:(t,s,n)=>n+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(m,{color:"red",children:"Hot"});case"Warm":return e.jsx(m,{color:"orange",children:"Warm"});case"Cold":return e.jsx(m,{color:"blue",children:"Cold"});default:return e.jsx(m,{children:"Unknown"})}}},{title:"Latest Note",render:(t,s)=>{var l;const n=(l=s.notes)==null?void 0:l[s.notes.length-1];return n?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:n.timestamp}),e.jsx("br",{}),n.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsxs("span",{style:{color:s.status==="Inactive"?"red":"inherit"},children:[e.jsx(G,{checked:s.status==="Active",onChange:n=>P(n,s),checkedChildren:"Active",unCheckedChildren:"Inactive"}),e.jsx("span",{style:{marginLeft:8},children:s.status})]})},{title:"Actions",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(ee,{}),onClick:()=>H(s),type:"link"}),e.jsx(I,{icon:e.jsx(se,{}),onClick:()=>W(s),type:"link"})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(J,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:e.jsx(ae,{level:4,children:"Customers"})}),e.jsx(X,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(Z,{}),value:f,onChange:t=>E(t.target.value),style:{width:400,marginBottom:16}}),e.jsxs(B,{activeKey:F,onChange:L,children:[e.jsx(k,{tab:`Active (${b.length})`,children:e.jsx(A,{columns:T,dataSource:b,rowKey:"_id",pagination:!1,loading:p,locale:{emptyText:e.jsx(_,{description:"No active customers"})}})},"active"),e.jsx(k,{tab:`Inactive (${w.length})`,children:e.jsx(A,{columns:T,dataSource:w,rowKey:"_id",pagination:!1,loading:p,locale:{emptyText:e.jsx(_,{description:"No inactive customers"})}})},"inactive")]})]}),e.jsx(Y,{visible:R,onClose:()=>h(!1),onSave:O,initialValues:o}),e.jsx(te,{title:"Confirm Status Change",open:V,onOk:U,onCancel:()=>x(!1),okText:"Yes",cancelText:"No",confirmLoading:p,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:c==null?void 0:c.businessName})," to ",e.jsx("strong",{children:g}),"?"]})}),C&&e.jsx(z,{visible:K,onClose:()=>v(!1),account:C,refreshAccounts:d})]})};export{Ie as default};
