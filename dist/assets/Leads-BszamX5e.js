import{r as a,I as Y,t as q,s as r,p as t,B as c,q as J}from"./index-OdYoXqOt.js";import{i as d}from"./axios-BVNKluDM.js";import"./jspdf.es.min-BLmP08Uy.js";import"./html2canvas.esm-CBrSDip1.js";import{B as Q,N as X,F as Z}from"./FollowUpDrawer-Dj4_UXdl.js";import{C as ee}from"./index-6f6jfSv1.js";import{I as k}from"./index-CyF63g_w.js";import{R as I}from"./TextArea-BBpwzQlG.js";import{R as te,T as F}from"./index-BMSFUza1.js";import{F as se,R as oe}from"./Table-BUjwp330.js";import{E as ae}from"./index-BEcng5S8.js";import{M as re}from"./index-9Rv8uXPb.js";import{T as ce,a as ne}from"./index-CE07GngT.js";import{R as le}from"./MessageOutlined-FcG8y4wq.js";import{S as ie}from"./index-C2QcUUjQ.js";import{P as ue}from"./index-BTx-wPRv.js";import{R as de}from"./DeleteOutlined-D7u6MCin.js";import"./index-BBliv2OJ.js";import"./index-Dmc8TwUP.js";import"./index-DZrLd_wq.js";import"./context-B06BlMR-.js";import"./index-RXJb7B3c.js";import"./index-BsgGtD0b.js";import"./index-D-Ar94d9.js";import"./index-W2rIB213.js";import"./index-Bq00u7W1.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},pe=function(l,u){return a.createElement(Y,q({},l,{ref:u,icon:me}))},xe=a.forwardRef(pe);const{Title:fe}=ce,{TabPane:T}=F,n="/api/accounts",ze=()=>{const[C,l]=a.useState(!1),[u,w]=a.useState(null),[m,R]=a.useState(""),[p,$]=a.useState("active"),[L,x]=a.useState(!1),[b,f]=a.useState(null),[h,v]=a.useState(null),[D,V]=a.useState([]),[B,j]=a.useState(!1),[E,S]=a.useState(!1),[y,g]=a.useState(null);a.useEffect(()=>{i()},[p]);const i=async()=>{try{let e="";p==="active"?e=`${n}/leads/active`:p==="customers"?e=`${n}/customers`:e=n;const s=await d.get(e);V(s.data)}catch(e){r.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e)}},O=async e=>{var s;try{u?(await d.put(`${n}/${u._id}`,e),r.success("Account updated successfully!")):(await d.post(n,e),r.success("Account created successfully!")),l(!1),i()}catch(o){r.error("Failed to save account."),console.error("Save account error:",((s=o.response)==null?void 0:s.data)||o.message)}},M=e=>{w(e),l(!0)},P=async e=>{var s;try{await d.delete(`${n}/${e}`),r.success("Account deleted successfully (soft delete)!"),i()}catch(o){r.error("Failed to delete account."),console.error("Delete account error:",((s=o.response)==null?void 0:s.data)||o.message)}},U=e=>{g(e),j(!0)},z=e=>{g(e),S(!0)},H=(e,s)=>{f(s),v(e),x(!0)},_=async()=>{var e;try{const s={...b,isCustomer:h};await d.put(`${n}/${b._id}`,s),r.success(`Account status changed to ${h?"Customer":"Lead"}!`),i()}catch(s){r.error("Failed to update account status."),console.error("Status update error:",((e=s.response)==null?void 0:e.data)||s.message)}finally{x(!1),f(null),v(null)}},W=()=>{x(!1),f(null),v(null)},G=[{title:"S.No",key:"sno",render:(e,s,o)=>o+1},{title:"Business Name",dataIndex:"businessName",key:"businessName",filterDropdown:({setSelectedKeys:e,selectedKeys:s,confirm:o,clearFilters:K})=>t.jsxs("div",{style:{padding:8},children:[t.jsx(k,{placeholder:"Search Business Name",value:s[0],onChange:N=>e(N.target.value?[N.target.value]:[]),onPressEnter:()=>o(),style:{marginBottom:8,display:"block"}}),t.jsx(c,{type:"primary",onClick:()=>o(),icon:t.jsx(I,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t.jsx(c,{onClick:()=>K(),size:"small",style:{width:90},children:"Reset"})]}),onFilter:(e,s)=>s.businessName.toLowerCase().includes(e.toLowerCase())},{title:"Contact Name",dataIndex:"contactName",key:"contactName"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber"},{title:"Lead Type",dataIndex:"type",key:"type",filters:[{text:"Hot",value:"Hot"},{text:"Warm",value:"Warm"},{text:"Cold",value:"Cold"}],onFilter:(e,s)=>s.type.indexOf(e)===0},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(ne,{color:e==="Active"?"green":"red",children:e}),filters:[{text:"Active",value:"Active"},{text:"Inactive",value:"Inactive"}],onFilter:(e,s)=>s.status.indexOf(e)===0},{title:"Source Type",dataIndex:"sourceType",key:"sourceType",filters:[{text:"Direct",value:"Direct"},{text:"Facebook Referral",value:"Facebook Referral"},{text:"Google Ads",value:"Google Ads"},{text:"Website",value:"Website"},{text:"Cold Call",value:"Cold Call"},{text:"Other",value:"Other"}],onFilter:(e,s)=>{var o;return((o=s.sourceType)==null?void 0:o.indexOf(e))===0}},{title:"Referral Person",dataIndex:"referralPersonName",key:"referralPersonName",render:e=>e||"N/A"},{title:"Action",key:"action",render:(e,s)=>t.jsxs(J,{size:"middle",children:[t.jsx(c,{icon:t.jsx(oe,{}),onClick:()=>M(s)}),t.jsx(c,{icon:t.jsx(le,{}),onClick:()=>U(s)}),t.jsx(c,{icon:t.jsx(xe,{}),onClick:()=>z(s)}),t.jsx(ie,{checkedChildren:"Customer",unCheckedChildren:"Lead",checked:s.isCustomer,onChange:o=>H(o,s)}),t.jsx(ue,{title:"Are you sure you want to delete this account?",onConfirm:()=>P(s._id),okText:"Yes",cancelText:"No",children:t.jsx(c,{icon:t.jsx(de,{}),danger:!0})})]})}],A=D.filter(e=>e.businessName.toLowerCase().includes(m.toLowerCase())||e.contactName.toLowerCase().includes(m.toLowerCase()));return t.jsxs(ee,{title:t.jsx(fe,{level:2,children:"Manage Leads & Customers"}),children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(k,{placeholder:"Search by business or contact name",efix:t.jsx(I,{}),style:{width:300},value:m,onChange:e=>R(e.target.value)}),t.jsx(c,{type:"primary",icon:t.jsx(te,{}),onClick:()=>{w(null),l(!0)},children:"Add New Account"})]}),t.jsxs(F,{defaultActiveKey:"active",onChange:$,children:[t.jsx(T,{tab:"Active Leads"},"active"),t.jsx(T,{tab:"Customers"},"customers")]}),A.length>0?t.jsx(se,{columns:G,dataSource:A,rowKey:"_id",scroll:{x:"max-content"}}):t.jsx(ae,{description:"No accounts found."}),t.jsx(Q,{visible:C,onClose:()=>l(!1),onSave:O,initialValues:u}),y&&t.jsxs(t.Fragment,{children:[t.jsx(X,{visible:B,onClose:()=>j(!1),account:y,refreshAccounts:i}),t.jsx(Z,{visible:E,onClose:()=>S(!1),account:y,refreshAccounts:i})]}),t.jsx(re,{title:"Change Account Status",visible:L,onOk:_,onCancel:W,okText:"Yes",cancelText:"No",children:t.jsxs("p",{children:["Are you sure you want to change this account's status to ",h?"Customer":"Lead","?"]})})]})};export{ze as default};
