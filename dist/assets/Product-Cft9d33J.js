import{r as h,p as e,q as z,B as I,V as x,S as Q,aE as E,T as F}from"./index-CYKRXJOk.js";import{i as D}from"./axios-CbH7bVGc.js";import{d as U,D as H}from"./index-CwSLYTCe.js";import{F as i}from"./index-BzpcUq4L.js";import{D as T}from"./index-CRQdXBH2.js";import{R as C,C as k}from"./index-cHzbopOC.js";import{I as f,R as K}from"./index-CADQv6lt.js";import{R as J}from"./MinusCircleOutlined-BH6sDGOu.js";import{R as $,T as q}from"./index-eIkLMMP9.js";import{S as W}from"./index-CQDXKDWk.js";import{R as Y}from"./SendOutlined-Cg0Qr6ps.js";import{T as G,a as A}from"./index-hkH-ZYDi.js";import{F as R,R as M}from"./Table-DP7y5znB.js";import{D as c}from"./index-qzHOtGa7.js";import{C as O}from"./Collapse-BgYy8-p_.js";import{R as X}from"./MessageOutlined-CtTlXg8g.js";import{P as Z}from"./index-Lf6PW4pG.js";import{R as V}from"./DeleteOutlined-BX9P26kX.js";import"./TextArea-9LReN77j.js";import"./index-Cc2eT5bz.js";import"./context-BtKXkfhE.js";import"./index-kouXNn5D.js";const ee=({visible:g,onClose:w,onSave:d,initialValues:n})=>{const[m]=i.useForm();h.useEffect(()=>{g&&n?m.setFieldsValue({...n,stockLoadDate:n.stockLoadDate?U(n.stockLoadDate):null,options:n.options||[]}):m.resetFields()},[g,n]);const j=async t=>{var a;const{product_id:u,productId:b,_id:S,...r}=t,P={...r,price:Number(r.price)||0,quantity:Number(r.quantity)||0,inStock:Number(r.inStock)||0,outStock:Number(r.outStock)||0,stockLoadDate:r.stockLoadDate?r.stockLoadDate.toISOString():null,isActive:r.isActive||!1,options:(r.options||[]).filter(o=>{var y,p;return((y=o==null?void 0:o.type)==null?void 0:y.trim())&&((p=o==null?void 0:o.description)==null?void 0:p.trim())})};try{n!=null&&n._id?(await D.put(`/api/products/${n._id}`,P),x.success("Product updated")):(await D.post("/api/products",P),x.success("Product added")),d(),w()}catch(o){x.error("Failed to save product"),console.error(((a=o==null?void 0:o.response)==null?void 0:a.data)||o.message)}};return e.jsx(T,{title:n?"Edit Product":"Add Product",open:g,onClose:w,width:640,destroyOnClose:!0,children:e.jsxs(i,{layout:"vertical",form:m,onFinish:j,children:[e.jsxs(C,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"productName",label:"Product Name",rules:[{required:!0,message:"Enter product name"}],children:e.jsx(f,{placeholder:"Product name"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"price",label:"Price (INR)",rules:[{required:!0,message:"Enter price"}],children:e.jsx(f,{type:"number",placeholder:"Price"})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"quantity",label:"Quantity",children:e.jsx(f,{type:"number",placeholder:"Quantity"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"inStock",label:"In Stock",children:e.jsx(f,{type:"number",placeholder:"In Stock"})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"outStock",label:"Out Stock",children:e.jsx(f,{type:"number",placeholder:"Out Stock"})})}),e.jsx(k,{span:12,children:e.jsx(i.Item,{name:"stockLoadDate",label:"Stock Load Date",children:e.jsx(H,{style:{width:"100%"}})})})]}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(f.TextArea,{rows:2,placeholder:"Description"})}),e.jsx(i.List,{name:"options",children:(t,{add:u,remove:b})=>e.jsxs(e.Fragment,{children:[e.jsx("label",{style:{fontWeight:600},children:"Product Options"}),t.map(({key:S,name:r})=>e.jsxs(z,{style:{display:"flex",marginBottom:8},align:"start",children:[e.jsx(i.Item,{name:[r,"type"],rules:[{required:!0,message:"Enter type"}],children:e.jsx(f,{placeholder:"Type"})}),e.jsx(i.Item,{name:[r,"description"],rules:[{required:!0,message:"Enter description"}],children:e.jsx(f,{placeholder:"Description"})}),e.jsx(J,{onClick:()=>b(r)})]},S)),e.jsx(i.Item,{children:e.jsx(I,{onClick:()=>u(),icon:e.jsx($,{}),children:"Add Option"})})]})}),e.jsx(i.Item,{name:"isActive",label:"Active",valuePropName:"checked",children:e.jsx(W,{})}),e.jsx(i.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",block:!0,children:n?"Update":"Create"})})]})})},{TextArea:te}=f,{Title:se,Text:re}=G,oe=({visible:g,onClose:w,product:d,refreshProducts:n})=>{const[m]=i.useForm(),[j,t]=h.useState(!1),[u,b]=h.useState([]);h.useEffect(()=>{b((d==null?void 0:d.notes)||[])},[d]);const S=()=>{try{const a=JSON.parse(localStorage.getItem("user"));return(a==null?void 0:a.email)||"Unknown"}catch{return"Unknown"}},r=async a=>{try{t(!0);const o=x.loading("Adding note..."),y={text:a.note,timestamp:new Date().toLocaleString(),author:S()},p=[...u,y];await D.put(`/api/products/${d._id}/notes`,{notes:p}),b(p),x.success("Note added",{id:o}),m.resetFields(),n()}catch{x.error("Failed to add note")}finally{t(!1)}},P=()=>u.length?u.map((a,o)=>{const y=o>0?u[o-1]:null,p=new Date(a.timestamp).toDateString(),N=y?new Date(y.timestamp).toDateString():null,v=p!==N;return e.jsxs("div",{children:[v&&e.jsx("div",{className:"note-date-header",children:p}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[a.author," Â Â  ",a.timestamp]}),e.jsx("div",{className:"note-text",children:a.text})]})]},o)}):e.jsx(re,{type:"secondary",children:"No notes added yet"});return e.jsx(T,{title:e.jsxs(se,{level:4,style:{margin:0},children:["Notes for Product: ",d==null?void 0:d.productName]}),open:g,onClose:w,width:440,destroyOnClose:!0,children:e.jsxs(Q,{spinning:j,children:[e.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:P()}),e.jsxs(i,{form:m,layout:"vertical",onFinish:r,children:[e.jsx(i.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(te,{rows:3,placeholder:"Type your note here"})}),e.jsx(I,{type:"primary",htmlType:"submit",loading:j,block:!0,icon:e.jsx(Y,{}),children:"Add Note"})]})]})})},{Content:ne,Header:ie}=E,{TabPane:L}=q,{Panel:_}=O,Ae=()=>{var v;const[g,w]=h.useState([]),[d,n]=h.useState(!1),[m,j]=h.useState(null),[t,u]=h.useState(null),[b,S]=h.useState(!1),r=async()=>{try{const{data:s}=await D.get("/api/products");w(s)}catch{x.error("Failed to load products")}};h.useEffect(()=>{r()},[]);const P=()=>{r()},a=async s=>{try{await D.delete(`/api/products/${s}`),x.success("Product deleted"),r()}catch{x.error("Failed to delete product")}},o=async s=>{try{const{data:l}=await D.get(`/api/products/${s}`);u(l)}catch{x.error("Failed to fetch product details")}},y=g.filter(s=>s.isActive),p=g.filter(s=>!s.isActive),N=()=>[{title:"S.No",render:(s,l,B)=>B+1,width:60},{title:"Product ID",dataIndex:"product_id",width:120},{title:"Name",dataIndex:"productName",width:160},{title:"Qty",dataIndex:"quantity",width:80},{title:"Price (â‚¹)",dataIndex:"price",render:s=>`â‚¹${s==null?void 0:s.toFixed(2)}`,width:100},{title:"In Stock",dataIndex:"inStock",width:100},{title:"Out Stock",dataIndex:"outStock",width:100},{title:"Status",dataIndex:"isActive",render:s=>s?e.jsx(A,{color:"green",children:"Active"}):e.jsx(A,{color:"red",children:"Inactive"}),width:100},{title:"Actions",fixed:"right",width:180,render:(s,l)=>e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"View",children:e.jsx(I,{type:"text",icon:e.jsx(K,{}),onClick:()=>o(l._id)})}),e.jsx(F,{title:"Edit",children:e.jsx(I,{type:"text",icon:e.jsx(M,{}),onClick:()=>{j(l),n(!0)}})}),e.jsx(F,{title:"Notes",children:e.jsx(I,{type:"text",icon:e.jsx(X,{}),onClick:()=>{j(l),S(!0)}})}),e.jsx(Z,{title:"Confirm delete?",onConfirm:()=>a(l._id),children:e.jsx(I,{type:"text",icon:e.jsx(V,{}),danger:!0})})]})}];return e.jsxs(E,{style:{minHeight:"100vh"},children:[e.jsx(ie,{style:{color:"white",fontSize:20},children:"ðŸ“¦ Product Inventory"}),e.jsxs(ne,{style:{padding:20},children:[e.jsxs(q,{defaultActiveKey:"1",children:[e.jsxs(L,{tab:"Active Products",children:[e.jsx(I,{type:"primary",icon:e.jsx($,{}),onClick:()=>{j(null),n(!0)},style:{marginBottom:16},children:"Add Product"}),e.jsx(R,{columns:N(),dataSource:y,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})]},"1"),e.jsx(L,{tab:"Inactive Products",children:e.jsx(R,{columns:N(),dataSource:p,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})},"2")]}),e.jsx(ee,{visible:d,onClose:()=>{j(null),n(!1)},onSave:P,initialValues:m}),e.jsx(T,{open:!!t,title:"Product Details",width:820,onClose:()=>u(null),children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{bordered:!0,column:1,size:"small",children:[e.jsx(c.Item,{label:"Product ID",children:t.product_id}),e.jsx(c.Item,{label:"Name",children:t.productName}),e.jsx(c.Item,{label:"Price",children:`â‚¹${(v=t.price)==null?void 0:v.toFixed(2)}`}),e.jsx(c.Item,{label:"Qty",children:t.quantity}),e.jsx(c.Item,{label:"In Stock",children:t.inStock}),e.jsx(c.Item,{label:"Out Stock",children:t.outStock}),e.jsx(c.Item,{label:"Stock Load Date",children:t.stockLoadDate&&new Date(t.stockLoadDate).toLocaleDateString()}),e.jsx(c.Item,{label:"Description",children:t.description||"N/A"}),e.jsx(c.Item,{label:"Status",children:t.isActive?e.jsx(A,{color:"green",children:"Active"}):e.jsx(A,{color:"red",children:"Inactive"})})]}),e.jsxs(O,{style:{marginTop:20},children:[e.jsx(_,{header:"Product Options",children:Array.isArray(t.options)&&t.options.length>0?t.options.map((s,l)=>e.jsxs(c,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(c.Item,{label:"Type",children:s.type}),e.jsx(c.Item,{label:"Description",children:s.description})]},l)):e.jsx("p",{children:"No product options available."})},"1"),e.jsx(_,{header:"Product Notes",children:Array.isArray(t.notes)&&t.notes.length>0?t.notes.map((s,l)=>e.jsxs(c,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(c.Item,{label:"Note",span:2,children:s.text}),e.jsx(c.Item,{label:"Author",children:s.author}),e.jsx(c.Item,{label:"Time",children:new Date(s.timestamp).toLocaleString()})]},l)):e.jsx("p",{children:"No notes available."})},"2")]})]})}),m&&e.jsx(oe,{visible:b,onClose:()=>S(!1),product:m,refreshProducts:r})]})]})};export{Ae as default};
